!function(){var s6,tD,sV,sZ,s5,tw,sU,tK,tk=function(){for(var b=[],a=0;a<arguments.length;a++){b[a]=arguments[a]}},sS=function(a,b){return function(){for(var d=[],c=0;c<arguments.length;c++){d[c]=arguments[c]}return a(b.apply(null,arguments))}},uC=function(a){return function(){return a}},tx=function(a){return a},th=function(c){for(var f=[],d=1;d<arguments.length;d++){f[d-1]=arguments[d]}for(var a=new Array(arguments.length-1),b=1;b<arguments.length;b++){a[b-1]=arguments[b]}return function(){for(var k=[],i=0;i<arguments.length;i++){k[i]=arguments[i]}for(var g=new Array(arguments.length),h=0;h<g.length;h++){g[h]=arguments[h]}var j=a.concat(g);return c.apply(null,j)}},tV=function(a){return function(){for(var c=[],b=0;b<arguments.length;b++){c[b]=arguments[b]}return !a.apply(null,arguments)}},tH=function(a){return function(){throw new Error(a)}},sX=function(a){return a()},tB=uC(!1),tE=uC(!0),s8=function(a){return function(b){return function(d){if(null===d){return"null"}var c=typeof d;return"object"===c&&Array.prototype.isPrototypeOf(d)?"array":"object"===c&&String.prototype.isPrototypeOf(d)?"string":c}(b)===a}},tI=s8("string"),tz=s8("object"),s3=s8("array"),sP=s8("boolean"),sR=s8("function"),sQ=s8("number"),tX=Object.prototype.hasOwnProperty,t4=function(a){return function(){for(var h=new Array(arguments.length),f=0;f<h.length;f++){h[f]=arguments[f]}if(0===h.length){throw new Error("Can't merge zero objects")}for(var c={},d=0;d<h.length;d++){var g=h[d];for(var b in g){tX.call(g,b)&&(c[b]=a(c[b],g[b]))}}return c}},uG=t4(function(b,a){return tz(b)&&tz(a)?uG(b,a):a}),uF=t4(function(b,a){return a}),uJ=tB,tZ=tE,t9=function(){return uq},uq=(sZ={fold:function(b,a){return b()},is:uJ,isSome:uJ,isNone:tZ,getOr:sV=function(a){return a},getOrThunk:tD=function(a){return a()},getOrDie:function(a){throw new Error(a||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){return undefined},or:sV,orThunk:tD,map:t9,ap:t9,each:function(){},bind:t9,flatten:t9,exists:uJ,forall:tZ,filter:t9,equals:s6=function(a){return a.isNone()},equals_:s6,toArray:function(){return[]},toString:uC("none()")},Object.freeze&&Object.freeze(sZ),sZ),t6=function(a){var f=function(){return a},c=function(){return d},b=function(e){return e(a)},d={fold:function(h,g){return g(a)},is:function(e){return a===e},isSome:tZ,isNone:uJ,getOr:f,getOrThunk:f,getOrDie:f,getOrNull:f,getOrUndefined:f,or:c,orThunk:c,map:function(e){return t6(e(a))},ap:function(e){return e.fold(t9,function(g){return t6(g(a))})},each:function(e){e(a)},bind:b,flatten:f,exists:b,forall:b,filter:function(e){return e(a)?d:uq},equals:function(e){return e.is(a)},equals_:function(h,g){return h.fold(uJ,function(e){return g(a,e)})},toArray:function(){return[a]},toString:function(){return"some("+a+")"}};return d},uI={some:t6,none:t9,from:function(a){return null===a||a===undefined?uq:t6(a)}},uB=Object.keys,tS=function(g,d){for(var b=uB(g),c=0,f=b.length;c<f;c++){var a=b[c];d(g[a],a,g)}},ux=function(b,a){return sO(b,function(f,d,c){return{k:d,v:a(f,d,c)}})},sO=function(b,c){var a={};return tS(b,function(g,f){var d=c(g,f,b);a[d.k]=d.v}),a},tq=function(c,a){var b=[];return tS(c,function(f,d){b.push(a(f,d))}),b},uh=uC("touchstart"),tT=uC("touchmove"),t3=uC("touchend"),tM=uC("mousedown"),tQ=uC("mousemove"),u0=uC("mouseup"),uz=uC("mouseover"),s1=uC("keydown"),tO=uC("input"),tP=uC("change"),uj=uC("click"),uk=uC("transitionend"),t1=uC("selectstart"),tN=function(a){var b,c=!1;return function(){for(var f=[],d=0;d<arguments.length;d++){f[d]=arguments[d]}return c||(c=!0,b=a.apply(null,f)),b}},oU=function(d,c){var a=function(i,h){for(var f=0;f<i.length;f++){var g=i[f];if(g.test(h)){return g}}return undefined}(d,c);if(!a){return{major:0,minor:0}}var b=function(e){return Number(c.replace(a,"$"+e))};return lW(b(1),b(2))},r7=function(){return lW(0,0)},lW=function(b,a){return{major:b,minor:a}},ny={nu:lW,detect:function(c,b){var a=String(b).toLowerCase();return 0===c.length?r7():oU(c,a)},unknown:r7},oD="Firefox",k7=function(b,a){return function(){return a===b}},uS=function(b){var a=b.current;return{current:a,version:b.version,isEdge:k7("Edge",a),isChrome:k7("Chrome",a),isIE:k7("IE",a),isOpera:k7("Opera",a),isFirefox:k7(oD,a),isSafari:k7("Safari",a)}},s9={unknown:function(){return uS({current:undefined,version:ny.unknown()})},nu:uS,edge:uC("Edge"),chrome:uC("Chrome"),ie:uC("IE"),opera:uC("Opera"),firefox:uC(oD),safari:uC("Safari")},mK="Windows",rQ="Android",pJ="Solaris",sE="FreeBSD",ph=function(b,a){return function(){return a===b}},rz=function(b){var a=b.current;return{current:a,version:b.version,isWindows:ph(mK,a),isiOS:ph("iOS",a),isAndroid:ph(rQ,a),isOSX:ph("OSX",a),isLinux:ph("Linux",a),isSolaris:ph(pJ,a),isFreeBSD:ph(sE,a)}},kA={unknown:function(){return rz({current:undefined,version:ny.unknown()})},nu:rz,windows:uC(mK),ios:uC("iOS"),android:uC(rQ),linux:uC("Linux"),osx:uC("OSX"),solaris:uC(pJ),freebsd:uC(sE)},n5=(s5=Array.prototype.indexOf)===undefined?function(b,a){return pZ(b,a)}:function(b,a){return s5.call(b,a)},q1=function(b,a){return -1<n5(b,a)},t7=function(b,a){return lF(b,a).isSome()},ij=function(g,d){for(var b=g.length,c=new Array(b),f=0;f<b;f++){var a=g[f];c[f]=d(a,f,g)}return c},jN=function(d,c){for(var a=0,b=d.length;a<b;a++){c(d[a],a,d)}},i0=function(g,d){for(var b=[],c=0,f=g.length;c<f;c++){var a=g[c];d(a,c,g)&&b.push(a)}return b},db=function(c,b,a){return function(g,f){for(var d=g.length-1;0<=d;d--){f(g[d],d,g)}}(c,function(d){a=b(a,d)}),a},dI=function(c,b,a){return jN(c,function(d){a=b(a,d)}),a},e2=function(f,c){for(var a=0,b=f.length;a<b;a++){var d=f[a];if(c(d,a,f)){return uI.some(d)}}return uI.none()},lF=function(d,c){for(var a=0,b=d.length;a<b;a++){if(c(d[a],a,d)){return uI.some(a)}}return uI.none()},pZ=function(d,c){for(var a=0,b=d.length;a<b;++a){if(d[a]===c){return a}}return -1},j3=Array.prototype.push,kQ=function(d){for(var c=[],a=0,b=d.length;a<b;++a){if(!Array.prototype.isPrototypeOf(d[a])){throw new Error("Arr.flatten item "+a+" was not an array, input: "+d)}j3.apply(c,d[a])}return c},m0=function(c,b){var a=ij(c,b);return kQ(a)},dY=function(d,c){for(var a=0,b=d.length;a<b;++a){if(!0!==c(d[a],a,d)){return !1}}return !0},fP=Array.prototype.slice,g8=function(b){var a=fP.call(b,0);return a.reverse(),a},fz=function(a){return[a]},mj=(sR(Array.from)&&Array.from,function(c,b){var a=String(b).toLowerCase();return e2(c,function(d){return d.search(a)})}),jw=function(b,a){return mj(b,a).map(function(d){var c=ny.detect(d.versionRegexes,a);return{current:d.name,version:c}})},b6=function(b,a){return mj(b,a).map(function(d){var c=ny.detect(d.versionRegexes,a);return{current:d.name,version:c}})},hV=function(b,a){return -1!==b.indexOf(a)},hF=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,qq=function(a){return function(b){return hV(b,a)}},f5=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(a){return hV(a,"edge/")&&hV(a,"chrome")&&hV(a,"safari")&&hV(a,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,hF],search:function(a){return hV(a,"chrome")&&!hV(a,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(a){return hV(a,"msie")||hV(a,"trident")}},{name:"Opera",versionRegexes:[hF,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:qq("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:qq("firefox")},{name:"Safari",versionRegexes:[hF,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(a){return(hV(a,"safari")||hV(a,"mobile/"))&&hV(a,"applewebkit")}}],cT=[{name:"Windows",search:qq("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(a){return hV(a,"iphone")||hV(a,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:qq("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:qq("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:qq("linux"),versionRegexes:[]},{name:"Solaris",search:qq("sunos"),versionRegexes:[]},{name:"FreeBSD",search:qq("freebsd"),versionRegexes:[]}],eL={browsers:uC(f5),oses:uC(cT)},ax=function(j){var y,E,b,h,q,D,B,A,F,x,p,z=eL.browsers(),k=eL.oses(),w=jw(z,j).fold(s9.unknown,s9.nu),C=b6(k,j).fold(kA.unknown,kA.nu);return{browser:w,os:C,deviceType:(E=w,b=j,h=(y=C).isiOS()&&!0===/ipad/i.test(b),q=y.isiOS()&&!h,D=y.isAndroid()&&3===y.version.major,B=y.isAndroid()&&4===y.version.major,A=h||D||B&&!0===/mobile/i.test(b),F=y.isiOS()||y.isAndroid(),x=F&&!A,p=E.isSafari()&&y.isiOS()&&!1===/safari/i.test(b),{isiPad:uC(h),isiPhone:uC(q),isTablet:uC(A),isPhone:uC(x),isTouch:uC(F),isAndroid:y.isAndroid,isiOS:y.isiOS,isWebView:uC(p)})}},bQ={detect:tN(function(){var a=navigator.userAgent;return ax(a)})},cD={tap:uC("alloy.tap")},iJ=uC("alloy.focus"),nO=uC("alloy.blur.post"),a3=uC("alloy.receive"),bA=uC("alloy.execute"),gC=uC("alloy.focus.item"),gS=cD.tap,eq=bQ.detect().deviceType.isTouch()?cD.tap:uj,aN=uC("alloy.longpress"),o0=uC("alloy.system.init"),sk=uC("alloy.system.scroll"),l5=uC("alloy.system.attached"),nE=uC("alloy.system.detached"),oJ=function(b,a){tF(b,b.element(),a,{})},qQ=function(c,b,a){tF(c,c.element(),b,a)},lx=function(a){oJ(a,bA())},uY=function(c,b,a){tF(c,b,a,{})},tF=function(f,c,a,b){var d=uG({target:c},b);f.getSystem().triggerEvent(a,c,ux(d,uC))},mT=function(a){if(null===a||a===undefined){throw new Error("Node cannot be null or undefined")}return{dom:uC(a)}},rW={fromHtml:function(c,b){var a=(b||document).createElement("div");if(a.innerHTML=c,!a.hasChildNodes()||1<a.childNodes.length){throw console.error("HTML does not have a single root node",c),"HTML must have a single root node"}return mT(a.childNodes[0])},fromTag:function(c,b){var a=(b||document).createElement(c);return mT(a)},fromText:function(c,b){var a=(b||document).createTextNode(c);return mT(a)},fromDom:mT,fromPoint:function(d,c,a){var b=d.dom();return uI.from(b.elementFromPoint(c,a)).map(mT)}},pP={ATTRIBUTE:Node.ATTRIBUTE_NODE,CDATA_SECTION:Node.CDATA_SECTION_NODE,COMMENT:Node.COMMENT_NODE,DOCUMENT:Node.DOCUMENT_NODE,DOCUMENT_TYPE:Node.DOCUMENT_TYPE_NODE,DOCUMENT_FRAGMENT:Node.DOCUMENT_FRAGMENT_NODE,ELEMENT:Node.ELEMENT_NODE,TEXT:Node.TEXT_NODE,PROCESSING_INSTRUCTION:Node.PROCESSING_INSTRUCTION_NODE,ENTITY_REFERENCE:Node.ENTITY_REFERENCE_NODE,ENTITY:Node.ENTITY_NODE,NOTATION:Node.NOTATION_NODE},sK=function(a){return a.dom().nodeName.toLowerCase()},py=function(a){return a.dom().nodeType},rF=function(a){return function(b){return py(b)===a}},kJ=rF(pP.ELEMENT),oh=rF(pP.TEXT),q7=rF(pP.DOCUMENT),uD={name:sK,type:py,value:function(a){return a.dom().nodeValue},isElement:kJ,isText:oh,isDocument:q7,isComment:function(a){return py(a)===pP.COMMENT||"#comment"===sK(a)}},iC=tN(function(){return jW(rW.fromDom(document))}),jW=function(b){var a=b.dom().body;if(null===a||a===undefined){throw"Body is not available yet"}return rW.fromDom(a)},i9={body:iC,getBody:jW,inBody:function(b){var a=uD.isText(b)?b.dom().parentNode:b.dom();return a!==undefined&&null!==a&&a.ownerDocument.body.contains(a)}},dx=function(){for(var a=[],b=0;b<arguments.length;b++){a[b]=arguments[b]}return function(){for(var c=[],e=0;e<arguments.length;e++){c[e]=arguments[e]}if(a.length!==c.length){throw new Error('Wrong number of arguments to struct. Expected "['+a.length+']", got '+c.length+" arguments")}var d={};return jN(a,function(g,f){d[g]=uC(c[f])}),d}},dO=function(a){return a.slice(0).sort()},e8=function(b,a){throw new Error("All required keys ("+dO(b).join(", ")+") were not specified. Specified keys were: "+dO(a).join(", ")+".")},lM=function(a){throw new Error("Unsupported keys for object: "+dO(a).join(", "))},p5=function(a,b){if(!s3(b)){throw new Error("The "+a+" fields must be an array. Was: "+b+".")}jN(b,function(c){if(!tI(c)){throw new Error("The value "+c+" in the "+a+" fields was not a string.")}})},kb=function(b){var a=dO(b);e2(a,function(d,c){return c<a.length-1&&d===a[c+1]}).each(function(c){throw new Error("The field: "+c+" occurs more than once in the combined fields: ["+a.join(", ")+"].")})},kX=function(c,b){var a=c.concat(b);if(0===a.length){throw new Error("You must specify at least one required or optional field.")}return p5("required",c),p5("optional",b),kb(a),function(g){var d=uB(g);dY(c,function(e){return q1(d,e)})||e8(c,d);var h=i0(d,function(e){return !q1(a,e)});0<h.length&&lM(h);var f={};return jN(c,function(e){f[e]=uC(g[e])}),jN(b,function(e){f[e]=uC(Object.prototype.hasOwnProperty.call(g,e)?uI.some(g[e]):uI.none())}),f}},m7=function(f,c){for(var a=[],b=function(e){return a.push(e),c(e)},d=c(f);(d=d.bind(b)).isSome();){}return a},d4="undefined"!=typeof window?window:Function("return this;")(),fV=function(b,a){return function(g,f){for(var c=f!==undefined&&null!==f?f:d4,d=0;d<g.length&&c!==undefined&&null!==c;++d){c=c[g[d]]}return c}(b.split("."),a)},hw={getOrDie:function(c,b){var a=fV(c,b);if(a===undefined||null===a){throw c+" not available on this browser"}return a}},fF=pP.ELEMENT,mA=pP.DOCUMENT,jD=function(a){return a.nodeType!==fF&&a.nodeType!==mA||0===a.childElementCount},cw={all:function(c,b){var a=b===undefined?document:b.dom();return jD(a)?[]:ij(a.querySelectorAll(c),rW.fromDom)},is:function(c,b){var a=c.dom();if(a.nodeType!==fF){return !1}if(a.matches!==undefined){return a.matches(b)}if(a.msMatchesSelector!==undefined){return a.msMatchesSelector(b)}if(a.webkitMatchesSelector!==undefined){return a.webkitMatchesSelector(b)}if(a.mozMatchesSelector!==undefined){return a.mozMatchesSelector(b)}throw new Error("Browser lacks native selectors")},one:function(c,b){var a=b===undefined?document:b.dom();return jD(a)?uI.none():uI.from(a.querySelector(c)).map(rW.fromDom)}},h2=function(b,a){return b.dom()===a.dom()},hO=(bQ.detect().browser.isIE(),h2),qB=function(b){var a=b.dom();return uI.from(a.parentNode).map(rW.fromDom)},gh=function(b){var a=b.dom();return uI.from(a.previousSibling).map(rW.fromDom)},cZ=function(b){var a=b.dom();return uI.from(a.nextSibling).map(rW.fromDom)},eR=function(b){var a=b.dom();return ij(a.childNodes,rW.fromDom)},aD=function(c,b){var a=c.dom().childNodes;return uI.from(a[b]).map(rW.fromDom)},bW=dx("element","offset"),cK={owner:function(a){return rW.fromDom(a.dom().ownerDocument)},defaultView:function(b){var a=b.dom().ownerDocument.defaultView;return rW.fromDom(a)},documentElement:function(a){return rW.fromDom(a.dom().ownerDocument.documentElement)},parent:qB,findIndex:function(a){return qB(a).bind(function(c){var b=eR(c);return lF(b,function(d){return hO(a,d)})})},parents:function(h,f){for(var c=sR(f)?f:uC(!1),d=h.dom(),g=[];null!==d.parentNode&&d.parentNode!==undefined;){var b=d.parentNode,a=rW.fromDom(b);if(g.push(a),!0===c(a)){break}d=b}return g},siblings:function(a){return qB(a).map(eR).map(function(b){return i0(b,function(c){return !hO(a,c)})}).getOr([])},prevSibling:gh,offsetParent:function(b){var a=b.dom();return uI.from(a.offsetParent).map(rW.fromDom)},prevSiblings:function(a){return g8(m7(a,gh))},nextSibling:cZ,nextSiblings:function(a){return m7(a,cZ)},children:eR,child:aD,firstChild:function(a){return aD(a,0)},lastChild:function(a){return aD(a,a.dom().childNodes.length-1)},childNodesCount:function(a){return a.dom().childNodes.length},hasChildNodes:function(a){return a.dom().hasChildNodes()},leaf:function(c,b){var a=eR(c);return 0<a.length&&b<a.length?bW(a[b],0):bW(c,b)}},iQ=function(b,a){cK.parent(b).each(function(c){c.dom().insertBefore(a.dom(),b.dom())})},nU=function(b,a){b.dom().appendChild(a.dom())},a9={before:iQ,after:function(b,a){cK.nextSibling(b).fold(function(){cK.parent(b).each(function(c){nU(c,a)})},function(c){iQ(c,a)})},prepend:function(b,a){cK.firstChild(b).fold(function(){nU(b,a)},function(c){b.dom().insertBefore(a.dom(),c.dom())})},append:nU,appendAt:function(c,b,a){cK.child(c,a).fold(function(){nU(c,b)},function(d){iQ(d,b)})},wrap:function(b,a){iQ(b,a),nU(a,b)}},bG=function(a,b){jN(b,function(c){a9.before(a,c)})},gI=function(a,b){jN(b,function(c){a9.append(a,c)})},gY=function(b){var a=b.dom();null!==a.parentNode&&a.parentNode.removeChild(a)},eB={empty:function(a){a.dom().textContent="",jN(cK.children(a),function(b){gY(b)})},remove:gY,unwrap:function(b){var a=cK.children(b);0<a.length&&bG(b,a),gY(b)}},aT=function(b){oJ(b,nE());var a=b.components();jN(a,aT)},oP=function(b){var a=b.components();jN(a,oP),oJ(b,l5())},r2=function(b,a){lP(b,a,a9.append)},lP=function(c,b,a){c.getSystem().addToWorld(b),a(c.element(),b.element()),i9.inBody(c.element())&&oP(b),c.syncComponents()},nb=function(a){aT(a),eB.remove(a.element()),a.getSystem().removeFromWorld(a)},oy=function(a){var b=cK.parent(a.element()).bind(function(c){return a.getSystem().getByDom(c).fold(uI.none,uI.some)});nb(a),b.each(function(c){c.syncComponents()})},qH=function(a){return{is:function(b){return a===b},isValue:tE,isError:tB,getOr:uC(a),getOrThunk:uC(a),getOrDie:uC(a),or:function(b){return qH(a)},orThunk:function(b){return qH(a)},fold:function(c,b){return b(a)},map:function(b){return qH(b(a))},each:function(b){b(a)},bind:function(b){return b(a)},exists:function(b){return b(a)},forall:function(b){return b(a)},toOption:function(){return uI.some(a)}}},k0=function(a){return{is:tB,isValue:tB,isError:tE,getOr:tx,getOrThunk:function(b){return b()},getOrDie:function(){return tH(String(a))()},or:function(b){return b},orThunk:function(b){return b()},fold:function(c,b){return c(a)},map:function(b){return k0(a)},each:tk,bind:function(b){return k0(a)},exists:tB,forall:tE,toOption:uI.none}},uN={value:qH,error:k0},sY=function(c){if(!s3(c)){throw new Error("cases must be an array")}if(0===c.length){throw new Error("there must be at least one case")}var b=[],d={};return jN(c,function(j,f){var g=uB(j);if(1!==g.length){throw new Error("one and only one name per case")}var h=g[0],a=j[h];if(d[h]!==undefined){throw new Error("duplicate key detected:"+h)}if("cata"===h){throw new Error("cannot have a case named cata (sorry)")}if(!s3(a)){throw new Error("case arguments must be an array")}b.push(h),d[h]=function(){var l=arguments.length;if(l!==a.length){throw new Error("Wrong number of arguments to case "+h+". Expected "+a.length+" ("+a+"), got "+l)}for(var i=new Array(l),k=0;k<i.length;k++){i[k]=arguments[k]}return{fold:function(){if(arguments.length!==c.length){throw new Error("Wrong number of arguments to fold. Expected "+c.length+", got "+arguments.length)}return arguments[f].apply(null,i)},match:function(o){var m=uB(o);if(b.length!==m.length){throw new Error("Wrong number of arguments to match. Expected: "+b.join(",")+"\nActual: "+m.join(","))}if(!dY(b,function(e){return q1(m,e)})){throw new Error("Not all branches were specified when using match. Specified: "+m.join(", ")+"\nRequired: "+b.join(", "))}return o[h].apply(null,i)},log:function(e){console.log(e,{constructors:b,constructor:h,params:i})}}}}),d},mD=sY([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),rL=function(a){return mD.defaultedThunk(uC(a))},pE=mD.strict,sA=mD.asOption,o6=mD.defaultedThunk,rk=(mD.asDefaultedOptionThunk,mD.mergeWithThunk),kk=(sY([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(c){var b=[],a=[];return jN(c,function(d){d.fold(function(e){b.push(e)},function(e){a.push(e)})}),{errors:b,values:a}}),n0=function(a){return sS(uN.error,kQ)(a)},qW=function(f,c){var a,b,d=kk(f);return 0<d.errors.length?n0(d.errors):(a=d.values,b=c,uN.value(uG.apply(undefined,[b].concat(a))))},tW=function(b){var a=kk(b);return 0<a.errors.length?n0(a.errors):uN.value(a.values)},h5=function(a){return function(b){return b.hasOwnProperty(a)?uI.from(b[a]):uI.none()}},jG=function(b,a){return h5(a)(b)},iT=function(c,b){var a={};return a[c]=b,a},c5=function(d,c){return a=d,b={},jN(c,function(e){a[e]!==undefined&&a.hasOwnProperty(e)&&(b[e]=a[e])}),b;var a,b},dD=function(d,c){return a=c,b={},tS(d,function(g,f){q1(a,f)||(b[f]=g)}),b;var a,b},eX=function(a){return h5(a)},lw=function(d,c){return a=d,b=c,function(e){return h5(a)(e).getOr(b)};var a,b},pV=function(b,a){return jG(b,a)},jV=function(b,a){return iT(b,a)},kI=function(b){return a={},jN(b,function(c){a[c.key]=c.value}),a;var a},mS=function(b,a){return qW(b,a)},dU=function(d,c){return b=c,(a=d).hasOwnProperty(b)&&a[b]!==undefined&&null!==a[b];var a,b},fL=sY([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),g4=sY([{field:["name","presence","type"]},{state:["name"]}]),fq=function(){return hw.getOrDie("JSON")},l4=function(c,b,a){return fq().stringify(c,b,a)},i8=function(a){return tz(a)&&100<uB(a).length?" removed due to size":l4(a,null,2)},b2=function(b,a){return uN.error([{path:b,getErrorInfo:a}])},hN=sY([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),hz=function(a,b,c){return jG(b,c).fold(function(){return f=c,d=b,b2(a,function(){return'Could not find valid *strict* value for "'+f+'" in '+i8(d)});var f,d},uN.value)},qh=function(d,c,a){var b=jG(d,c).fold(function(){return a(d)},tx);return uN.value(b)},f1=function(d,b,f,e){return f.fold(function(g,j,k,c){var h=function(i){return c.extract(d.concat([g]),e,i).map(function(l){return iT(j,e(l))})},a=function(i){return i.fold(function(){var l=iT(j,e(uI.none()));return uN.value(l)},function(l){return c.extract(d.concat([g]),e,l).map(function(m){return iT(j,e(uI.some(m)))})})};return k.fold(function(){return hz(d,b,g).bind(h)},function(i){return qh(b,g,i).bind(h)},function(){return(l=b,i=g,uN.value(jG(l,i))).bind(a);var l,i},function(q){return(m=b,i=g,l=q,p=jG(m,i).map(function(o){return !0===o?l(m):o}),uN.value(p)).bind(a);var m,i,l,p},function(l){var i=l(b);return qh(b,g,uC({})).map(function(m){return uG(i,m)}).bind(h)})},function(g,c){var a=c(b);return uN.value(iT(g,e(a)))})},cN=function(a){return{extract:function(b,d,c){return a(c,d).fold(function(g){return f=g,b2(b,function(){return f});var f},uN.value)},toString:function(){return"val"},toDsl:function(){return fL.itemOf(a)}}},eH=function(d){var b=aj(d),a=db(d,function(c,f){return f.fold(function(e){return uG(c,jV(e,!0))},uC(c))},{});return{extract:function(m,k,h){var j,l,g,f=sP(h)?[]:(l=uB(j=h),i0(l,function(e){return dU(j,e)})),c=i0(f,function(e){return !dU(a,e)});return 0===c.length?b.extract(m,k,h):(g=c,b2(m,function(){return"There are unsupported fields: ["+g.join(", ")+"] specified"}))},toString:b.toString,toDsl:b.toDsl}},aj=function(b){return{extract:function(j,g,d){return f=j,h=d,c=g,a=ij(b,function(e){return f1(f,h,e,c)}),qW(a,{});var f,h,c,a},toString:function(){return"obj{\n"+ij(b,function(a){return a.fold(function(g,f,c,d){return g+" -> "+d.toString()},function(d,c){return"state("+d+")"})}).join("\n")+"}"},toDsl:function(){return fL.objOf(ij(b,function(a){return a.fold(function(g,f,c,d){return g4.field(g,c,d)},function(d,c){return g4.state(d)})}))}}},bM=function(b,a){var c=function(g,d){return(f=cN(b),{extract:function(h,i,k){var j=ij(k,function(m,l){return f.extract(h.concat(["["+l+"]"]),i,m)});return tW(j)},toString:function(){return"array("+f.toString()+")"},toDsl:function(){return fL.arrOf(f)}}).extract(g,tx,d);var f};return{extract:function(d,e,f){var g=uB(f);return c(d,g).bind(function(i){var h=ij(i,function(j){return hN.field(j,j,pE(),a)});return aj(h).extract(d,e,f)})},toString:function(){return"setOf("+a.toString()+")"},toDsl:function(){return fL.setOf(b,a)}}},cq=uC(cN(uN.value)),iB=hN.state,nK=hN.field,aZ=function(b,d,c,f,a){return pV(f,a).fold(function(){return h=f,g=a,b2(b,function(){return'The chosen schema: "'+g+'" did not exist in branches: '+i8(h)});var h,g},function(e){return aj(e).extract(b.concat(["branch: "+a]),d,c)})},bw=function(b,a){return{extract:function(f,c,d){return pV(d,b).fold(function(){return e=b,b2(f,function(){return'Choice schema did not contain choice key: "'+e+'"'});var e},function(e){return aZ(f,c,d,a,e)})},toString:function(){return"chooseOn("+b+"). Possible values: "+uB(a)},toDsl:function(){return fL.choiceOf(b,a)}}},gy=cN(uN.value),gO=function(d,c,a,b){return c.extract([d],a,b).fold(function(e){return uN.error({input:b,errors:e})},uN.value)},eb=function(c,b,a){return gO(c,b,uC,a)},aJ=function(a){return a.fold(function(b){throw new Error(lS(b))},tx)},oR=function(c,b,a){return aJ(gO(c,b,tx,a))},r4=function(c,b,a){return aJ(eb(c,b,a))},lS=function(c){return"Errors: \n"+(b=c.errors,a=10<b.length?b.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):b,ij(a,function(d){return"Failed path: ("+d.path.join(" > ")+")\n"+d.getErrorInfo()}))+"\n\nInput object: "+i8(c.input);var b,a},nk=function(b,a){return bw(b,a)},oA=uC(gy),qJ=(tw=sR,sU="function",cN(function(b){var a=typeof b;return tw(b)?uN.value(b):uN.error("Expected type: "+sU+" but got: "+a)})),k3=function(a){return nK(a,a,pE(),cq())},uP=function(b,a){return nK(b,b,pE(),a)},s2=function(a){return uP(a,qJ)},mG=function(b,a){return nK(b,b,pE(),aj(a))},rN=function(a){return nK(a,a,sA(),cq())},pG=function(b,a){return nK(b,b,sA(),aj(a))},sC=function(b,a){return nK(b,b,sA(),eH(a))},o8=function(b,a){return nK(b,b,rL(a),cq())},rw=function(c,b,a){return nK(c,c,rL(b),a)},kw=function(b,a){return iB(b,a)},n2=function(a){if(!dU(a,"can")&&!dU(a,"abort")&&!dU(a,"run")){throw new Error("EventHandler defined by: "+l4(a,null,2)+" does not have can, abort, or run!")}return oR("Extracting event.handler",eH([o8("can",uC(!0)),o8("abort",uC(!1)),o8("run",tk)]),a)},qY=function(c){var f,d,g,b,h=(f=c,d=function(e){return e.can},function(){for(var e=[],i=0;i<arguments.length;i++){e[i]=arguments[i]}return dI(f,function(k,j){return k&&d(j).apply(undefined,e)},!0)}),a=(g=c,b=function(e){return e.abort},function(){for(var e=[],i=0;i<arguments.length;i++){e[i]=arguments[i]}return dI(g,function(k,j){return k||b(j).apply(undefined,e)},!1)});return n2({can:h,abort:a,run:function(){for(var i=[],j=0;j<arguments.length;j++){i[j]=arguments[j]}jN(c,function(e){e.run.apply(undefined,i)})}})},t0=function(a){return kI(a)},h8=function(b,a){return{key:b,value:n2({abort:a})}},jJ=function(b,a){return{key:b,value:n2({run:a})}},iW=function(c,b,a){return{key:c,value:n2({run:function(d){b.apply(undefined,[d].concat(a))}})}},c7=function(a){return function(b){return{key:a,value:n2({run:function(f,d){var c;c=d,hO(f.element(),c.event().target())&&b(f,d)}})}}},dF=function(g,d,b){var a,c,f=d.partUids()[b];return c=f,jJ(a=g,function(h,e){h.getSystem().getByUid(c).each(function(m){var k,i,j,l;i=(k=m).element(),j=a,l=e,k.getSystem().triggerEvent(j,i,l.event())})})},eZ=function(a){return jJ(a,function(c,b){b.cut()})},lA=c7(l5()),pX=c7(nE()),jZ=c7(o0()),kM=(tK=bA(),function(a){return jJ(tK,a)}),mW=function(a){return ij(a,function(g){return c=d="/*",f=(b=g).length-d.length,""!==c&&(b.length<c.length||b.substr(f,f+c.length)!==c)?g:g.substring(0,g.length-"/*".length);var d,b,c,f})},dW=function(g,d){var b=g.toString(),c=b.indexOf(")")+1,f=b.indexOf("("),a=b.substring(f+1,c-1).split(/,\s*/);return g.toFunctionAnnotation=function(){return{name:d,parameters:mW(a)}},g},fN=kX(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]),g6=function(a){return{tag:a.tag(),classes:a.classes().getOr([]),attributes:a.attributes().getOr({}),styles:a.styles().getOr({}),value:a.value().getOr("<none>"),innerHtml:a.innerHtml().getOr("<none>"),defChildren:a.defChildren().fold(function(){return"<none>"},function(b){return l4(b,null,2)}),domChildren:a.domChildren().fold(function(){return"<none>"},function(b){return 0===b.length?"0 children, but still specified":String(b.length)})}},fx=kX([],["classes","attributes","styles","value","innerHtml","defChildren","domChildren"]),l8=function(b,c,a){return c.fold(function(){return a.fold(function(){return{}},function(d){return jV(b,d)})},function(d){return a.fold(function(){return jV(b,d)},function(e){return jV(b,e)})})},jj=function(a,b,c){return jZ(function(f,d){c(f,a,b)})},b4=function(f,h,m,b,d,g){var l,k,j=f,p=pG(h,[(l="config",k=f,nK(l,l,sA(),k))]);return qk(j,p,h,m,b,d,g)},hR=function(d,g,l){var f,h,m,b,k,j;return f=function(a){for(var o=[],i=1;i<arguments.length;i++){o[i-1]=arguments[i]}var c=[a].concat(o);return a.config({name:uC(d)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+d+". Using API: "+l)},function(q){var p=Array.prototype.slice.call(c,1);return g.apply(undefined,[a,q.config,q.state].concat(p))})},h=l,m=g.toString(),b=m.indexOf(")")+1,k=m.indexOf("("),j=m.substring(k+1,b-1).split(/,\s*/),f.toFunctionAnnotation=function(){return{name:h,parameters:mW(j.slice(0,1).concat(j.slice(3)))}},f},hC=function(a){return{key:a,value:undefined}},qk=function(q,g,b,d,k,h,p){var m=function(a){return dU(a,b)?a[b]():uI.none()},l=ux(k,function(c,a){return hR(b,c,a)}),v=ux(h,function(c,a){return dW(c,a)}),j=uG(v,l,{revoke:th(hC,b),config:function(c){var a=r4(b+"-config",q,c);return{key:b,value:{config:a,me:j,configAsRaw:tN(function(){return oR(b+"-config",q,c)}),initialConfig:c,state:p}}},schema:function(){return g},exhibit:function(c,a){return m(c).bind(function(f){return pV(d,"exhibit").map(function(e){return e(a,f.config,f.state)})}).getOr(fx({}))},name:function(){return b},handlers:function(a){return m(a).bind(function(c){return pV(d,"events").map(function(e){return e(c.config,c.state)})}).getOr({})}});return j},f3=function(b,a){return cQ(b,a,{validate:sR,label:"function"})},cQ=function(b,c,a){if(0===c.length){throw new Error("You must specify at least one required field.")}return p5("required",c),kb(c),function(f){var d=uB(f);dY(c,function(e){return q1(d,e)})||e8(c,d),b(c,d);var g=i0(c,function(e){return !a.validate(f[e],e)});return 0<g.length&&function(i,h){throw new Error("All values need to be of type: "+h+". Keys ("+dO(i).join(", ")+") were not.")}(g,a.label),f}},eJ=function(b,c){var a=i0(c,function(d){return !q1(b,d)});0<a.length&&lM(a)},aq=tk,bO=function(a){return f3(eJ,a)},cz={init:function(){return iF({readState:function(){return"No State required"}})}},iF=function(a){return f3(aq,["readState"])(a),a},nM=function(a){return kI(a)},a1=eH([k3("fields"),k3("name"),o8("active",{}),o8("apis",{}),o8("state",cz),o8("extra",{})]),by=function(f){var h,m,b,d,g,l,k,j,p=oR("Creating behaviour: "+f.name,a1,f);return h=p.fields,m=p.name,b=p.active,d=p.apis,g=p.extra,l=p.state,k=eH(h),j=pG(m,[sC("config",h)]),qk(k,j,m,b,d,g,l)},gA=eH([k3("branchKey"),k3("branches"),k3("name"),o8("active",{}),o8("apis",{}),o8("state",cz),o8("extra",{})]),gQ=uC(undefined);function ej(g,d,b){var c=b||!1,f=function(){d(),c=!0},a=function(){g(),c=!1};return{on:f,off:a,toggle:function(){(c?a:f)()},isOn:function(){return c}}}var aL=function(c,b,a){if(!(tI(a)||sP(a)||sQ(a))){throw console.error("Invalid call to Attr.set. Key ",b,":: Value ",a,":: Element ",c),new Error("Attribute value was not simple")}c.setAttribute(b,a+"")},oT=function(c,b,a){aL(c.dom(),b,a)},r6=function(c,b){var a=c.dom().getAttribute(b);return null===a?undefined:a},lV=function(c,b){var a=c.dom();return !(!a||!a.hasAttribute)&&a.hasAttribute(b)},nx={clone:function(a){return dI(a.dom().attributes,function(c,b){return c[b.name]=b.value,c},{})},set:oT,setAll:function(c,b){var a=c.dom();tS(b,function(f,d){aL(a,d,f)})},get:r6,has:lV,remove:function(b,a){b.dom().removeAttribute(a)},hasNone:function(b){var a=b.dom().attributes;return a===undefined||null===a||0===a.length},transfer:function(b,a,c){uD.isElement(b)&&uD.isElement(a)&&jN(c,function(h){var g,d,f;d=a,lV(g=b,f=h)&&!lV(d,f)&&oT(d,f,r6(g,f))})}},oC=function(c,b){var a=nx.get(c,b);return a===undefined||""===a?[]:a.split(" ")},qL=oC,k6=function(d,c,a){var b=oC(d,c).concat([a]);return nx.set(d,c,b.join(" ")),!0},uR=function(d,c,a){var b=i0(oC(d,c),function(e){return e!==a});return 0<b.length?nx.set(d,c,b.join(" ")):nx.remove(d,c),!1},s7=function(a){return qL(a,"class")},mJ=function(b,a){return k6(b,"class",a)},rP=function(b,a){return uR(b,"class",a)},pI=s7,pb=mJ,ry=rP,kz=function(b,a){return q1(s7(b),a)?rP(b,a):mJ(b,a)},n4=function(a){return a.dom().classList!==undefined},q0=function(b,a){return n4(b)&&b.dom().classList.contains(a)},t5={add:function(b,a){n4(b)?b.dom().classList.add(a):pb(b,a)},remove:function(c,b){var a;n4(c)?c.dom().classList.remove(b):ry(c,b),0===(n4(a=c)?a.dom().classList:pI(a)).length&&nx.remove(a,"class")},toggle:function(b,a){return n4(b)?b.dom().classList.toggle(a):kz(b,a)},toggler:function(d,c){var a=n4(d),b=d.dom().classList;return ej(function(){a?b.remove(c):ry(d,c)},function(){a?b.add(c):pb(d,c)},q0(d,c))},has:q0},ih=function(c,b,a){t5.remove(c,a),t5.add(c,b)},jM=Object.freeze({toAlpha:function(c,b,a){ih(c.element(),b.alpha(),b.omega())},toOmega:function(c,b,a){ih(c.element(),b.omega(),b.alpha())},isAlpha:function(c,b,a){return t5.has(c.element(),b.alpha())},isOmega:function(c,b,a){return t5.has(c.element(),b.omega())},clear:function(c,b,a){t5.remove(c.element(),b.alpha()),t5.remove(c.element(),b.omega())}}),iZ=[k3("alpha"),k3("omega")],c9=by({fields:iZ,name:"swapping",apis:jM}),dH=function(c){var b=c,a=function(){return b};return{get:a,set:function(d){b=d},clone:function(){return dH(a())}}};function e1(f,c,a,b,d){return f(a,b)?uI.some(a):sR(d)&&d(a)?uI.none():c(a,b,d)}var lE=function(g,d,b){for(var c=g.dom(),f=sR(b)?b:uC(!1);c.parentNode;){c=c.parentNode;var a=rW.fromDom(c);if(d(a)){return uI.some(a)}if(f(a)){break}}return uI.none()},pY=function(b,a){return e2(b.dom().childNodes,sS(a,rW.fromDom)).map(rW.fromDom)},j2=function(c,a){var b=function(g){for(var f=0;f<g.childNodes.length;f++){if(a(rW.fromDom(g.childNodes[f]))){return uI.some(rW.fromDom(g.childNodes[f]))}var d=b(g.childNodes[f]);if(d.isSome()){return d}}return uI.none()};return b(c.dom())},kP={first:function(a){return j2(i9.body(),a)},ancestor:lE,closest:function(c,b,a){return e1(function(d){return b(d)},lE,c,b,a)},sibling:function(b,a){var c=b.dom();return c.parentNode?pY(rW.fromDom(c.parentNode),function(d){return !hO(b,d)&&a(d)}):uI.none()},child:pY,descendant:j2},mZ=function(a){a.dom().focus()},dX=function(b){var a=b!==undefined?b.dom():document;return uI.from(a.activeElement).map(rW.fromDom)},fO=function(b){var a=cK.owner(b).dom();return b.dom()===a.activeElement},g7=mZ,fy=function(a){a.dom().blur()},mh=dX,jq=function(a){return dX(cK.owner(a)).filter(function(b){return a.dom().contains(b.dom())})},b5=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),hU=tinymce.util.Tools.resolve("tinymce.ThemeManager"),hE=function(c){var b=document.createElement("a");b.target="_blank",b.href=c.href,b.rel="noreferrer noopener";var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.body.appendChild(b),b.dispatchEvent(a),document.body.removeChild(b)},qp={formatChanged:uC("formatChanged"),orientationChanged:uC("orientationChanged"),dropupDismissed:uC("dropupDismissed")},f4=function(c,b){var a=(b||document).createElement("div");return a.innerHTML=c,cK.children(rW.fromDom(a))},cS=function(a){return a.dom().innerHTML},eK=cS,aw=function(f,c){var a=cK.owner(f).dom(),b=rW.fromDom(a.createDocumentFragment()),d=f4(c,a);gI(b,d),eB.empty(f),a9.append(f,b)},bP=function(c){var b=rW.fromTag("div"),a=rW.fromDom(c.dom().cloneNode(!0));return a9.append(b,a),cS(b)},cC=function(b,a){return rW.fromDom(b.dom().cloneNode(a))},iI=function(a){return cC(a,!1)},nN=function(b){return a=iI(b),bP(a);var a},a2=Object.freeze({events:function(b){return t0([jJ(a3(),function(h,d){var j,g,a=b.channels(),c=uB(a),f=(j=c,(g=d).universal()?j:i0(j,function(e){return q1(g.channels(),e)}));jN(f,function(m){var l=a[m](),i=l.schema(),k=r4("channel["+m+"] data\nReceiver: "+nN(h.element()),i,d.data());l.onReceive()(h,k)})})])}}),bz=function(d){for(var c=[],a=function(e){c.push(e)},b=0;b<d.length;b++){d[b].each(a)}return c},gB=function(d,c){for(var a=0;a<d.length;a++){var b=c(d[a],a);if(b.isSome()){return b}}return uI.none()},gR="unknown",ek=[],aM=["alloy/data/Fields","alloy/debugging/Debugging"],oX={logEventCut:tk,logEventStopped:tk,logNoParent:tk,logEventNoHandlers:tk,logEventResponse:tk,write:tk},sb=function(g,d,b){var c,f="*"===ek||q1(ek,g)?(c=[],{logEventCut:function(j,i,h){c.push({outcome:"cut",target:i,purpose:h})},logEventStopped:function(j,i,h){c.push({outcome:"stopped",target:i,purpose:h})},logNoParent:function(j,i,h){c.push({outcome:"no-parent",target:i,purpose:h})},logEventNoHandlers:function(i,h){c.push({outcome:"no-handlers-left",target:h})},logEventResponse:function(j,i,h){c.push({outcome:"response",purpose:h,target:i})},write:function(){q1(["mousemove","mouseover","mouseout",o0()],g)||console.log(g,{event:g,target:d.dom(),sequence:ij(c,function(e){return q1(["cut","stopped","response"],e.outcome)?"{"+e.purpose+"} "+e.outcome+" at ("+nN(e.target)+")":e.outcome})})}}):oX,a=b(f);return f.write(),a},lZ=uC([k3("menu"),k3("selectedMenu")]),nB=uC([k3("item"),k3("selectedItem")]),oG=(uC(eH(nB().concat(lZ()))),uC(eH(nB()))),qO=mG("initSize",[k3("numColumns"),k3("numRows")]),lb=function(d,c,a){var b;return function(){var g=new Error;if(g.stack!==undefined){var f=g.stack.split("\n");e2(f,function(h){return 0<h.indexOf("alloy")&&!t7(aM,function(e){return -1<h.indexOf(e)})}).getOr(gR)}}(),nK(c,c,a,(b=function(e){return uN.value(function(){for(var g=[],f=0;f<arguments.length;f++){g[f]=arguments[f]}return e.apply(undefined,g)})},cN(function(e){return b(e)})))},uV=function(a){return lb(0,a,rL(tk))},ty=function(a){return lb(0,a,rL(uI.none))},mN=function(a){return lb(0,a,pE())},rT=function(a){return lb(0,a,pE())},pM=function(b,a){return kw(b,uC(a))},sH=function(a){return kw(a,tx)},pq=uC(qO),rC=[uP("channels",bM(uN.value,eH([mN("onReceive"),o8("schema",oA())])))],kD=by({fields:rC,name:"receiving",active:a2}),n8=function(d,c){var a=jQ(d,c),b=c.aria();b.update()(d,b,a)},q4=function(c,b,a){t5.toggle(c.element(),b.toggleClass()),n8(c,b)},uw=function(c,b,a){t5.add(c.element(),b.toggleClass()),n8(c,b)},iw=function(c,b,a){t5.remove(c.element(),b.toggleClass()),n8(c,b)},jQ=function(b,a){return t5.has(b.element(),a.toggleClass())},i3=function(c,b,a){(b.selected()?uw:iw)(c,b,a)},dk=Object.freeze({onLoad:i3,toggle:q4,isOn:jQ,on:uw,off:iw}),dL=Object.freeze({exhibit:function(c,b,a){return fx({})},events:function(h,f){var c,d,g,b=(c=h,d=f,g=q4,kM(function(e){g(e,c,d)})),a=jj(h,f,i3);return t0(kQ([h.toggleOnExecute()?[b]:[],[a]]))}}),e5=function(c,b,a){nx.set(c.element(),"aria-expanded",a)},lI=[o8("selected",!1),k3("toggleClass"),o8("toggleOnExecute",!0),rw("aria",{mode:"none"},nk("mode",{pressed:[o8("syncWithExpanded",!1),pM("update",function(c,b,a){nx.set(c.element(),"aria-pressed",a),b.syncWithExpanded()&&e5(c,b,a)})],checked:[pM("update",function(c,b,a){nx.set(c.element(),"aria-checked",a)})],expanded:[pM("update",e5)],selected:[pM("update",function(c,b,a){nx.set(c.element(),"aria-selected",a)})],none:[pM("update",tk)]}))],p2=by({fields:lI,name:"toggling",active:dL,apis:dk}),j6=function(a,b){return kD.config({channels:jV(qp.formatChanged(),{onReceive:function(d,c){c.command===a&&b(d,c.state)}})})},kT=function(a){return kD.config({channels:jV(qp.orientationChanged(),{onReceive:a})})},m3=function(b,a){return{key:b,value:{onReceive:a}}},d1="tinymce-mobile",fS={resolve:function(a){return d1+"-"+a},prefix:uC(d1)},hh=function(b,a){a.ignore()||(g7(b.element()),a.onFocus()(b))},fC=Object.freeze({focus:hh,blur:function(b,a){a.ignore()||fy(b.element())},isFocused:function(a){return fO(a.element())}}),mw=Object.freeze({exhibit:function(b,a){return a.ignore()?fx({}):fx({attributes:{tabindex:"-1"}})},events:function(a){return t0([jJ(iJ(),function(c,b){hh(c,a),b.stop()})])}}),jz=[uV("onFocus"),o8("ignore",!1)],b9=by({fields:jz,name:"focusing",active:mw,apis:fC}),hY=function(a){return a.style!==undefined},hI=function(c,b,a){if(!tI(a)){throw console.error("Invalid call to CSS.set. Property ",b,":: Value ",a,":: Element ",c),new Error("CSS value must be a string: "+a)}hY(c)&&c.style.setProperty(b,a)},qy=function(b,a){hY(b)&&b.style.removeProperty(a)},f8=function(d,c,a){var b=d.dom();hI(b,c,a)},cW=function(b,a){return hY(b)?b.style.getPropertyValue(a):""},eO=function(d,c){var a=d.dom(),b=cW(a,c);return uI.from(b).filter(function(e){return 0<e.length})},aA={copy:function(d,c){var a=d.dom(),b=c.dom();hY(a)&&hY(b)&&(b.style.cssText=a.style.cssText)},set:f8,preserve:function(d,c){var a=nx.get(d,"style"),b=c(d);return(a===undefined?nx.remove:nx.set)(d,"style",a),b},setAll:function(c,b){var a=c.dom();tS(b,function(f,d){hI(a,d,f)})},setOptions:function(c,b){var a=c.dom();tS(b,function(f,d){f.fold(function(){qy(a,d)},function(e){hI(a,d,e)})})},remove:function(c,b){var a=c.dom();qy(a,b),nx.has(c,"style")&&""===nx.get(c,"style").replace(/^\s+|\s+$/g,"")&&nx.remove(c,"style")},get:function(f,c){var a=f.dom(),b=window.getComputedStyle(a).getPropertyValue(c),d=""!==b||i9.inBody(f)?b:cW(a,c);return null===d?undefined:d},getRaw:eO,getAllRaw:function(f){var c={},a=f.dom();if(hY(a)){for(var b=0;b<a.style.length;b++){var d=a.style.item(b);c[d]=a.style[d]}}return c},isValidValue:function(d,c,a){var b=rW.fromTag(d);return f8(b,c,a),eO(b,c).isSome()},reflow:function(a){return a.dom().offsetWidth},transfer:function(a,b,c){uD.isElement(a)&&uD.isElement(b)&&jN(c,function(g){var f,d;f=b,eO(a,d=g).each(function(e){eO(f,d).isNone()&&f8(f,d,e)})})}};function bT(b,c){var d=function(h){var g=c(h);if(g<=0||null===g){var f=aA.get(h,b);return parseFloat(f)||0}return g},a=function(e,f){return dI(f,function(j,i){var g=aA.get(e,i),h=g===undefined?0:parseInt(g,10);return isNaN(h)?j:j+h},0)};return{set:function(h,g){if(!sQ(g)&&!g.match(/^[0-9]+$/)){throw b+".set accepts only positive integer values. Value was "+g}var f=h.dom();hY(f)&&(f.style[b]=g+"px")},get:d,getOuter:d,aggregate:a,max:function(i,h,f){var g=a(i,f);return g<h?h-g:0}}}var cG,iM,nR=bT("height",function(b){var a=b.dom();return i9.inBody(b)?a.getBoundingClientRect().height:a.offsetHeight}),a6=function(a){return nR.get(a)},bD=function(c,b,a){return i0(cK.parents(c,a),b)},gF=function(b,a){return i0(cK.siblings(b),a)},gV=function(a){return cw.all(a)},ey=function(c,b,a){return bD(c,function(d){return cw.is(d,b)},a)},aQ=function(b,a){return gF(b,function(c){return cw.is(c,a)})},oO=function(b,a){return cw.all(a,b)},r1=function(c,b,a){return kP.ancestor(c,function(d){return cw.is(d,b)},a)},lN=function(a){return cw.one(a)},m8=r1,ox=function(b,a){return cw.one(a,b)},qG=function(c,b,a){return e1(cw.is,r1,c,b,a)},kY=function(f,c,a){var b=g8(f.slice(0,c)),d=g8(f.slice(c+1));return e2(b.concat(d),a)},uM=function(d,c,a){var b=g8(d.slice(0,c));return e2(b,a)},sW=function(f,c,a){var b=f.slice(0,c),d=f.slice(c+1);return e2(d.concat(b),a)},mB=function(d,c,a){var b=d.slice(c+1);return e2(b,a)},rK=function(a){return function(c){var b=c.raw();return q1(a,b.which)}},pD=function(a){return function(b){return dY(a,function(c){return c(b)})}},sz=function(a){return !0===a.raw().shiftKey},o5=function(a){return !0===a.raw().ctrlKey},rj=tV(sz),kh=function(b,a){return{matches:b,classification:a}},nZ=function(f,c,a,b){var d=f+c;return b<d?a:d<a?b:d},qV=function(c,b,a){return c<=b?b:a<=c?a:c},tU=function(c,a,d){var b=oO(c.element(),"."+a.highlightClass());jN(b,function(e){t5.remove(e,a.highlightClass()),c.getSystem().getByDom(e).each(function(f){a.onDehighlight()(c,f)})})},h3=function(f,c,a,b){var d=jE(f,c,a,b);tU(f,c),t5.add(b.element(),c.highlightClass()),d||c.onHighlight()(f,b)},jE=function(d,c,a,b){return t5.has(b.element(),c.highlightClass())},iR=function(f,c,a,b){var d=oO(f.element(),"."+c.itemClass());return uI.from(d[b]).fold(function(){return uN.error("No element found with index "+b)},f.getSystem().getByDom)},c4=function(b,c,a){return ox(b.element(),"."+c.itemClass()).bind(function(d){return b.getSystem().getByDom(d).toOption()})},dC=function(c,d,a){var b=oO(c.element(),"."+d.itemClass());return(0<b.length?uI.some(b[b.length-1]):uI.none()).bind(function(e){return c.getSystem().getByDom(e).toOption()})},eW=function(a,c,f,b){var d=oO(a.element(),"."+c.itemClass());return lF(d,function(e){return t5.has(e,c.highlightClass())}).bind(function(h){var g=nZ(h,b,0,d.length-1);return a.getSystem().getByDom(d[g]).toOption()})},lq=Object.freeze({dehighlightAll:tU,dehighlight:function(f,c,a,b){var d=jE(f,c,a,b);t5.remove(b.element(),c.highlightClass()),d&&c.onDehighlight()(f,b)},highlight:h3,highlightFirst:function(c,a,b){c4(c,a,b).each(function(d){h3(c,a,b,d)})},highlightLast:function(c,a,b){dC(c,a,b).each(function(d){h3(c,a,b,d)})},highlightAt:function(c,a,b,d){iR(c,a,b,d).fold(function(e){throw new Error(e)},function(e){h3(c,a,b,e)})},highlightBy:function(d,b,c,g){var f=oO(d.element(),"."+b.itemClass()),a=bz(ij(f,function(e){return d.getSystem().getByDom(e).toOption()}));e2(a,g).each(function(e){h3(d,b,c,e)})},isHighlighted:jE,getHighlighted:function(b,c,a){return ox(b.element(),"."+c.highlightClass()).bind(function(d){return b.getSystem().getByDom(d).toOption()})},getFirst:c4,getLast:dC,getPrevious:function(c,b,a){return eW(c,b,0,-1)},getNext:function(c,b,a){return eW(c,b,0,1)}}),pU=[k3("highlightClass"),k3("itemClass"),uV("onHighlight"),uV("onDehighlight")],jU=by({fields:pU,name:"highlighting",apis:lq}),kH=function(){return{get:function(a){return jq(a.element())},set:function(b,a){b.getSystem().triggerFocus(a,b.element())}}},mR=function(k,h,b,f,g,d){var c=function(q,m,p,s){var v,l,a=b(q,m,p,s);return(v=a,l=m.event(),e2(v,function(e){return e.matches(l)}).map(function(e){return e.classification})).bind(function(e){return e(q,m,p,s)})},j={schema:function(){return k.concat([o8("focusManager",kH()),pM("handler",j),pM("state",h)])},processKey:c,toEvents:function(a,l){var m=f(a,l),i=t0(d.map(function(e){return jJ(iJ(),function(p,o){e(p,a,l,o),o.stop()})}).toArray().concat([jJ(s1(),function(p,o){c(p,o,a,l).each(function(e){o.stop()})})]));return uG(m,i)},toApis:g};return j},dT=function(k){var h=[rN("onEscape"),rN("onEnter"),o8("selector",'[data-alloy-tabstop="true"]'),o8("firstTabstop",0),o8("useTabstopAt",uC(!0)),rN("visibilitySelector")].concat([k]),c=function(l,i){var a=l.visibilitySelector().bind(function(e){return qG(i,e)}).getOr(i);return 0<a6(a)},b=function(l,p,a,i,m){return m(p,a,function(r){return c(q=i,o=r)&&q.useTabstopAt()(o);var q,o}).fold(function(){return i.cyclic()?uI.some(!0):uI.none()},function(e){return i.focusManager().set(l,e),uI.some(!0)})},f=function(q,v,m,p){var s,l,a=oO(q.element(),m.selector());return(s=q,l=m,l.focusManager().get(s).bind(function(e){return qG(e,l.selector())})).bind(function(e){return lF(a,th(hO,e)).bind(function(i){return b(q,a,i,m,p)})})},d=uC([kh(pD([sz,rK([9])]),function(p,l,a,i){var m=a.cyclic()?kY:uM;return f(p,0,a,m)}),kh(rK([9]),function(p,l,a,i){var m=a.cyclic()?sW:mB;return f(p,0,a,m)}),kh(rK([27]),function(l,a,m,i){return m.onEscape().bind(function(e){return e(l,a)})}),kh(pD([rj,rK([13])]),function(l,a,m,i){return m.onEnter().bind(function(e){return e(l,a)})})]),g=uC({}),j=uC({});return mR(h,cz.init,d,g,j,uI.some(function(p,l){var s,m,q,a;(s=p,m=l,q=oO(s.element(),m.selector()),a=i0(q,function(e){return c(m,e)}),uI.from(a[m.firstTabstop()])).each(function(e){l.focusManager().set(p,e)})}))},fK=dT(kw("cyclic",uC(!1))),g3=dT(kw("cyclic",uC(!0))),fk=function(a){return"input"===uD.name(a)&&"radio"!==nx.get(a,"type")||"textarea"===uD.name(a)},l3=function(c,b,a){return fk(a)&&rK([32])(b.event())?uI.none():(uY(c,a,bA()),uI.some(!0))},i7=[o8("execute",l3),o8("useSpace",!1),o8("useEnter",!0),o8("useControlEnter",!1),o8("useDown",!1)],b1=function(c,b,a){return a.execute()(c,b,c.element())},hM=uC({}),hx=uC({}),qb=mR(i7,cz.init,function(k,h,f,g){var j=f.useSpace()&&!fk(k.element())?[32]:[],d=f.useEnter()?[13]:[],c=f.useDown()?[40]:[],b=j.concat(d).concat(c);return[kh(rK(b),b1)].concat(f.useControlEnter()?[kh(pD([o5,rK([13])]),b1)]:[])},hM,hx,uI.none()),f0=function(b){var a=dH(uI.none());return iF({readState:uC({}),setGridSize:function(d,c){a.set(uI.some({numRows:uC(d),numColumns:uC(c)}))},getNumRows:function(){return a.get().map(function(c){return c.numRows()})},getNumColumns:function(){return a.get().map(function(c){return c.numColumns()})}})},cL=Object.freeze({flatgrid:f0,init:function(a){return a.state()(a)}}),eG=function(a){return"rtl"===aA.get(a,"direction")?"rtl":"ltr"},ah=function(b,a){return function(c){return"rtl"===eG(c)?a:b}},bL=function(a){return function(g,d,b,c){var f=a(g.element());return aY(f,g,d,b,c)}},ck=function(c,b){var a=ah(c,b);return bL(a)},iA=function(c,b){var a=ah(b,c);return bL(a)},nJ=function(a){return function(f,d,b,c){return aY(a,f,d,b,c)}},aY=function(c,a,f,b,d){return b.focusManager().get(a).bind(function(e){return c(a.element(),e,b,d)}).map(function(e){return b.focusManager().set(a,e),!0})},bq=nJ,gx=nJ,gN=nJ,d9=function(c){var b,a=c.dom();return !((b=a).offsetWidth<=0&&b.offsetHeight<=0)},aI=kX(["index","candidates"],[]),o3=function(c,b,a){return sx(c,b,a,d9)},sx=function(k,h,f,g){var j,d=th(hO,h),c=oO(k,f),b=i0(c,d9);return lF(j=b,d).map(function(a){return aI({index:a,candidates:j})})},mb=function(b,a){return lF(b,function(c){return hO(a,c)})},nH=function(a,d,b,c){return c(Math.floor(d/b),d%b).bind(function(g){var f=g.row()*b+g.column();return 0<=f&&f<a.length?uI.some(a[f]):uI.none()})},oM=function(e,f,d,c,b){return nH(e,f,c,function(i,h){var a=i===d-1?e.length-i*c:c,g=nZ(h,b,0,a-1);return uI.some({row:uC(i),column:uC(g)})})},qT=function(e,g,d,b,f){return nH(e,g,b,function(j,h){var a=nZ(j,f,0,d-1),c=a===d-1?e.length-a*b:b,i=qV(h,0,c-1);return uI.some({row:uC(a),column:uC(i)})})},lD=[k3("selector"),o8("execute",l3),ty("onEscape"),o8("captureTab",!1),pq()],u2=function(a){return function(f,d,b,c){return o3(f,d,b.selector()).bind(function(e){return a(e.candidates(),e.index(),c.getNumRows().getOr(b.initSize().numRows()),c.getNumColumns().getOr(b.initSize().numColumns()))})}},tL=function(d,c,a,b){return a.captureTab()?uI.some(!0):uI.none()},mY=u2(function(d,c,a,b){return oM(d,c,a,b,-1)}),rZ=u2(function(d,c,a,b){return oM(d,c,a,b,1)}),pS=u2(function(d,c,a,b){return qT(d,c,a,b,-1)}),sN=u2(function(d,c,a,b){return qT(d,c,a,b,1)}),pB=uC([kh(rK([37]),ck(mY,rZ)),kh(rK([39]),iA(mY,rZ)),kh(rK([38]),bq(pS)),kh(rK([40]),gx(sN)),kh(pD([sz,rK([9])]),tL),kh(pD([rj,rK([9])]),tL),kh(rK([27]),function(d,c,a,b){return a.onEscape()(d,c)}),kh(rK([32].concat([13])),function(d,b,c,g){return(f=d,a=c,a.focusManager().get(f).bind(function(e){return qG(e,a.selector())})).bind(function(e){return c.execute()(d,b,e)});var f,a})]),rI=uC({}),kO=mR(lD,f0,pB,rI,{},uI.some(function(b,a,c){ox(b.element(),a.selector()).each(function(d){a.focusManager().set(b,d)})})),oq=function(d,b,a,c){return o3(d,a,b).bind(function(i){var h=i.index(),f=i.candidates(),g=nZ(h,c,0,f.length-1);return uI.from(f[g])})},rb=[k3("selector"),o8("getInitial",uI.none),o8("execute",l3),o8("executeOnMove",!1),o8("allowVertical",!0)],uK=function(c,a,b){return(f=c,d=b,d.focusManager().get(f).bind(function(e){return qG(e,d.selector())})).bind(function(e){return b.execute()(c,a,e)});var f,d},iH=function(c,b,a){return oq(c,a.selector(),b,-1)},j1=function(c,b,a){return oq(c,a.selector(),b,1)},jp=function(a){return function(d,c,b){return a(d,c,b).bind(function(){return b.executeOnMove()?uK(d,c,b):uI.some(!0)})}},dA=uC({}),dR=uC({}),fh=mR(rb,cz.init,function(g,d,b,c){var f=[37].concat(b.allowVertical()?[38]:[]),a=[39].concat(b.allowVertical()?[40]:[]);return[kh(rK(f),jp(ck(iH,j1))),kh(rK(a),jp(iA(iH,j1))),kh(rK([13]),uK),kh(rK([32]),uK)]},dA,dR,uI.some(function(b,a){a.getInitial()(b).or(ox(b.element(),a.selector())).each(function(c){a.focusManager().set(b,c)})})),lT=kX(["rowIndex","columnIndex","cell"],[]),p8=function(c,b,a){return uI.from(c[b]).bind(function(d){return uI.from(d[a]).map(function(e){return lT({rowIndex:b,columnIndex:a,cell:e})})})},kx=function(g,d,b,c){var f=g[d].length,a=nZ(b,c,0,f-1);return p8(g,d,a)},k4=function(h,f,c,d){var g=nZ(c,d,0,h.length-1),b=h[g].length,a=qV(f,0,b-1);return p8(h,g,a)},nq=function(g,d,b,c){var f=g[d].length,a=qV(b+c,0,f-1);return p8(g,d,a)},d7=function(h,f,c,d){var g=qV(c+d,0,h.length-1),b=h[g].length,a=qV(f,0,b-1);return p8(h,g,a)},fY=[mG("selectors",[k3("row"),k3("cell")]),o8("cycles",!0),o8("previousSelector",uI.none),o8("execute",l3)],hD=function(b,a){return function(e,f,d){var c=d.cycles()?b:a;return qG(f,d.selectors().row()).bind(function(h){var g=oO(h,d.selectors().cell());return mb(g,f).bind(function(i){var j=oO(e,d.selectors().row());return mb(j,h).bind(function(m){var l,k=(l=d,ij(j,function(o){return oO(o,l.selectors().cell())}));return c(k,m,i).map(function(o){return o.cell()})})})})}},fI=hD(function(c,b,a){return kx(c,b,a,-1)},function(c,b,a){return nq(c,b,a,-1)}),mH=hD(function(c,b,a){return kx(c,b,a,1)},function(c,b,a){return nq(c,b,a,1)}),jK=hD(function(c,b,a){return k4(c,a,b,-1)},function(c,b,a){return d7(c,a,b,-1)}),cB=hD(function(c,b,a){return k4(c,a,b,1)},function(c,b,a){return d7(c,a,b,1)}),h9=uC([kh(rK([37]),ck(fI,mH)),kh(rK([39]),iA(fI,mH)),kh(rK([38]),bq(jK)),kh(rK([40]),gx(cB)),kh(rK([32].concat([13])),function(c,a,b){return jq(c.element()).bind(function(d){return b.execute()(c,a,d)})})]),hT=uC({}),qE=uC({}),gq=mR(fY,cz.init,h9,hT,qE,uI.some(function(b,a){a.previousSelector()(b).orThunk(function(){var c=a.selectors();return ox(b.element(),c.cell())}).each(function(c){a.focusManager().set(b,c)})})),c2=[k3("selector"),o8("execute",l3),o8("moveOnTab",!1)],eU=function(c,a,b){return b.focusManager().get(c).bind(function(d){return b.execute()(c,a,d)})},aG=function(c,b,a){return oq(c,a.selector(),b,-1)},bZ=function(c,b,a){return oq(c,a.selector(),b,1)},cR=uC([kh(rK([38]),gN(aG)),kh(rK([40]),gN(bZ)),kh(pD([sz,rK([9])]),function(c,b,a){return a.moveOnTab()?gN(aG)(c,b,a):uI.none()}),kh(pD([rj,rK([9])]),function(c,b,a){return a.moveOnTab()?gN(bZ)(c,b,a):uI.none()}),kh(rK([13]),eU),kh(rK([32]),eU)]),iX=uC({}),nX=uC({}),bj=mR(c2,cz.init,cR,iX,nX,uI.some(function(b,a){ox(b.element(),a.selector()).each(function(c){a.focusManager().set(b,c)})})),bJ=[ty("onSpace"),ty("onEnter"),ty("onShiftEnter"),ty("onLeft"),ty("onRight"),ty("onTab"),ty("onShiftTab"),ty("onUp"),ty("onDown"),ty("onEscape"),rN("focusIn")],gL=mR(bJ,cz.init,function(c,b,a){return[kh(rK([32]),a.onSpace()),kh(pD([rj,rK([13])]),a.onEnter()),kh(pD([sz,rK([13])]),a.onShiftEnter()),kh(pD([sz,rK([9])]),a.onShiftTab()),kh(pD([rj,rK([9])]),a.onTab()),kh(rK([38]),a.onUp()),kh(rK([40]),a.onDown()),kh(rK([37]),a.onLeft()),kh(rK([39]),a.onRight()),kh(rK([32]),a.onSpace()),kh(rK([27]),a.onEscape())]},function(){return{}},function(){return{}},uI.some(function(b,a){return a.focusIn().bind(function(c){return c(b,a)})})),g1=fK.schema(),eE=g3.schema(),aW=fh.schema(),o2=kO.schema(),sw=gq.schema(),l9=qb.schema(),nG=bj.schema(),oL=gL.schema(),qS=Object.freeze({acyclic:g1,cyclic:eE,flow:aW,flatgrid:o2,matrix:sw,execution:l9,menu:nG,special:oL}),lB=(iM=oR("Creating behaviour: "+(cG={branchKey:"mode",branches:qS,name:"keying",active:{events:function(b,a){return b.handler().toEvents(b,a)}},apis:{focusIn:function(a){a.getSystem().triggerFocus(a.element(),a.element())},setGridSize:function(f,c,a,b,d){dU(a,"setGridSize")?a.setGridSize(b,d):console.error("Layout does not support setGridSize")}},state:cL}).name,gA,cG),b4(nk(iM.branchKey,iM.branches),iM.name,iM.active,iM.apis,iM.extra,iM.state)),u1=function(b,f){return c=b,a={},d=ij(f,function(i){return h=i.name(),g="Cannot configure "+i.name()+" for "+b,nK(h,h,sA(),cN(function(e){return uN.error("The field: "+h+" is forbidden. "+g)}));var h,g}).concat([kw("dump",tx)]),nK(c,c,rL(a),aj(d));var c,a,d},tJ=function(a){return a.dump()},mX="placeholder",rY=sY([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),pR=function(h,f,c,d){return c.uiType===mX?(b=c,a=d,(g=h).exists(function(e){return e!==b.owner})?rY.single(!0,uC(b)):pV(a,b.name).fold(function(){throw new Error("Unknown placeholder component: "+b.name+"\nKnown: ["+uB(a)+"]\nNamespace: "+g.getOr("none")+"\nSpec: "+l4(b,null,2))},function(e){return e.replace()})):rY.single(!1,uC(c));var g,b,a},sM=function(e,d,b,f){return pR(e,0,b,f).fold(function(i,g){var a=g(d,b.config,b.validated),c=pV(a,"components").getOr([]),h=m0(c,function(j){return sM(e,d,j,f)});return[uG(a,{components:h})]},function(c,a){return a(d,b.config,b.validated)})},pA=function(h,m,f,b){var d,g,l,k=ux(b,function(q,i){return c=q,p=!1,{name:uC(a=i),required:function(){return c.fold(function(r,o){return r},function(r,o){return r})},used:function(){return p},replace:function(){if(!0===p){throw new Error("Trying to use the same placeholder more than once: "+a)}return p=!0,c}};var a,c,p}),j=(d=h,g=m,l=k,m0(f,function(a){return sM(d,g,a,l)}));return tS(k,function(a){if(!1===a.used()&&a.required()){throw new Error("Placeholder: "+a.name()+" was not found in components list\nNamespace: "+h.getOr("none")+"\nComponents: "+l4(m.components(),null,2))}}),j},rH=rY.single,kN=rY.multiple,ok=uC(mX),q9=0,uH=function(b){var a=(new Date).getTime();return b+"_"+Math.floor(1000000000*Math.random())+ ++q9+String(a)},iG=sY([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),j0=o8("factory",{sketch:tx}),jk=o8("schema",[]),dz=k3("name"),dQ=nK("pname","pname",o6(function(a){return"<alloy."+uH(a.name)+">"}),oA()),fb=o8("defaults",uC({})),lQ=o8("overrides",uC({})),p7=aj([j0,jk,dz,dQ,fb,lQ]),kp=aj([j0,jk,dz,fb,lQ]),k1=aj([j0,jk,dz,dQ,fb,lQ]),nh=aj([j0,jk,dz,k3("unit"),dQ,fb,lQ]),d6=function(b){var a=function(c){return c.name()};return b.fold(a,a,a,a)},fX=function(a,b){return function(d){var c=r4("Converting part type",b,d);return a(c)}},hB=fX(iG.required,p7),fH=(fX(iG.external,kp),fX(iG.optional,k1)),mE=fX(iG.group,nh),jH=uC("entirety"),cA=function(f,c,a,b){var d=a;return uG(c.defaults()(f,a,b),a,{uid:f.partUids()[c.name()]},c.overrides()(f,a,b),{"debug.sketcher":jV("part-"+c.name(),d)})},h6=function(b,c){var a={};return jN(c,function(f){var d;(d=f,d.fold(uI.some,uI.none,uI.some,uI.some)).each(function(e){var g=hS(b,e.pname());a[e.name()]=function(i){var h=oR("Part: "+e.name()+" in "+b,aj(e.schema()),i);return uG(g,{config:i,validated:h})}})}),a},hS=function(b,a){return{uiType:ok(),owner:b,name:a}},qD=function(g,d,b){return c=d,a={},f={},jN(b,function(e){e.fold(function(h){a[h.pname()]=rH(!0,function(k,j,i){return h.factory().sketch(cA(k,h,j,i))})},function(i){var h=c.parts()[i.name()]();f[i.name()]=uC(cA(c,i,h[jH()]()))},function(h){a[h.pname()]=rH(!1,function(k,j,i){return h.factory().sketch(cA(k,h,j,i))})},function(h){a[h.pname()]=kN(!0,function(k,l,i){var j=k[h.name()]();return ij(j,function(m){return h.factory().sketch(uG(h.defaults()(k,m),m,h.overrides()(k,m)))})})})}),{internals:uC(a),externals:uC(f)};var c,a,f},gk=function(c,b,a){return pA(uI.some(c),b,b.components(),a)},c1=function(d,c,a){var b=c.partUids()[a];return d.getSystem().getByUid(b).toOption()},eT=function(c,b,a){return c1(c,b,a).getOrDie("Could not find part: "+a)},aF=function(b,c){var a=ij(c,d6);return kI(ij(a,function(d){return{key:d,value:b+"-"+d}}))},bY=function(a){return nK("partUids","partUids",rk(function(b){return aF(b.uid,a)}),oA())},cP=uH("alloy-premade"),iV=uH("api"),nW=function(a){return jV(cP,a)},bh=function(f){return g=function(k){for(var j=[],h=1;h<arguments.length;h++){j[h-1]=arguments[h]}var i=k.config(iV);return f.apply(undefined,[i].concat([k].concat(j)))},d=f.toString(),b=d.indexOf(")")+1,c=d.indexOf("("),a=d.substring(c+1,b-1).split(/,\s*/),g.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:mW(a.slice(1))}},g;var g,d,b,c,a},bI=uC(iV),gK=uC("alloy-id-"),g0=uC("data-alloy-id"),eD=gK(),aV=g0(),oQ=function(b){var a=uD.isElement(b)?nx.get(b,aV):null;return uI.from(a)},r3=function(a){return uH(a)},lR=function(k,h,f,g,j){var d,c,b=(c=j,(0<(d=g).length?[mG("parts",d)]:[]).concat([k3("uid"),o8("dom",{}),o8("components",[]),sH("originalSpec"),o8("debug.sketcher",{})]).concat(c));return r4(k+" [SpecSchema]",eH(b.concat(h)),f)},nj=function(g,k,q,b,d){var h=oz(d),p=m0(q,function(a){return a.fold(uI.none,uI.some,uI.none,uI.none).map(function(c){return mG(c.name(),c.schema().concat([sH(jH())]))}).toArray()}),m=bY(q),l=lR(g,k,h,p,[m]),v=qD(0,l,q),j=gk(g,l,v.internals());return uG(b(l,j,h,v.externals()),{"debug.sketcher":jV(g,d)})},oz=function(a){return uG({uid:r3("uid")},a)},qI=eH([k3("name"),k3("factory"),k3("configFields"),o8("apis",{}),o8("extraApis",{})]),k2=eH([k3("name"),k3("factory"),k3("configFields"),k3("partFields"),o8("apis",{}),o8("extraApis",{})]),uO=function(f){var b=oR("Sketcher for "+f.name,qI,f),d=ux(b.apis,bh),c=ux(b.extraApis,function(g,a){return dW(g,a)});return uG({name:uC(b.name),partFields:uC([]),configFields:uC(b.configFields),sketch:function(m){return k=b.name,h=b.configFields,j=b.factory,g=oz(l=m),a=lR(k,h,g,[],[]),uG(j(a,g),{"debug.sketcher":jV(k,l)});var k,h,j,l,g,a}},d,c)},s0=function(f){var c=oR("Sketcher for "+f.name,k2,f),a=h6(c.name,c.partFields),b=ux(c.apis,bh),d=ux(c.extraApis,function(h,g){return dW(h,g)});return uG({name:uC(c.name),partFields:uC(c.partFields),configFields:uC(c.configFields),sketch:function(e){return nj(c.name,c.configFields,c.partFields,c.factory,e)},parts:uC(a)},b,d)},mF=uO({name:"Button",factory:function(h){var f,c,d,g=(f=h.action(),c=function(j,i){i.stop(),lx(j)},d=bQ.detect().deviceType.isTouch()?[jJ(gS(),c)]:[jJ(uj(),c),jJ(tM(),function(j,i){i.cut()})],t0(kQ([f.map(function(e){return jJ(bA(),function(j,i){e(j),i.stop()})}).toArray(),d]))),b=pV(h.dom(),"attributes").bind(eX("type")),a=pV(h.dom(),"tag");return{uid:h.uid(),dom:h.dom(),components:h.components(),events:g,behaviours:uG(nM([b9.config({}),lB.config({mode:"execution",useSpace:!0,useEnter:!0})]),tJ(h.buttonBehaviours())),domModification:{attributes:uG(b.fold(function(){return a.is("button")?{type:"button"}:{}},function(e){return{}}),{role:h.role().getOr("button")})},eventOrder:h.eventOrder()}},configFields:[o8("uid",undefined),k3("dom"),o8("components",[]),u1("buttonBehaviours",[b9,lB]),rN("action"),rN("role"),o8("eventOrder",{})]}),rM=Object.freeze({events:function(a){return t0([h8(t1(),uC(!0))])},exhibit:function(b,a){return fx({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}}),pF=by({fields:[],name:"unselecting",active:rM}),sB=function(f){var h,m,b,d=rW.fromHtml(f),g=cK.children(d),l=(m=(h=d).dom().attributes!==undefined?h.dom().attributes:[],dI(m,function(c,a){return"class"===a.name?c:uG(c,jV(a.name,a.value))},{})),k=(b=d,Array.prototype.slice.call(b.dom().classList,0)),j=0===g.length?{}:{innerHtml:eK(d)};return uG({tag:uD.name(d),classes:k,attributes:l},j)},o7=function(d){var b,c,a=(b=d,c={prefix:fS.prefix()},b.replace(/\$\{([^{}]*)\}/g,function(i,h){var f,g=c[h];return"string"==(f=typeof g)||"number"===f?g.toString():i}));return sB(a)},rq=function(a){return{dom:o7(a)}},kq=function(a){return nM([p2.config({toggleClass:fS.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),j6(a,function(c,b){(b?p2.on:p2.off)(c)})])},n1=function(c,b,a){return mF.sketch({dom:o7('<span class="${prefix}-toolbar-button ${prefix}-icon-'+c+' ${prefix}-icon"></span>'),action:b,buttonBehaviours:uG(nM([pF.config({})]),a)})},qX={forToolbar:n1,forToolbarCommand:function(b,a){return n1(a,function(){b.execCommand(a)},{})},forToolbarStateAction:function(f,c,a,b){var d=kq(a);return n1(c,b,d)},forToolbarStateCommand:function(c,b){var a=kq(b);return n1(b,function(){c.execCommand(b)},a)}},tY=function(a,b){return{left:uC(a),top:uC(b),translate:function(d,c){return tY(a+d,b+c)}}},h7=tY,jI=function(c,b,a){return Math.max(b,Math.min(a,c))},iU=function(j,x,C,b,h,q,B){var A=C-x;if(b<j.left){return x-1}if(b>j.right){return C+1}var z,D,w,p,y=Math.min(j.right,Math.max(b,j.left))-j.left,k=jI(y/j.width*A+x,x-1,C+1),v=Math.round(k);return q&&x<=k&&k<=C?(z=k,D=x,w=C,p=h,B.fold(function(){var c=z-D,a=Math.round(c/p)*p;return jI(D+a,D-1,w+1)},function(l){var f=(z-l)%p,c=Math.round(f/p),d=Math.floor((z-l)/p),g=Math.floor((w-l)/p),a=l+Math.min(g,d+c)*p;return Math.max(l,a)})):v},c6="slider.change.value",dE=bQ.detect().deviceType.isTouch(),eY=function(a){return function(f){var d=f.event().raw();if(dE){var b=d;return b.touches!==undefined&&1===b.touches.length?uI.some(b.touches[0]).map(function(e){return h7(e.clientX,e.clientY)}):uI.none()}var c=d;return c.clientX!==undefined?uI.some(c).map(function(e){return h7(e.clientX,e.clientY)}):uI.none()}(a).map(function(b){return b.left()})},lz=function(b,a){qQ(b,c6,{value:a})},pW=function(d,c,b,e){return eY(e).map(function(i){var g,a,f,h;return g=d,f=i,h=iU(b,(a=c).min(),a.max(),f,a.stepSize(),a.snapToGrid(),a.snapStart()),lz(g,h),i})},jY=function(h,f){var c,d,g,b,a=(c=f.value().get(),d=f.min(),g=f.max(),b=f.stepSize(),c<d?c:g<c?g:c===d?d-1:Math.max(d,c-b));lz(h,a)},kL=function(h,f){var c,d,g,b,a=(c=f.value().get(),d=f.min(),g=f.max(),b=f.stepSize(),g<c?c:c<d?d:c===g?g+1:Math.min(g,c+b));lz(h,a)},mV=bQ.detect().deviceType.isTouch(),dV=function(b,a){return fH({name:b+"-edge",overrides:function(f){var d=t0([iW(uh(),a,[f])]),c=t0([iW(tM(),a,[f]),iW(tQ(),function(h,g){g.mouseIsDown().get()&&a(h,g)},[f])]);return{events:mV?d:c}}})},fM=[dV("left",function(b,a){lz(b,a.min()-1)}),dV("right",function(b,a){lz(b,a.max()+1)}),hB({name:"thumb",defaults:uC({dom:{styles:{position:"absolute"}}}),overrides:function(a){return{events:t0([dF(uh(),a,"spectrum"),dF(tT(),a,"spectrum"),dF(t3(),a,"spectrum")])}}}),hB({schema:[kw("mouseIsDown",function(){return dH(!1)})],name:"spectrum",overrides:function(b){var a=function(h,g){var f=h.element().dom().getBoundingClientRect();pW(h,b,f,g)},d=t0([jJ(uh(),a),jJ(tT(),a)]),c=t0([jJ(tM(),a),jJ(tQ(),function(g,f){b.mouseIsDown().get()&&a(g,f)})]);return{behaviours:nM(mV?[]:[lB.config({mode:"special",onLeft:function(e){return jY(e,b),uI.some(!0)},onRight:function(e){return kL(e,b),uI.some(!0)}}),b9.config({})]),events:mV?d:c}}})],g5=function(c,b,a){b.store().manager().onLoad(c,b,a)},fw=function(c,b,a){b.store().manager().onUnload(c,b,a)},l7=Object.freeze({onLoad:g5,onUnload:fw,setValue:function(d,c,a,b){c.store().manager().setValue(d,c,a,b)},getValue:function(c,b,a){return b.store().manager().getValue(c,b,a)}}),jh=Object.freeze({events:function(a,b){var c=a.resetOnDom()?[lA(function(f,d){g5(f,a,b)}),pX(function(f,d){fw(f,a,b)})]:[jj(a,b,g5)];return t0(c)}}),b3=function(){var a=dH(null);return iF({set:a.set,get:a.get,isNotSet:function(){return null===a.get()},clear:function(){a.set(null)},readState:function(){return{mode:"memory",value:a.get()}}})},hQ=function(){var a=dH({});return iF({readState:function(){return{mode:"dataset",dataset:a.get()}},set:a.set,get:a.get})},hA=Object.freeze({memory:b3,dataset:hQ,manual:function(){return iF({readState:function(){}})},init:function(a){return a.store().manager().state(a)}}),qj=function(d,c,a,b){c.store().getDataKey(),a.set({}),c.store().setData()(d,b),c.onSetValue()(d,b)},f2=[rN("initialValue"),k3("getFallbackEntry"),k3("getDataKey"),k3("setData"),pM("manager",{setValue:qj,getValue:function(f,c,a){var b=c.store().getDataKey()(f),d=a.get();return pV(d,b).fold(function(){return c.store().getFallbackEntry()(b)},function(e){return e})},onLoad:function(c,a,b){a.store().initialValue().each(function(d){qj(c,a,b,d)})},onUnload:function(c,b,a){a.set({})},state:hQ})],cO=[k3("getValue"),o8("setValue",tk),rN("initialValue"),pM("manager",{setValue:function(d,c,a,b){c.store().setValue()(d,b),c.onSetValue()(d,b)},getValue:function(c,b,a){return b.store().getValue()(c)},onLoad:function(b,a,c){a.store().initialValue().each(function(d){a.store().setValue()(b,d)})},onUnload:tk,state:cz.init})],eI=[rN("initialValue"),pM("manager",{setValue:function(d,c,a,b){a.set(b),c.onSetValue()(d,b)},getValue:function(c,b,a){return a.get()},onLoad:function(c,b,a){b.store().initialValue().each(function(d){a.isNotSet()&&a.set(d)})},onUnload:function(c,b,a){a.clear()},state:b3})],ak=[rw("store",{mode:"memory"},nk("mode",{memory:eI,manual:cO,dataset:f2})),uV("onSetValue"),o8("resetOnDom",!1)],bN=by({fields:ak,name:"representing",active:jh,apis:l7,extra:{setValueFrom:function(c,b){var a=bN.getValue(b);bN.setValue(c,a)}},state:hA}),cy=bQ.detect().deviceType.isTouch(),iE=[k3("min"),k3("max"),o8("stepSize",1),o8("onChange",tk),o8("onInit",tk),o8("onDragStart",tk),o8("onDragEnd",tk),o8("snapToGrid",!1),rN("snapStart"),k3("getInitialValue"),u1("sliderBehaviours",[lB,bN]),kw("value",function(a){return dH(a.min)})].concat(cy?[]:[kw("mouseIsDown",function(){return dH(!1)})]),nL=bT("width",function(a){return a.dom().offsetWidth}),a0=function(b,a){nL.set(b,a)},bx=function(a){return nL.get(a)},gz=bQ.detect().deviceType.isTouch(),gP=s0({name:"Slider",configFields:iE,partFields:fM,factory:function(l,g,k,q){var v=l.max()-l.min(),j=function(c){var a=c.element().dom().getBoundingClientRect();return(a.left+a.right)/2},d=function(a){return eT(a,l,"thumb")},h=function(A){var y,w,x,z,s=eT(A,l,"spectrum").element().dom().getBoundingClientRect(),f=A.element().dom().getBoundingClientRect(),c=(y=A,w=s,(z=(x=l).value().get())<x.min()?c1(y,x,"left-edge").fold(function(){return 0},function(a){return j(a)-w.left}):z>x.max()?c1(y,x,"right-edge").fold(function(){return w.width},function(a){return j(a)-w.left}):(x.value().get()-x.min())/v*w.width);return s.left-f.left+c},p=function(i){var f=h(i),a=d(i),c=bx(a.element())/2;aA.set(a.element(),"left",f-c+"px")},b=function(i,f){var a=l.value().get(),c=d(i);return a!==f||aA.getRaw(c.element(),"left").isNone()?(l.value().set(f),p(i),l.onChange()(i,c,f),uI.some(!0)):uI.none()},m=gz?[jJ(uh(),function(c,a){l.onDragStart()(c,d(c))}),jJ(t3(),function(c,a){l.onDragEnd()(c,d(c))})]:[jJ(tM(),function(c,a){a.stop(),l.onDragStart()(c,d(c)),l.mouseIsDown().set(!0)}),jJ(u0(),function(c,a){l.onDragEnd()(c,d(c)),l.mouseIsDown().set(!1)})];return{uid:l.uid(),dom:l.dom(),components:g,behaviours:uG(nM(kQ([gz?[]:[lB.config({mode:"special",focusIn:function(a){return c1(a,l,"spectrum").map(lB.focusIn).map(uC(!0))}})],[bN.config({store:{mode:"manual",getValue:function(a){return l.value().get()}}})]])),tJ(l.sliderBehaviours())),events:t0([jJ(c6,function(c,a){b(c,a.event().value())}),lA(function(f,c){l.value().set(l.getInitialValue()());var a=d(f);p(f),l.onInit()(f,a,l.value().get())})].concat(m)),apis:{resetToMin:function(a){b(a,l.min())},resetToMax:function(a){b(a,l.max())},refresh:p},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(b,a){b.resetToMin(a)},resetToMax:function(b,a){b.resetToMax(a)},refresh:function(b,a){b.refresh(a)}}}),eh=function(c,a,b){return qX.forToolbar(a,function(){var d=b();c.setContextToolbar([{label:a+" group",items:d}])},{})},aK=function(c){return[(b=c,a=function(d){return d<0?"black":360<d?"white":"hsl("+d+", 100%, 50%)"},gP.sketch({dom:o7('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[gP.parts()["left-edge"](rq('<div class="${prefix}-hue-slider-black"></div>')),gP.parts().spectrum({dom:o7('<div class="${prefix}-slider-gradient-container"></div>'),components:[rq('<div class="${prefix}-slider-gradient"></div>')],behaviours:nM([p2.config({toggleClass:fS.resolve("thumb-active")})])}),gP.parts()["right-edge"](rq('<div class="${prefix}-hue-slider-white"></div>')),gP.parts().thumb({dom:o7('<div class="${prefix}-slider-thumb"></div>'),behaviours:nM([p2.config({toggleClass:fS.resolve("thumb-active")})])})],onChange:function(h,g,d){var f=a(d);aA.set(g.element(),"background-color",f),b.onChange(h,g,f)},onDragStart:function(f,d){p2.on(d)},onDragEnd:function(f,d){p2.off(d)},onInit:function(h,g,d){var f=a(d);aA.set(g.element(),"background-color",f)},stepSize:10,min:0,max:360,getInitialValue:b.getInitialValue,sliderBehaviours:nM([kT(gP.refresh)])}))];var b,a},oZ=function(c,a){var b={onChange:function(g,f,d){a.undoManager.transact(function(){a.formatter.apply("forecolor",{value:d}),a.nodeChanged()})},getInitialValue:function(){return -1}};return eh(c,"color",function(){return aK(b)})},sj=eH([k3("getInitialValue"),k3("onChange"),k3("category"),k3("sizes")]),l2=function(b){var a=oR("SizeSlider",sj,b);return gP.sketch({dom:{tag:"div",classes:[fS.resolve("slider-"+a.category+"-size-container"),fS.resolve("slider"),fS.resolve("slider-size-container")]},onChange:function(g,f,c){var d;0<=(d=c)&&d<a.sizes.length&&a.onChange(c)},onDragStart:function(d,c){p2.on(c)},onDragEnd:function(d,c){p2.off(c)},min:0,max:a.sizes.length-1,stepSize:1,getInitialValue:a.getInitialValue,snapToGrid:!0,sliderBehaviours:nM([kT(gP.refresh)]),components:[gP.parts().spectrum({dom:o7('<div class="${prefix}-slider-size-container"></div>'),components:[rq('<div class="${prefix}-slider-size-line"></div>')]}),gP.parts().thumb({dom:o7('<div class="${prefix}-slider-thumb"></div>'),behaviours:nM([p2.config({toggleClass:fS.resolve("thumb-active")})])})]})},nD=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],oI=function(h){var f,c,d=h.selection.getStart(),g=rW.fromDom(d),b=rW.fromDom(h.getBody()),a=(f=function(e){return hO(b,e)},c=g,(uD.isElement(c)?uI.some(c):cK.parent(c)).map(function(e){return kP.closest(e,function(i){return aA.getRaw(i,"font-size").isSome()},f).bind(function(i){return aA.getRaw(i,"font-size")}).getOrThunk(function(){return aA.get(e,"font-size")})}).getOr(""));return e2(nD,function(e){return a===e}).getOr("medium")},lk={candidates:uC(nD),get:function(c){var b,a=oI(c);return(b=a,lF(nD,function(d){return d===b})).getOr(2)},apply:function(a,c){var b;(b=c,uI.from(nD[b])).each(function(g){var f,d;d=g,oI(f=a)!==d&&f.execCommand("fontSize",!1,d)})}},uX=lk.candidates(),tC=function(b){return[rq('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),(a=b,l2({onChange:a.onChange,sizes:uX,category:"font",getInitialValue:a.getInitialValue})),rq('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')];var a},mQ=function(b){var a=b.uid!==undefined&&dU(b,"uid")?b.uid:r3("memento");return{get:function(c){return c.getSystem().getByUid(a).getOrDie()},getOpt:function(c){return c.getSystem().getByUid(a).fold(uI.none,uI.some)},asSpec:function(){return uG(b,{uid:a})}}};function rV(b,a){return sJ(document.createElement("canvas"),b,a)}function pO(a){return a.getContext("2d")}function sJ(c,b,a){return c.width=b,c.height=a,c}var px={create:rV,clone:function(b){var a;return pO(a=rV(b.width,b.height)).drawImage(b,0,0),a},resize:sJ,get2dContext:pO,get3dContext:function(c){var b=null;try{b=c.getContext("webgl")||c.getContext("experimental-webgl")}catch(a){}return b||(b=null),b}},rE={getWidth:function(a){return a.naturalWidth||a.width},getHeight:function(a){return a.naturalHeight||a.height}},kG=window.Promise?window.Promise:function(){var f=function(a){if("object"!=typeof this){throw new TypeError("Promises must be constructed via new")}if("function"!=typeof a){throw new TypeError("not a function")}this._state=null,this._value=null,this._deferreds=[],p(a,b(d,this),b(l,this))},h=f.immediateFn||"function"==typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)};function b(c,a){return function(){c.apply(a,arguments)}}var m=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};function g(a){var c=this;null!==this._state?h(function(){var q=c._state?a.onFulfilled:a.onRejected;if(null!==q){var o;try{o=q(c._value)}catch(i){return void a.reject(i)}a.resolve(o)}else{(c._state?a.resolve:a.reject)(c._value)}}):this._deferreds.push(a)}function d(i){try{if(i===this){throw new TypeError("A promise cannot be resolved with itself.")}if(i&&("object"==typeof i||"function"==typeof i)){var c=i.then;if("function"==typeof c){return void p(b(c,i),b(d,this),b(l,this))}}this._state=!0,this._value=i,k.call(this)}catch(a){l.call(this,a)}}function l(a){this._state=!1,this._value=a,k.call(this)}function k(){for(var c=0,a=this._deferreds.length;c<a;c++){g.call(this,this._deferreds[c])}this._deferreds=null}function j(o,i,a,c){this.onFulfilled="function"==typeof o?o:null,this.onRejected="function"==typeof i?i:null,this.resolve=a,this.reject=c}function p(s,i,a){var c=!1;try{s(function(e){c||(c=!0,i(e))},function(e){c||(c=!0,a(e))})}catch(q){if(c){return}c=!0,a(q)}}return f.prototype["catch"]=function(a){return this.then(null,a)},f.prototype.then=function(a,c){var e=this;return new f(function(o,i){g.call(e,new j(a,c,o,i))})},f.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&m(arguments[0])?arguments[0]:arguments);return new f(function(r,q){if(0===a.length){return r([])}var e=a.length;function c(u,v){try{if(v&&("object"==typeof v||"function"==typeof v)){var i=v.then;if("function"==typeof i){return void i.call(v,function(t){c(u,t)},q)}}a[u]=v,0==--e&&r(a)}catch(o){q(o)}}for(var s=0;s<a.length;s++){c(s,a[s])}})},f.resolve=function(a){return a&&"object"==typeof a&&a.constructor===f?a:new f(function(c){c(a)})},f.reject=function(a){return new f(function(i,c){c(a)})},f.race=function(a){return new f(function(q,o){for(var c=0,i=a.length;c<i;c++){a[c].then(q,o)}})},f}();function ob(){return new (hw.getOrDie("FileReader"))}var q6={atob:function(a){return hw.getOrDie("atob")(a)},requestAnimationFrame:function(a){hw.getOrDie("requestAnimationFrame")(a)}};function uA(b){return new kG(function(j,g){var d=URL.createObjectURL(b),f=new Image,h=function(){f.removeEventListener("load",c),f.removeEventListener("error",a)};function c(){h(),j(f)}function a(){h(),g("Unable to load data of type "+b.type+": "+d)}f.addEventListener("load",c),f.addEventListener("error",a),f.src=d,f.complete&&c()})}function iz(a){return new kG(function(d,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="blob",c.onload=function(){200==this.status&&d(this.response)},c.onerror=function(){var g,f=this;b(0===this.status?((g=new Error("No access to download image")).code=18,g.name="SecurityError",g):new Error("Error "+f.status+" downloading image"))},c.send()})}function jT(z){var G=z.split(","),k=/data:([^;]+)/.exec(G[0]);if(!k){return uI.none()}for(var w,y,C,j=k[1],J=G[1],I=q6.atob(J),q=I.length,F=Math.ceil(q/1024),B=new Array(F),H=0;H<F;++H){for(var A=1024*H,E=Math.min(A+1024,q),b=new Array(E-A),x=A,D=0;x<E;++D,++x){b[D]=I[x].charCodeAt(0)}B[H]=(w=b,new (hw.getOrDie("Uint8Array"))(w))}return uI.some((y=B,C={type:j},new (hw.getOrDie("Blob"))(y,C)))}function i6(a){return new kG(function(c,b){jT(a).fold(function(){b("uri is not base64: "+a)},c)})}function dw(a){return new kG(function(c){var b=new ob;b.onloadend=function(){c(b.result)},b.readAsDataURL(a)})}var dN,e7,lL,p4,j9,kW,m6,d3,fU={blobToImage:uA,imageToBlob:function(b){var a=b.src;return 0===a.indexOf("data:")?i6(a):iz(a)},blobToArrayBuffer:function(a){return new kG(function(c){var b=new ob;b.onloadend=function(){c(b.result)},b.readAsArrayBuffer(a)})},blobToDataUri:dw,blobToBase64:function(a){return dw(a).then(function(b){return b.split(",")[1]})},dataUriToBlobSync:jT,canvasToBlob:function(c,a,b){return a=a||"image/png",HTMLCanvasElement.prototype.toBlob?new kG(function(d){c.toBlob(function(e){d(e)},a,b)}):i6(c.toDataURL(a,b))},canvasToDataURL:function(c,b,a){return b=b||"image/png",c.then(function(d){return d.toDataURL(b,a)})},blobToCanvas:function(a){return uA(a).then(function(d){var c,b;return c=d,URL.revokeObjectURL(c.src),b=px.create(rE.getWidth(d),rE.getHeight(d)),px.get2dContext(b).drawImage(d,0,0),b})},uriToBlob:function(a){return 0===a.indexOf("blob:")?iz(a):0===a.indexOf("data:")?i6(a):null}},hq=function(a){return fU.blobToBase64(a)},fE=function(a){var b=mQ({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:t0([eZ(uj()),jJ(tP(),function(h,f){var c,d,g;(c=f,d=c.event(),g=d.raw().target.files||d.raw().dataTransfer.files,uI.from(g[0])).each(function(k){var j,e;j=a,hq(e=k).then(function(i){j.undoManager.transact(function(){var o=j.editorUpload.blobCache,m=o.create(uH("mceu"),e,i);o.add(m);var l=j.dom.createHTML("img",{src:m.blobUri()});j.insertContent(l)})})})})])});return mF.sketch({dom:o7('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[b.asSpec()],action:function(c){b.get(c).element().dom().click()}})},mz=function(a){return a.dom().textContent},jC=function(b,a){b.dom().textContent=a},cj=function(a){return 0<a.length},h1=function(a){return a===undefined||null===a?"":a},hL=function(b,a,c){return c.text.filter(cj).fold(function(){return nx.get(d=b,"href")===mz(d)?uI.some(a):uI.none();var d},uI.some)},qA=function(b){var a=rW.fromDom(b.selection.getStart());return qG(a,"a")},gb={getInfo:function(a){return qA(a).fold(function(){return{url:"",text:a.selection.getContent({format:"text"}),title:"",target:"",link:uI.none()}},function(h){return c=mz(f=h),d=nx.get(f,"href"),g=nx.get(f,"title"),b=nx.get(f,"target"),{url:h1(d),text:c!==d?h1(c):"",title:h1(g),target:h1(b),link:uI.some(f)};var f,c,d,g,b})},applyInfo:function(b,a){a.url.filter(cj).fold(function(){var c;c=b,a.link.bind(tx).each(function(d){c.execCommand("unlink")})},function(c){var g,f,d=(g=a,(f={}).href=c,g.title.filter(cj).each(function(e){f.title=e}),g.target.filter(cj).each(function(e){f.target=e}),f);a.link.bind(tx).fold(function(){var e=a.text.filter(cj).getOr(c);b.insertContent(b.dom.createHTML("a",d,b.dom.encode(e)))},function(h){var i=hL(h,c,a);nx.setAll(h,d),i.each(function(e){jC(h,e)})})})},query:qA},cY=bQ.detect(),eQ=function(c,b){var a=b.selection.getRng();c(),b.selection.setRng(a)},aC=function(b,a){(cY.os.isAndroid()?eQ:sX)(a,b)},bV=function(d,c){var a,b;return{key:d,value:{config:{},me:(a=d,b=t0(c),by({fields:[k3("enabled")],name:a,active:{events:uC(b)}})),configAsRaw:uC({}),initialConfig:{},state:cz}}},cJ=Object.freeze({getCurrent:function(c,b,a){return b.find()(c)}}),iP=[k3("find")],nT=by({fields:iP,name:"composing",apis:cJ}),a8=uO({name:"Container",factory:function(a){return{uid:a.uid(),dom:uG({tag:"div",attributes:{role:"presentation"}},a.dom()),components:a.components(),behaviours:tJ(a.containerBehaviours()),events:a.events(),domModification:a.domModification(),eventOrder:a.eventOrder()}},configFields:[o8("components",[]),u1("containerBehaviours",[]),o8("events",{}),o8("domModification",{}),o8("eventOrder",{})]}),bF=uO({name:"DataField",factory:function(a){return{uid:a.uid(),dom:a.dom(),behaviours:uG(nM([bN.config({store:{mode:"memory",initialValue:a.getInitialValue()()}}),nT.config({find:uI.some})]),tJ(a.dataBehaviours())),events:t0([lA(function(c,b){bN.setValue(c,a.getInitialValue()())})])}},configFields:[k3("uid"),k3("dom"),k3("getInitialValue"),u1("dataBehaviours",[bN,nT])]}),gH=function(b,a){if(a===undefined){throw new Error("Value.set was undefined")}b.dom().value=a},gX=function(a){return a.dom().value},eA=uC([rN("data"),o8("inputAttributes",{}),o8("inputStyles",{}),o8("type","input"),o8("tag","input"),o8("inputClasses",[]),uV("onSetValue"),o8("styles",{}),rN("placeholder"),o8("eventOrder",{}),u1("inputBehaviours",[bN,b9]),o8("selectOnFocus",!0)]),aS=function(b){return uG(nM([bN.config({store:{mode:"manual",initialValue:b.data().getOr(undefined),getValue:function(c){return gX(c.element())},setValue:function(d,c){gX(d.element())!==c&&gH(d.element(),c)}},onSetValue:b.onSetValue()})]),(a=b,nM([b9.config({onFocus:!1===a.selectOnFocus()?tk:function(f){var d=f.element(),c=gX(d);d.dom().setSelectionRange(0,c.length)}})])),tJ(b.inputBehaviours()));var a},oW=uO({name:"Input",configFields:eA(),factory:function(c,b){return{uid:c.uid(),dom:(a=c,{tag:a.tag(),attributes:uG(kI([{key:"type",value:a.type()}].concat(a.placeholder().map(function(d){return{key:"placeholder",value:d}}).toArray())),a.inputAttributes()),styles:a.inputStyles(),classes:a.inputClasses()}),components:[],behaviours:aS(c),eventOrder:c.eventOrder()};var a}}),r9=Object.freeze({exhibit:function(b,a){return fx({attributes:kI([{key:a.tabAttr(),value:"true"}])})}}),lY=[o8("tabAttr","data-alloy-tabstop")],nA=by({fields:lY,name:"tabstopping",active:r9}),oF=function(d,c){var a=mQ(oW.sketch({placeholder:c,onSetValue:function(g,f){oJ(g,tO())},inputBehaviours:nM([nT.config({find:uI.some}),nA.config({}),lB.config({mode:"execution"})]),selectOnFocus:!1})),b=mQ(mF.sketch({dom:o7('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(g){var f=a.get(g);bN.setValue(f,"")}}));return{name:d,spec:a8.sketch({dom:o7('<div class="${prefix}-input-container"></div>'),components:[a.asSpec(),b.asSpec()],containerBehaviours:nM([p2.config({toggleClass:fS.resolve("input-container-empty")}),nT.config({find:function(e){return uI.some(a.get(e))}}),bV("input-clearing",[jJ(tO(),function(g){var f=a.get(g);(0<bN.getValue(f).length?p2.off:p2.on)(g)})])])})}},qN=["input","button","textarea"],k9=function(c,b,a){b.disabled()&&sG(c,b,a)},uU=function(a){return q1(qN,uD.name(a.element()))},tj=function(a){nx.set(a.element(),"disabled","disabled")},mM=function(a){nx.remove(a.element(),"disabled")},rS=function(a){nx.set(a.element(),"aria-disabled","true")},pL=function(a){nx.set(a.element(),"aria-disabled","false")},sG=function(b,c,a){c.disableClass().each(function(d){t5.add(b.element(),d)}),(uU(b)?tj:rS)(b)},pk=function(a){return uU(a)?nx.has(a.element(),"disabled"):"true"===nx.get(a.element(),"aria-disabled")},rB=Object.freeze({enable:function(b,c,a){c.disableClass().each(function(d){t5.remove(b.element(),d)}),(uU(b)?mM:pL)(b)},disable:sG,isDisabled:pk,onLoad:k9}),kC=Object.freeze({exhibit:function(c,b,a){return fx({classes:b.disabled()?b.disableClass().map(fz).getOr([]):[]})},events:function(b,a){return t0([h8(bA(),function(d,c){return pk(d)}),jj(b,a,k9)])}}),n7=[o8("disabled",!1),rN("disableClass")],q3=by({fields:n7,name:"disabling",active:kC,apis:rB}),ub=[u1("formBehaviours",[bN])],iq=function(a){return"<alloy.field."+a+">"},jP=function(b,c,a){return uG({"debug.sketcher":{Form:a},uid:b.uid(),dom:b.dom(),components:c,behaviours:uG(nM([bN.config({store:{mode:"manual",getValue:function(h){var g,d,f=(g=b,d=h.getSystem(),ux(g.partUids(),function(j,i){return uC(d.getByUid(j))}));return ux(f,function(j,i){return j().bind(nT.getCurrent).map(bN.getValue)})},setValue:function(d,e){tS(e,function(f,g){c1(d,b,g).each(function(h){nT.getCurrent(h).each(function(i){bN.setValue(i,f)})})})}}})]),tJ(b.formBehaviours())),apis:{getField:function(f,d){return c1(f,b,d).bind(nT.getCurrent)}}})},i2=(bh(function(c,b,a){return c.getField(b,a)}),function(g){var b,d=(b=[],{field:function(l,j){return b.push(l),h="form",i=iq(l),k=j,{uiType:ok(),owner:h,name:i,config:k,validated:{}};var h,i,k},record:function(){return b}}),a=g(d),c=d.record(),f=ij(c,function(e){return hB({name:e,pname:iq(e)})});return nj("form",ub,f,jP,a)}),dj=function(){var b=dH(uI.none()),a=function(){b.get().each(function(c){c.destroy()})};return{clear:function(){a(),b.set(uI.none())},isSet:function(){return b.get().isSome()},set:function(c){a(),b.set(uI.some(c))},run:function(c){b.get().each(c)}}},dK=function(){var a=dH(uI.none());return{clear:function(){a.set(uI.none())},set:function(b){a.set(uI.some(b))},isSet:function(){return a.get().isSome()},on:function(b){a.get().each(b)}}},e4=function(a){return{xValue:a,points:[]}},lH=function(d,c){if(c===d.xValue){return d}var a=0<c-d.xValue?1:-1,b={direction:a,xValue:c};return{xValue:c,points:(0===d.points.length?[]:d.points[d.points.length-1].direction===a?d.points.slice(0,d.points.length-1):d.points).concat([b])}},p1=function(c){if(0===c.points.length){return 0}var b=c.points[0].direction,a=c.points[c.points.length-1].direction;return -1===b&&-1===a?-1:1===b&&1===a?1:0},j5=function(f){var b="navigateEvent",h=aj([k3("fields"),o8("maxFieldIndex",f.fields.length-1),k3("onExecute"),k3("getInitialValue"),kw("state",function(){return{dialogSwipeState:dK(),currentScreen:dH(0)}})]),l=oR("SerialisedDialog",h,f),d=function(c,i,a){return mF.sketch({dom:o7('<span class="${prefix}-icon-'+i+' ${prefix}-icon"></span>'),action:function(e){qQ(e,b,{direction:c})},buttonBehaviours:nM([q3.config({disableClass:fS.resolve("toolbar-navigation-disabled"),disabled:!a})])})},g=function(e,c){var a=oO(e.element(),"."+fS.resolve("serialised-dialog-screen"));ox(e.element(),"."+fS.resolve("serialised-dialog-chain")).each(function(i){0<=l.state.currentScreen.get()+c&&l.state.currentScreen.get()+c<a.length&&(aA.getRaw(i,"left").each(function(q){var p=parseInt(q,10),o=bx(a[0]);aA.set(i,"left",p-c*o+"px")}),l.state.currentScreen.set(l.state.currentScreen.get()+c))})},k=function(a){var i=oO(a.element(),"input");uI.from(i[l.state.currentScreen.get()]).each(function(e){a.getSystem().getByDom(e).each(function(q){var p,o;p=a,o=q.element(),p.getSystem().triggerFocus(o,p.element())})});var c=m.get(a);jU.highlightAt(c,l.state.currentScreen.get())},j=mQ(i2(function(a){return{dom:o7('<div class="${prefix}-serialised-dialog"></div>'),components:[a8.sketch({dom:o7('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:ij(l.fields,function(i,c){return c<=l.maxFieldIndex?a8.sketch({dom:o7('<div class="${prefix}-serialised-dialog-screen"></div>'),components:kQ([[d(-1,"previous",0<c)],[a.field(i.name,i.spec)],[d(1,"next",c<l.maxFieldIndex)]])}):a.field(i.name,i.spec)})})],formBehaviours:nM([kT(function(o,i){var c;c=i,ox(o.element(),"."+fS.resolve("serialised-dialog-chain")).each(function(e){aA.set(e,"left",-l.state.currentScreen.get()*c.width+"px")})}),lB.config({mode:"special",focusIn:function(c){k(c)},onTab:function(c){return g(c,1),uI.some(!0)},onShiftTab:function(c){return g(c,-1),uI.some(!0)}}),bV("form-events",[lA(function(i,o){l.state.currentScreen.set(0),l.state.dialogSwipeState.clear();var c=m.get(i);jU.highlightFirst(c),l.getInitialValue(i).each(function(e){bN.setValue(i,e)})}),kM(l.onExecute),jJ(uk(),function(i,c){"left"===c.event().raw().propertyName&&k(i)}),jJ(b,function(o,i){var c=i.event().direction();g(o,c)})])])}})),m=mQ({dom:o7('<div class="${prefix}-dot-container"></div>'),behaviours:nM([jU.config({highlightClass:fS.resolve("dot-active"),itemClass:fS.resolve("dot-item")})]),components:m0(l.fields,function(c,a){return a<=l.maxFieldIndex?[rq('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]})});return{dom:o7('<div class="${prefix}-serializer-wrapper"></div>'),components:[j.asSpec(),m.asSpec()],behaviours:nM([lB.config({mode:"special",focusIn:function(c){var a=j.get(c);lB.focusIn(a)}}),bV("serializer-wrapper-events",[jJ(uh(),function(i,c){var a=c.event();l.state.dialogSwipeState.set(e4(a.touches[0].clientX))}),jJ(tT(),function(i,c){var a=c.event();l.state.dialogSwipeState.on(function(e){c.event().prevent(),l.state.dialogSwipeState.set(lH(e,a.raw().touches[0].clientX))})}),jJ(t3(),function(a){l.state.dialogSwipeState.on(function(o){var i=j.get(a),c=-1*p1(o);g(i,c)})})])])}},kS=tN(function(a,b){return[{label:"the link group",items:[j5({fields:[oF("url","Type or paste URL"),oF("text","Link text"),oF("title","Link title"),oF("target","Link target"),(c="link",{name:c,spec:bF.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return uI.none()}})})],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return uI.some(gb.getInfo(b))},onExecute:function(f){var d=bN.getValue(f);gb.applyInfo(b,d),a.restoreToolbar(),b.focus()}})]}];var c}),m2=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],d0=t0([(dN=iJ(),e7=function(g,d){var b,c,f=d.event().originator(),a=d.event().target();return c=a,!(hO(b=f,g.element())&&!hO(b,c)&&(console.warn(iJ()+" did not get interpreted by the desired target. \nOriginator: "+nN(f)+"\nTarget: "+nN(a)+"\nCheck the "+iJ()+" event handlers"),1))},{key:dN,value:n2({can:e7})})]),fR=Object.freeze({events:d0}),hb=tx,fB=bO(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn","isConnected"]),mq=function(a){var b=function(c){return function(){throw new Error("The component must be in a context to send: "+c+"\n"+nN(a().element())+" is not in context.")}};return fB({debugInfo:uC("fake"),triggerEvent:b("triggerEvent"),triggerFocus:b("triggerFocus"),triggerEscape:b("triggerEscape"),build:b("build"),addToWorld:b("addToWorld"),removeFromWorld:b("removeFromWorld"),addToGui:b("addToGui"),removeFromGui:b("removeFromGui"),getByUid:b("getByUid"),getByDom:b("getByDom"),broadcast:b("broadcast"),broadcastOn:b("broadcastOn"),isConnected:uC(!1)})},jy=function(c,b){var a={};return tS(c,function(e,d){tS(e,function(h,g){var f=lw(g,[])(a);a[g]=f.concat([b(d,h)])})}),a},b8=function(b,a){return 1<b.length?uN.error('Multiple behaviours have tried to change DOM "'+a+'". The guilty behaviours are: '+l4(ij(b,function(c){return c.name()}))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===b.length?uN.value({}):uN.value(b[0].modification().fold(function(){return{}},function(c){return jV(a,c)}))},hX=function(c,b){return dI(c,function(f,d){var a=d.modification().getOr({});return f.bind(function(e){var g=tq(a,function(l,j){return e[j]!==undefined?(h=b,i=j,k=c,uN.error("Mulitple behaviours have tried to change the _"+i+'_ "'+h+'". The guilty behaviours are: '+l4(m0(k,function(m){return m.modification().getOr({})[i]!==undefined?[m.name()]:[]}),null,2)+". This is not currently supported.")):uN.value(jV(j,l));var h,i,k});return mS(g,e)})},uN.value({})).map(function(a){return jV(b,a)})},hH={classes:function(c,b){var a=m0(c,function(d){return d.modification().getOr([])});return uN.value(jV(b,a))},attributes:hX,styles:hX,domChildren:b8,defChildren:b8,innerHtml:b8,value:b8},qx=function(d,c){return a=th.apply(undefined,[d.handler].concat(c)),b=d.purpose(),{cHandler:a,purpose:uC(b)};var a,b},f7=function(a){return a.cHandler},cV=function(b,a){return{name:uC(b),handler:uC(a)}},eN=function(g,d,b){var c,f,a=uG(b,(c=g,f={},jN(d,function(e){f[e.name()]=e.handlers(c)}),f));return jy(a,cV)},az=function(c){var b,a=sR(b=c)?{can:uC(!0),abort:uC(!1),run:b}:b;return function(i,g){for(var d=[],f=2;f<arguments.length;f++){d[f-2]=arguments[f]}var h=[i,g].concat(d);a.abort.apply(undefined,h)?g.stop():a.can.apply(undefined,h)&&a.run.apply(undefined,h)}},bS=function(g,d,b){var c,f,a=d[b];return a?function(i,h,o,m){var l=o.slice(0);try{var j=l.sort(function(w,u){var q=w[h](),s=u[h](),v=m.indexOf(q),p=m.indexOf(s);if(-1===v){throw new Error("The ordering for "+i+" does not have an entry for "+q+".\nOrder specified: "+l4(m,null,2))}if(-1===p){throw new Error("The ordering for "+i+" does not have an entry for "+s+".\nOrder specified: "+l4(m,null,2))}return v<p?-1:p<v?1:0});return uN.value(j)}catch(k){return uN.error([k])}}("Event: "+b,"name",g,a).map(function(i){var h=ij(i,function(e){return e.handler()});return qY(h)}):(c=b,f=g,uN.error(["The event ("+c+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+l4(ij(f,function(e){return e.name()}),null,2)]))},cF=function(c,a){var b=tq(c,function(d,e){return(1===d.length?uN.value(d[0].handler()):bS(d,a,e)).map(function(h){var g=az(h),f=1<d.length?i0(a,function(i){return q1(d,function(j){return j.name()===i})}).join(" > "):d[0].name();return jV(e,{handler:g,purpose:uC(f)})})});return mS(b,{})},iL=function(b){return eb("custom.definition",eH([nK("dom","dom",pE(),eH([k3("tag"),o8("styles",{}),o8("classes",[]),o8("attributes",{}),rN("value"),rN("innerHtml")])),k3("components"),k3("uid"),o8("events",{}),o8("apis",uC({})),nK("eventOrder","eventOrder",(a={"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]},mD.mergeWithThunk(uC(a))),oA()),rN("domModification"),sH("originalSpec"),o8("debug.sketcher","unknown")]),b);var a},nQ=function(c){var b,a={tag:c.dom().tag(),classes:c.dom().classes(),attributes:uG((b=c,jV(g0(),b.uid())),c.dom().attributes()),styles:c.dom().styles(),domChildren:ij(c.components(),function(d){return d.element()})};return fN(uG(a,c.dom().innerHtml().map(function(d){return jV("innerHtml",d)}).getOr({}),c.dom().value().map(function(d){return jV("value",d)}).getOr({})))},a5=function(a,b){jN(b,function(c){t5.add(a,c)})},bC=function(a,b){jN(b,function(c){t5.remove(a,c)})},gE=function(a){if(a.domChildren().isSome()&&a.defChildren().isSome()){throw new Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+(b=g6(a),l4(b,null,2)))}return a.domChildren().fold(function(){var c=a.defChildren().getOr([]);return ij(c,ex)},function(c){return c});var b},gU=function(c){var b=rW.fromTag(c.tag());nx.setAll(b,c.attributes().getOr({})),a5(b,c.classes().getOr([])),aA.setAll(b,c.styles().getOr({})),aw(b,c.innerHtml().getOr(""));var a=gE(c);return gI(b,a),c.value().each(function(d){gH(b,d)}),b},ex=function(b){var a=fN(b);return gU(a)},aP=function(g,d){return b=g,f=ij(c=d,function(e){return pG(e.name(),[k3("config"),o8("state",cz)])}),a=eb("component.behaviours",aj(f),b.behaviours).fold(function(e){throw new Error(lS(e)+"\nComplete spec:\n"+l4(b,null,2))},function(e){return e}),{list:c,data:ux(a,function(i){var h=i().map(function(e){return{config:e.config(),state:e.state().init(e.config())}});return function(){return h}})};var b,c,f,a},o1=function(d){var c,a,b=(c=pV(d,"behaviours").getOr({}),a=i0(uB(c),function(e){return c[e]!==undefined}),ij(a,function(e){return c[e].me}));return aP(d,b)},sq=bO(["getSystem","config","hasConfigured","spec","connect","disconnect","element","syncComponents","readState","components","events"]),l6=function(f,h,m){var b,d,g,l,k=nQ(f),j=function(w,y,s,v){var x=uG({},y);jN(s,function(a){x[a.name()]=a.exhibit(w,v)});var q=jy(x,function(i,a){return{name:function(){return i},modification:a}}),p=ux(q,function(i,a){return m0(i,function(n){return n.modification().fold(function(){return[]},function(e){return[n]})})}),c=tq(p,function(i,a){return pV(hH,a).fold(function(){return uN.error("Unknown field type: "+a)},function(e){return e(i,a)})});return mS(c,{}).map(fx)}(m,{"alloy.base.modification":(b=f,b.domModification().fold(function(){return fx({})},fx))},h,k).getOrDie();return g=j,l=uG({tag:(d=k).tag(),classes:g.classes().getOr([]).concat(d.classes().getOr([])),attributes:uF(d.attributes().getOr({}),g.attributes().getOr({})),styles:uF(d.styles().getOr({}),g.styles().getOr({}))},g.innerHtml().or(d.innerHtml()).map(function(a){return jV("innerHtml",a)}).getOr({}),l8("domChildren",g.domChildren(),d.domChildren()),l8("defChildren",g.defChildren(),d.defChildren()),g.value().or(d.value()).map(function(a){return jV("value",a)}).getOr({})),fN(l)},nF=function(f,h,m){var b,d,g,l,k,j,p={"alloy.base.behaviour":(b=f,b.events())};return(d=m,g=f.eventOrder(),l=h,k=p,j=eN(d,l,k),cF(j,g)).getOrDie()},oK=function(z){var G,k,w,y,C,j,J,I,q,F,B,H,A,E,b=hb(z),x=(G=b,k=lw("components",[])(G),ij(k,uZ)),D=uG(fR,b,jV("components",x));return uN.value((w=D,C=dH(mq(y=function(){return E})),j=aJ(iL(uG(w,{behaviours:undefined}))),J=o1(w),I=J.list,q=J.data,F=l6(j,I,q),B=gU(F),H=nF(j,I,q),A=dH(j.components()),E=sq({getSystem:C.get,config:function(c){if(c===bI()){return j.apis()}if(tI(c)){throw new Error("Invalid input: only API constant is allowed")}var a=q;return(sR(a[c.name()])?a[c.name()]:function(){throw new Error("Could not find "+c.name()+" in "+l4(w,null,2))})()},hasConfigured:function(a){return sR(q[a.name()])},spec:uC(w),readState:function(a){return q[a]().map(function(c){return c.state.readState()}).getOr("not enabled")},connect:function(a){C.set(a)},disconnect:function(){C.set(mq(y))},element:uC(B),syncComponents:function(){var c=cK.children(B),a=m0(c,function(d){return C.get().getByDom(d).fold(function(){return[]},function(e){return[e]})});A.set(a)},components:A.get,events:uC(H)})))},qR=function(b){var a=rW.fromText(b);return ly({element:a})},ly=function(d){var a=r4("external.component",eH([k3("element"),rN("uid")]),d),c=dH(mq());a.uid().each(function(g){var f;f=a.element(),nx.set(f,aV,g)});var b=sq({getSystem:c.get,config:uI.none,hasConfigured:uC(!1),connect:function(e){c.set(e)},disconnect:function(){c.set(mq(function(){return b}))},element:uC(a.element()),spec:uC(d),readState:uC("No state"),syncComponents:tk,components:uC([]),events:uC({})});return nW(b)},uZ=function(a){return(b=a,pV(b,cP)).fold(function(){var c=uG({uid:r3("")},a);return oK(c).getOrDie()},function(c){return c});var b},tG=nW,mU="alloy.item-hover",rX="alloy.item-focus",pQ=function(a){(jq(a.element()).isNone()||b9.isFocused(a))&&(b9.isFocused(a)||b9.focus(a),qQ(a,mU,{item:a}))},sL=function(a){qQ(a,rX,{item:a})},pz=uC(mU),rG=uC(rX),kK=[k3("data"),k3("components"),k3("dom"),rN("toggling"),o8("itemBehaviours",{}),o8("ignoreFocus",!1),o8("domModification",{}),pM("builder",function(c){return{dom:uG(c.dom(),{attributes:{role:c.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:uG(nM([c.toggling().fold(p2.revoke,function(d){return p2.config(uG({aria:{mode:"checked"}},d))}),b9.config({ignore:c.ignoreFocus(),onFocus:function(d){sL(d)}}),lB.config({mode:"execution"}),bN.config({store:{mode:"memory",initialValue:c.data()}})]),c.itemBehaviours()),events:t0([(b=eq(),a=lx,jJ(b,function(f,d){var g=d.event();f.getSystem().getByDom(g.target()).each(function(e){a(f,e,d)})})),eZ(tM()),jJ(uz(),pQ),jJ(gC(),b9.focus)]),components:c.components(),domModification:c.domModification(),eventOrder:c.eventOrder()};var b,a}),o8("eventOrder",{})],oj=[k3("dom"),k3("components"),pM("builder",function(b){return{dom:b.dom(),components:b.components(),events:t0([(a=gC(),jJ(a,function(d,c){c.stop()}))])};var a})],q8=uC([hB({name:"widget",overrides:function(a){return{behaviours:nM([bN.config({store:{mode:"manual",getValue:function(b){return a.data()},setValue:function(){}}})])}}})]),uE=[k3("uid"),k3("data"),k3("components"),k3("dom"),o8("autofocus",!1),o8("domModification",{}),bY(q8()),pM("builder",function(a){var f=qD(0,a,q8()),c=gk("item-widget",a,f.internals()),b=function(e){return c1(e,a,"widget").map(function(g){return lB.focusIn(g),g})},d=function(h,g){return fk(g.event().target())||a.autofocus()&&g.setSource(h.element()),uI.none()};return uG({dom:a.dom(),components:c,domModification:a.domModification(),events:t0([kM(function(h,g){b(h).each(function(e){g.stop()})}),jJ(uz(),pQ),jJ(gC(),function(h,g){a.autofocus()?b(h):b9.focus(h)})]),behaviours:nM([bN.config({store:{mode:"memory",initialValue:a.data()}}),b9.config({onFocus:function(e){sL(e)}}),lB.config({mode:"special",focusIn:a.autofocus()?function(e){b(e)}:gQ(),onLeft:d,onRight:d,onEscape:function(h,g){return b9.isFocused(h)||a.autofocus()?(a.autofocus()&&g.setSource(h.element()),uI.none()):(b9.focus(h),uI.some(!0))}})])})})],iD=nk("type",{widget:uE,item:kK,separator:oj}),jX=uC([mE({factory:{sketch:function(b){var a=r4("menu.spec item",iD,b);return a.builder()(a)}},name:"items",unit:"item",defaults:function(c,b){var a=r3("");return uG({uid:a},b)},overrides:function(b,a){return{type:a.type,ignoreFocus:b.fakeFocus(),domModification:{classes:[b.markers().item()]}}}})]),jb=uC([k3("value"),k3("items"),k3("dom"),k3("components"),o8("eventOrder",{}),u1("menuBehaviours",[jU,bN,nT,lB]),rw("movement",{mode:"menu",moveOnTab:!0},nk("mode",{grid:[pq(),pM("config",function(b,a){return{mode:"flatgrid",selector:"."+b.markers().item(),initSize:{numColumns:a.initSize().numColumns(),numRows:a.initSize().numRows()},focusManager:b.focusManager()}})],menu:[o8("moveOnTab",!0),pM("config",function(b,a){return{mode:"menu",selector:"."+b.markers().item(),moveOnTab:a.moveOnTab(),focusManager:b.focusManager()}})]})),uP("markers",oG()),o8("fakeFocus",!1),o8("focusManager",kH()),uV("onHighlight")]),dy=uC("alloy.menu-focus"),dP=s0({name:"Menu",configFields:jb(),partFields:jX(),factory:function(d,c,a,b){return uG({dom:uG(d.dom(),{attributes:{role:"menu"}}),uid:d.uid(),behaviours:uG(nM([jU.config({highlightClass:d.markers().selectedItem(),itemClass:d.markers().item(),onHighlight:d.onHighlight()}),bN.config({store:{mode:"memory",initialValue:d.value()}}),nT.config({find:uI.some}),lB.config(d.movement().config()(d,d.movement()))]),tJ(d.menuBehaviours())),events:t0([jJ(rG(),function(g,f){var h=f.event();g.getSystem().getByDom(h.target()).each(function(e){jU.highlight(g,e),f.stop(),qQ(g,dy(),{menu:g,item:e})})}),jJ(pz(),function(h,g){var f=g.event().item();jU.highlight(h,f)})]),components:c,eventOrder:d.eventOrder()})}}),e9=function(f,c,a,b){var d=f.getSystem().build(b);lP(f,d,a)},lO=function(b,a){return b.components()},p6=Object.freeze({append:function(d,c,a,b){e9(d,0,a9.append,b)},prepend:function(d,c,a,b){e9(d,0,a9.prepend,b)},remove:function(f,c,a,b){var d=lO(f,c);e2(d,function(e){return hO(b.element(),e.element())}).each(oy)},set:function(h,f,m,b){var d,g,l,k,j,p;g=(d=h).components(),jN(g,nb),eB.empty(d.element()),d.syncComponents(),l=function(){var a=ij(b,h.getSystem().build);jN(a,function(c){r2(h,c)})},k=h.element(),j=cK.owner(k),p=mh(j).bind(function(a){var c=function(e){return hO(a,e)};return c(k)?uI.some(k):kP.descendant(k,c)}),l(k),p.each(function(a){mh(j).filter(function(c){return hO(c,a)}).fold(function(){g7(a)},tk)})},contents:lO}),kj=by({fields:[],name:"replacing",apis:p6}),kZ=function(a,b,c,d){return pV(c,d).bind(function(e){return pV(a,e).bind(function(g){var f=kZ(a,b,c,g);return uI.some([g].concat(f))})}).getOr([])},m9=function(g,d){var b={};tS(g,function(i,h){jN(i,function(e){b[e]=h})});var c=d,f=sO(d,function(i,h){return{k:i,v:h}}),a=ux(f,function(i,h){return[h].concat(kZ(b,c,f,h))});return ux(b,function(e){return pV(a,e).getOr([e])})},d5=function(){var e=dH({}),d=dH({}),b=dH({}),h=dH(uI.none()),f=dH({}),g=function(a){return pV(d.get(),a)};return{setContents:function(k,i,a,c){h.set(uI.some(k)),e.set(a),d.set(i),f.set(c);var j=m9(c,a);b.set(j)},expand:function(a){return pV(e.get(),a).map(function(i){var c=pV(b.get(),a).getOr([]);return[i].concat(c)})},refresh:function(a){return pV(b.get(),a)},collapse:function(a){return pV(b.get(),a).bind(function(c){return 1<c.length?uI.some(c.slice(1)):uI.none()})},lookupMenu:g,otherMenus:function(j){var i,a,c=f.get();return i=uB(c),a=j,i0(i,function(k){return !q1(a,k)})},getPrimary:function(){return h.get().bind(g)},getMenus:function(){return d.get()},clear:function(){e.set({}),d.set({}),b.set({}),h.set(uI.none())},isClear:function(){return h.get().isNone()}}},fW=uC("collapse-item"),hy=uO({name:"TieredMenu",configFields:[rT("onExecute"),rT("onEscape"),mN("onOpenMenu"),mN("onOpenSubmenu"),uV("onCollapseMenu"),o8("openImmediately",!0),mG("data",[k3("primary"),k3("menus"),k3("expansions")]),o8("fakeFocus",!1),uV("onHighlight"),uV("onHover"),mG("markers",[k3("backgroundMenu")].concat(lZ()).concat(nB())),k3("dom"),o8("navigateOnHover",!0),o8("stayInDom",!1),u1("tmenuBehaviours",[lB,jU,nT,kj]),o8("eventOrder",{})],apis:{collapseMenu:function(b,a){b.collapseMenu(a)}},factory:function(y,g){var p=function(a,c){return ux(c,function(i,f){var d=dP.sketch(uG(i,{value:f,items:i.items,markers:c5(g.markers,["item","selectedItem"]),fakeFocus:y.fakeFocus(),onHighlight:y.onHighlight(),focusManager:y.fakeFocus()?{get:function(e){return jU.getHighlighted(e).map(function(l){return l.element()})},set:function(l,m){l.getSystem().getByDom(m).fold(tk,function(e){jU.highlight(l,e)})}}:kH()}));return a.getSystem().build(d)})},x=d5(),w=function(a){return bN.getValue(a).value},z=function(a){return ux(y.data().menus(),function(d,c){return m0(d.items,function(e){return"separator"===e.type?[]:[e.data.value]})})},q=function(a,c){jU.highlight(a,c),jU.getHighlighted(c).orThunk(function(){return jU.getFirst(c)}).each(function(d){uY(a,d.element(),gC())})},k=function(c,a){return bz(ij(a,c.lookupMenu))},v=function(c,d,a){return uI.from(a[0]).bind(d.lookupMenu).map(function(l){var i=k(d,a.slice(1));jN(i,function(e){t5.add(e.element(),y.markers().backgroundMenu())}),i9.inBody(l.element())||kj.append(c,tG(l)),bC(l.element(),[y.markers().backgroundMenu()]),q(c,l);var f=k(d,d.otherMenus(a));return jN(f,function(e){bC(e.element(),[y.markers().backgroundMenu()]),y.stayInDom()||kj.remove(c,e)}),l})},j=function(c,a){var d=w(a);return x.expand(d).bind(function(e){return uI.from(e[0]).bind(x.lookupMenu).each(function(f){i9.inBody(f.element())||kj.append(c,tG(f)),y.onOpenSubmenu()(c,a,f),jU.highlightFirst(f)}),v(c,x,e)})},b=function(c,a){var d=w(a);return x.collapse(d).bind(function(e){return v(c,x,e).map(function(f){return y.onCollapseMenu()(c,a,f),f})})},h=function(a){return function(c,d){return qG(d.getSource(),"."+y.markers().item()).bind(function(e){return c.getSystem().getByDom(e).toOption().bind(function(f){return a(c,f).map(function(){return !0})})})}},t=t0([jJ(dy(),function(d,c){var a=c.event().menu();jU.highlight(d,a)}),kM(function(c,d){var a=d.event().target();c.getSystem().getByDom(a).each(function(e){0===w(e).indexOf("collapse-item")&&b(c,e),j(c,e).fold(function(){y.onExecute()(c,e)},function(){})})}),lA(function(d,i){var a,c,f;(a=d,c=p(a,y.data().menus()),f=z(a),x.setContents(y.data().primary(),c,y.data().expansions(),f),x.getPrimary()).each(function(e){kj.append(d,tG(e)),y.openImmediately()&&(q(d,e),y.onOpenMenu()(d,e))})})].concat(y.navigateOnHover()?[jJ(pz(),function(i,d){var a,c,f=d.event().item();a=i,c=w(f),x.refresh(c).bind(function(e){return v(a,x,e)}),j(i,f),y.onHover()(i,f)})]:[]));return{uid:y.uid(),dom:y.dom(),behaviours:uG(nM([lB.config({mode:"special",onRight:h(function(c,a){return fk(a.element())?uI.none():j(c,a)}),onLeft:h(function(c,a){return fk(a.element())?uI.none():b(c,a)}),onEscape:h(function(c,a){return b(c,a).orThunk(function(){return y.onEscape()(c,a).map(function(){return c})})}),focusIn:function(a,c){x.getPrimary().each(function(d){uY(a,d.element(),gC())})}}),jU.config({highlightClass:y.markers().selectedMenu(),itemClass:y.markers().menu()}),nT.config({find:function(a){return jU.getHighlighted(a)}}),kj.config({})]),tJ(y.tmenuBehaviours())),eventOrder:y.eventOrder(),apis:{collapseMenu:function(a){jU.getHighlighted(a).each(function(c){jU.getHighlighted(c).each(function(d){b(a,d)})})}},events:t}},extraApis:{tieredData:function(c,b,a){return{primary:c,menus:b,expansions:a}},singleData:function(b,a){return{primary:b,menus:jV(b,a),expansions:{}}},collapseItem:function(a){return{value:uH(fW()),text:a}}}}),fG=function(d,c,a,b){return pV(c.routes(),b.start()).map(sX).bind(function(e){return pV(e,b.destination()).map(sX)})},mC=function(d,c,a,b){return fG(0,c,0,b).bind(function(f){return f.transition().map(function(e){return{transition:uC(e),route:uC(f)}})})},jF=function(b,c,g){var d,f,a;(d=b,f=c,a=g,cx(d,f,a).bind(function(e){return mC(d,f,a,e)})).each(function(i){var h=i.transition();t5.remove(b.element(),h.transitionClass()),nx.remove(b.element(),c.destinationAttr())})},cx=function(d,c,a){var b=d.element();return nx.has(b,c.destinationAttr())?uI.some({start:uC(nx.get(d.element(),c.stateAttr())),destination:uC(nx.get(d.element(),c.destinationAttr()))}):uI.none()},h4=function(d,c,a,b){jF(d,c,a),nx.has(d.element(),c.stateAttr())&&nx.get(d.element(),c.stateAttr())!==b&&c.onFinish()(d,b),nx.set(d.element(),c.stateAttr(),b)},hP=Object.freeze({findRoute:fG,disableTransition:jF,getCurrentRoute:cx,jumpTo:h4,progressTo:function(m,b,d,g){var f,h;h=b,nx.has((f=m).element(),h.destinationAttr())&&(nx.set(f.element(),h.stateAttr(),nx.get(f.element(),h.destinationAttr())),nx.remove(f.element(),h.destinationAttr()));var l,k,j=(l=b,k=g,{start:uC(nx.get(m.element(),l.stateAttr())),destination:uC(k)});mC(m,b,d,j).fold(function(){h4(m,b,d,g)},function(c){jF(m,b,d);var a=c.transition();t5.add(m.element(),a.transitionClass()),nx.set(m.element(),b.destinationAttr(),g)})},getState:function(d,c,a){var b=d.element();return nx.has(b,c.stateAttr())?uI.some(nx.get(b,c.stateAttr())):uI.none()}}),qC=Object.freeze({events:function(b,a){return t0([jJ(uk(),function(c,e){var d=e.event().raw();cx(c,b,a).each(function(f){fG(0,b,0,f).each(function(g){g.transition().each(function(h){d.propertyName===h.property()&&(h4(c,b,a,f.destination()),b.onTransition()(c,f))})})})}),lA(function(d,c){h4(d,b,a,b.initialState())})])}}),gj=[o8("destinationAttr","data-transitioning-destination"),o8("stateAttr","data-transitioning-state"),k3("initialState"),uV("onTransition"),uV("onFinish"),uP("routes",bM(uN.value,bM(uN.value,eH([sC("transition",[k3("property"),k3("transitionClass")])]))))],c0=by({fields:gj,name:"transitioning",active:qC,apis:hP,extra:{createRoutes:function(b){var a={};return tS(b,function(f,d){var c=d.split("<->");a[c[0]]=jV(c[1],f),a[c[1]]=jV(c[0],f)}),a},createBistate:function(c,b,a){return kI([{key:c,value:jV(b,a)},{key:b,value:jV(c,a)}])},createTristate:function(d,c,a,b){return kI([{key:d,value:kI([{key:c,value:b},{key:a,value:b}])},{key:c,value:kI([{key:d,value:b},{key:a,value:b}])},{key:a,value:kI([{key:d,value:b},{key:c,value:b}])}])}}}),eS=fS.resolve("scrollable"),aE={register:function(a){t5.add(a,eS)},deregister:function(a){t5.remove(a,eS)},scrollable:uC(eS)},bX=function(a){return pV(a,"format").getOr(a.title)},cM=function(f,c,a,b,d){return{data:{value:f,text:c},type:"item",dom:{tag:"div",classes:d?[fS.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:fS.resolve("format-matches"),selected:a},itemBehaviours:nM(d?[]:[j6(f,function(h,g){(g?p2.on:p2.off)(h)})]),components:[{dom:{tag:"div",attributes:{style:b},innerHtml:c}}]}},iS=function(d,c,a,b){return{value:d,dom:{tag:"div"},components:[mF.sketch({dom:{tag:"div",classes:[fS.resolve("styles-collapser")]},components:b?[{dom:{tag:"span",classes:[fS.resolve("styles-collapse-icon")]}},qR(d)]:[qR(d)],action:function(g){if(b){var f=a().get(g);hy.collapseMenu(f)}}}),{dom:{tag:"div",classes:[fS.resolve("styles-menu-items-container")]},components:[dP.parts().items({})],behaviours:nM([bV("adhoc-scrollable-menu",[lA(function(g,f){aA.set(g.element(),"overflow-y","auto"),aA.set(g.element(),"-webkit-overflow-scrolling","touch"),aE.register(g.element())}),pX(function(e){aA.remove(e.element(),"overflow-y"),aA.remove(e.element(),"-webkit-overflow-scrolling"),aE.deregister(e.element())})])])}],items:c,menuBehaviours:nM([c0.config({initialState:"after",routes:c0.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}},nV=function(g){var j,f,k,h,d,c=(j=g.formats,f=function(){return b},k=iS("Styles",[].concat(ij(j.items,function(a){return cM(bX(a),a.title,a.isSelected(),a.getPreview(),dU(j.expansions,bX(a)))})),f,!1),h=ux(j.menus,function(l,i){var a=ij(l,function(e){return cM(bX(e),e.title,e.isSelected!==undefined&&e.isSelected(),e.getPreview!==undefined?e.getPreview():"",dU(j.expansions,bX(e)))});return iS(i,a,f,!0)}),d=uG(h,jV("styles",k)),{tmenu:hy.tieredData("styles",d,j.expansions)}),b=mQ(hy.sketch({dom:{tag:"div",classes:[fS.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(l,i){var a=bN.getValue(i);return g.handle(i,a.value),uI.none()},onEscape:function(){return uI.none()},onOpenMenu:function(l,i){var a=bx(l.element());a0(i.element(),a),c0.jumpTo(i,"current")},onOpenSubmenu:function(s,p,l){var m=bx(s.element()),q=m8(p.element(),'[role="menu"]').getOrDie("hacky"),a=s.getSystem().getByDom(q).getOrDie();a0(l.element(),m),c0.progressTo(a,"before"),c0.jumpTo(l,"after"),c0.progressTo(l,"current")},onCollapseMenu:function(p,l,a){var i=m8(l.element(),'[role="menu"]').getOrDie("hacky"),m=p.getSystem().getByDom(i).getOrDie();c0.progressTo(m,"after"),c0.progressTo(a,"current")},navigateOnHover:!1,openImmediately:!0,data:c.tmenu,markers:{backgroundMenu:fS.resolve("styles-background-menu"),menu:fS.resolve("styles-menu"),selectedMenu:fS.resolve("styles-selected-menu"),item:fS.resolve("styles-item"),selectedItem:fS.resolve("styles-selected-item")}}));return b.asSpec()},bb=function(d){return dU(d,"items")?(a=uG(dD(c=d,["items"]),{menu:!0}),b=bH(c.items),{item:a,menus:uG(b.menus,jV(c.title,b.items)),expansions:uG(b.expansions,jV(c.title,c.title))}):{item:d,menus:{},expansions:{}};var c,a,b},bH=function(a){return db(a,function(d,c){var b=bb(c);return{menus:uG(d.menus,b.menus),items:[b.item].concat(d.items),expansions:uG(d.expansions,b.expansions)}},{menus:{},expansions:{},items:[]})},gJ={expand:bH},gZ=function(d,i){var b=function(a){return function(){return d.formatter.match(a)}},h=function(a){return function(){return d.formatter.getCssText(a)}},g=pV(i,"style_formats").getOr(m2),f=function(a){return ij(a,function(p){if(dU(p,"items")){var l=f(p.items);return uG(uG(p,{isSelected:uC(!1),getPreview:uC("")}),{items:l})}return dU(p,"format")?uG(c=p,{isSelected:b(c.format),getPreview:h(c.format)}):(k=uH((j=p).title),m=uG(j,{format:k,isSelected:b(k),getPreview:h(k)}),d.formatter.register(k,m),m);var j,k,m,c})};return f(g)},eC=function(c,h,d){var f,g,b,a=(f=c,b=(g=function(e){return m0(e,function(i){return i.items!==undefined?0<g(i.items).length?[i]:[]:!dU(i,"format")||f.formatter.canApply(i.format)?[i]:[]})})(h),gJ.expand(b));return nV({formats:a,handle:function(j,i){c.undoManager.transact(function(){p2.isOn(j)?c.formatter.remove(i):c.formatter.apply(i)}),d()}})},aU=["undo","bold","italic","link","image","bullist","styleselect"],oV=function(b){var a=b.replace(/\|/g," ").trim();return 0<a.length?a.split(/\s+/):[]},r8=function(a){return m0(a,function(b){return s3(b)?r8(b):oV(b)})},lX=function(b){var a=b.toolbar!==undefined?b.toolbar:aU;return s3(a)?r8(a):oV(a)},nz=function(b,j){var k=function(a){return function(){return qX.forToolbarCommand(j,a)}},A=function(a){return function(){return qX.forToolbarStateCommand(j,a)}},G=function(d,c,a){return function(){return qX.forToolbarStateAction(j,d,c,a)}},x=k("undo"),F=k("redo"),D=A("bold"),C=A("italic"),H=A("underline"),z=k("removeformat"),w=G("unlink","link",function(){j.execCommand("unlink",null,!1)}),B=G("unordered-list","ul",function(){j.execCommand("InsertUnorderedList",null,!1)}),q=G("ordered-list","ol",function(){j.execCommand("InsertOrderedList",null,!1)}),y=gZ(j,j.settings),E=function(){return eC(j,y,function(){j.fire("scrollIntoView")})},h=function(c,a){return{isSupported:function(){return c.forall(function(d){return dU(j.buttons,d)})},sketch:a}};return{undo:h(uI.none(),x),redo:h(uI.none(),F),bold:h(uI.none(),D),italic:h(uI.none(),C),underline:h(uI.none(),H),removeformat:h(uI.none(),z),link:h(uI.none(),function(){return c=b,a=j,qX.forToolbarStateAction(a,"link","link",function(){var d=kS(c,a);c.setContextToolbar(d),aC(a,function(){c.focusToolbar()}),gb.query(a).each(function(e){a.selection.select(e.dom())})});var c,a}),unlink:h(uI.none(),w),image:h(uI.none(),function(){return fE(j)}),bullist:h(uI.some("bullist"),B),numlist:h(uI.some("numlist"),q),fontsizeselect:h(uI.none(),function(){return a=j,c={onChange:function(d){lk.apply(a,d)},getInitialValue:function(){return lk.get(a)}},eh(b,"font-size",function(){return tC(c)});var a,c}),forecolor:h(uI.none(),function(){return oZ(b,j)}),styleselect:h(uI.none(),function(){return qX.forToolbar("style-formats",function(a){j.fire("toReading"),b.dropup().appear(E,p2.on,a)},nM([p2.config({toggleClass:fS.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),kD.config({channels:kI([m3(qp.orientationChanged(),p2.off),m3(qp.dropupDismissed(),p2.off)])})]))})}},oE=function(d,a){var c=lX(d),b={};return m0(c,function(g){var f=!dU(b,g)&&dU(a,g)&&a[g].isSupported()?[a[g].sketch()]:[];return b[g]=!0,f})},qM=function(a,b){return function(j){if(a(j)){var q,z,g,h,m,y,x,w=rW.fromDom(j.target),A=function(){j.stopPropagation()},p=function(){j.preventDefault()},k=sS(p,A),v=(q=w,z=j.clientX,g=j.clientY,h=A,m=p,y=k,x=j,{target:uC(q),x:uC(z),y:uC(g),stop:h,prevent:m,kill:y,raw:uC(x)});b(v)}}},k8=function(g,d,b,c,f){var a=qM(b,c);return g.dom().addEventListener(d,a,f),{unbind:th(uT,g,d,a,f)}},uT=function(d,c,a,b){d.dom().removeEventListener(c,a,b)},tb=function(d,c,a,b){return k8(d,c,a,b,!1)},mL=function(d,c,a,b){return k8(d,c,a,b,!0)},rR=uC(!0),pK=function(c,b,a){return tb(c,b,rR,a)},sF=function(c,b,a){return mL(c,b,rR,a)},pj=function(b){var a=b.matchMedia("(orientation: portrait)").matches;return{isPortrait:uC(a)}},rA=pj,kB=function(c,d){var g=rW.fromDom(c),f=null,b=pK(g,"orientationchange",function(){clearInterval(f);var e=pj(c);d.onChange(e),a(function(){d.onReady(e)})}),a=function(j){clearInterval(f);var i=c.innerHeight,h=0;f=setInterval(function(){i!==c.innerHeight?(clearInterval(f),j(uI.some(c.innerHeight))):20<h&&(clearInterval(f),j(uI.none())),h++},50)};return{onAdjustment:a,destroy:function(){b.unbind()}}},n6=function(c){var b=bQ.detect().os.isiOS(),a=pj(c).isPortrait();return b&&!a?c.screen.height:c.screen.width},q2=function(b){var a=b.raw();return a.touches===undefined||1!==a.touches.length?uI.none():uI.some(a.touches[0])},t8=function(f){var g,h,e,d=dH(uI.none()),b=(g=function(a){d.set(uI.none()),f.triggerEvent(aN(),a)},h=400,e=null,{cancel:function(){null!==e&&(clearTimeout(e),e=null)},schedule:function(){for(var c=[],a=0;a<arguments.length;a++){c[a]=arguments[a]}e=setTimeout(function(){g.apply(null,c),e=null},h)}}),j=kI([{key:uh(),value:function(a){return q2(a).each(function(i){b.cancel();var c={x:uC(i.clientX),y:uC(i.clientY),target:a.target};b.schedule(a),d.set(uI.some(c))}),uI.none()}},{key:tT(),value:function(a){return b.cancel(),q2(a).each(function(c){d.get().each(function(p){var l,i,k,m;l=c,i=p,k=Math.abs(l.clientX-i.x()),m=Math.abs(l.clientY-i.y()),(5<k||5<m)&&d.set(uI.none())})}),uI.none()}},{key:t3(),value:function(a){return b.cancel(),d.get().filter(function(c){return hO(c.target(),a.target())}).map(function(c){return f.triggerEvent(gS(),a)})}}]);return{fireIfReady:function(a,c){return pV(j,c).bind(function(i){return i(a)})}}},ik=function(a){var b=t8({triggerEvent:function(d,c){a.onTapContent(c)}});return{fireTouchstart:function(c){b.fireIfReady(c,"touchstart")},onTouchend:function(){return pK(a.body(),"touchend",function(c){b.fireIfReady(c,"touchend")})},onTouchmove:function(){return pK(a.body(),"touchmove",function(c){b.fireIfReady(c,"touchmove")})}}},jO=6<=bQ.detect().os.version.major,i1=function(g,h,f){var j=ik(g),d=cK.owner(h),c=function(a){return !hO(a.start(),a.finish())||a.soffset()!==a.foffset()},k=function(){var a=g.doc().dom().hasFocus()&&g.getSelection().exists(c);f.getByDom(h).each(!0===(a||mh(d).filter(function(e){return"input"===uD.name(e)}).exists(function(e){return e.dom().selectionStart!==e.dom().selectionEnd}))?p2.on:p2.off)},b=[pK(g.body(),"touchstart",function(a){g.onTouchContent(),j.fireTouchstart(a)}),j.onTouchmove(),j.onTouchend(),pK(h,"touchstart",function(a){g.onTouchToolstrip()}),g.onToReading(function(){fy(g.body())}),g.onToEditing(tk),g.onScrollToCursor(function(a){a.preventDefault(),g.getCursorBox().each(function(m){var l=g.win(),i=m.top()>l.innerHeight||m.bottom()>l.innerHeight?m.bottom()-l.innerHeight+50:0;0!==i&&l.scrollTo(l.pageXOffset,l.pageYOffset+i)})})].concat(!0===jO?[]:[pK(rW.fromDom(g.win()),"blur",function(){f.getByDom(h).each(p2.off)}),pK(d,"select",k),pK(g.doc(),"selectionchange",k)]);return{destroy:function(){jN(b,function(a){a.unbind()})}}},dh=function(c,b){var a=parseInt(nx.get(c,b),10);return isNaN(a)?0:a},dJ=(lL=uD.isText,p4="text",j9=function(a){return lL(a)?uI.from(a.dom().nodeValue):uI.none()},kW=bQ.detect().browser,{get:function(a){if(!lL(a)){throw new Error("Can only get "+p4+" value of a "+p4+" node")}return m6(a).getOr("")},getOption:m6=kW.isIE()&&10===kW.version.major?function(b){try{return j9(b)}catch(a){return uI.none()}}:j9,set:function(b,a){if(!lL(b)){throw new Error("Can only set raw "+p4+" value of a "+p4+" node")}b.dom().nodeValue=a}}),e3=function(a){return dJ.getOption(a)},lG=function(a){return"img"===uD.name(a)?1:e3(a).fold(function(){return cK.children(a).length},function(b){return b.length})},p0=lG,j4=sY([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),kR={before:j4.before,on:j4.on,after:j4.after,cata:function(d,c,a,b){return d.fold(c,a,b)},getStart:function(a){return a.fold(tx,tx,tx)}},m1=sY([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),dZ=dx("start","soffset","finish","foffset"),fQ={domRange:m1.domRange,relative:m1.relative,exact:m1.exact,exactFromRange:function(a){return m1.exact(a.start(),a.soffset(),a.finish(),a.foffset())},range:dZ,getWin:function(b){var a=b.match({domRange:function(c){return rW.fromDom(c.startContainer)},relative:function(d,c){return kR.getStart(d)},exact:function(g,f,c,d){return g}});return cK.defaultView(a)}},g9=function(f,c,a,b){var d=cK.owner(f).dom().createRange();return d.setStart(f.dom(),c),d.setEnd(a.dom(),b),d},fA=function(g,d,b,c){var f=g9(g,d,b,c),a=hO(g,b)&&d===c;return f.collapsed&&!a},mk=function(b,a){b.selectNodeContents(a.dom())},jx=function(a){a.deleteContents()},b7=function(a){return{left:uC(a.left),top:uC(a.top),right:uC(a.right),bottom:uC(a.bottom),width:uC(a.width),height:uC(a.height)}},hW={create:function(a){return a.document.createRange()},replaceWith:function(b,a){jx(b),b.insertNode(a.dom())},selectNodeContents:function(c,b){var a=c.document.createRange();return mk(a,b),a},selectNodeContentsUsing:mk,relativeToNative:function(g,d,b){var c,f,a=g.document.createRange();return c=a,d.fold(function(e){c.setStartBefore(e.dom())},function(i,h){c.setStart(i.dom(),h)},function(e){c.setStartAfter(e.dom())}),f=a,b.fold(function(e){f.setEndBefore(e.dom())},function(i,h){f.setEnd(i.dom(),h)},function(e){f.setEndAfter(e.dom())}),a},exactToNative:function(g,d,b,c,f){var a=g.document.createRange();return a.setStart(d.dom(),b),a.setEnd(c.dom(),f),a},deleteContents:jx,cloneFragment:function(b){var a=b.cloneContents();return rW.fromDom(a)},getFirstRect:function(c){var b=c.getClientRects(),a=0<b.length?b[0]:c.getBoundingClientRect();return 0<a.width||0<a.height?uI.some(a).map(b7):uI.none()},getBounds:function(b){var a=b.getBoundingClientRect();return 0<a.width||0<a.height?uI.some(a).map(b7):uI.none()},isWithin:function(b,a){return a.compareBoundaryPoints(b.END_TO_START,b)<1&&-1<a.compareBoundaryPoints(b.START_TO_END,b)},toString:function(a){return a.toString()}},hG=sY([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),qw=function(c,b,a){return b(rW.fromDom(a.startContainer),a.startOffset,rW.fromDom(a.endContainer),a.endOffset)},f6=function(g,d){var f,b,c,a=(f=g,d.match({domRange:function(e){return{ltr:uC(e),rtl:uI.none}},relative:function(i,h){return{ltr:tN(function(){return hW.relativeToNative(f,i,h)}),rtl:tN(function(){return uI.some(hW.relativeToNative(f,h,i))})}},exact:function(k,j,h,i){return{ltr:tN(function(){return hW.exactToNative(f,k,j,h,i)}),rtl:tN(function(){return uI.some(hW.exactToNative(f,h,i,k,j))})}}}));return(c=(b=a).ltr()).collapsed?b.rtl().filter(function(e){return !1===e.collapsed}).map(function(e){return hG.rtl(rW.fromDom(e.endContainer),e.endOffset,rW.fromDom(e.startContainer),e.startOffset)}).getOrThunk(function(){return qw(0,hG.ltr,c)}):qw(0,hG.ltr,c)},cU=(hG.ltr,hG.rtl,f6),eM=function(a,b){return f6(a,b).match({ltr:function(h,f,c,d){var g=a.document.createRange();return g.setStart(h.dom(),f),g.setEnd(c.dom(),d),g},rtl:function(h,f,c,d){var g=a.document.createRange();return g.setStart(c.dom(),d),g.setEnd(h.dom(),f),g}})},ay=(document.caretPositionFromPoint||document.caretRangeFromPoint,function(c,b){var a=uD.name(c);return"input"===a?kR.after(c):q1(["br","img"],a)?0===b?kR.before(c):kR.after(c):kR.on(c,b)}),bR=function(g,d,b,c){var f=ay(g,d),a=ay(b,c);return fQ.relative(f,a)},cE=bR,iK=function(b,a){uI.from(b.getSelection()).each(function(c){c.removeAllRanges(),c.addRange(a)})},nP=function(g,d,b,c,f){var a=hW.exactToNative(g,d,b,c,f);iK(g,a)},a4=function(a,b){return cU(a,b).match({ltr:function(g,f,c,d){nP(a,g,f,c,d)},rtl:function(h,l,v,d){var g,j,q,p,m,w=a.getSelection();if(w.setBaseAndExtent){w.setBaseAndExtent(h.dom(),l,v.dom(),d)}else{if(w.extend){try{j=h,q=l,p=v,m=d,(g=w).collapse(j.dom(),q),g.extend(p.dom(),m)}catch(k){nP(a,v,d,h,l)}}else{nP(a,v,d,h,l)}}}})},bB=function(c){var b=rW.fromDom(c.anchorNode),a=rW.fromDom(c.focusNode);return fA(b,c.anchorOffset,a,c.focusOffset)?uI.some(fQ.range(rW.fromDom(c.anchorNode),c.anchorOffset,rW.fromDom(c.focusNode),c.focusOffset)):function(g){if(0<g.rangeCount){var f=g.getRangeAt(0),d=g.getRangeAt(g.rangeCount-1);return uI.some(fQ.range(rW.fromDom(f.startContainer),f.startOffset,rW.fromDom(d.endContainer),d.endOffset))}return uI.none()}(c)},gD=function(a){return uI.from(a.getSelection()).filter(function(b){return 0<b.rangeCount}).bind(bB)},gT=function(g,d,b,c,f){var a=cE(d,b,c,f);a4(g,a)},ew=gD,aO=function(a){return gD(a).map(function(b){return fQ.exact(b.start(),b.soffset(),b.finish(),b.foffset())})},oY=function(a){a.getSelection().removeAllRanges()},sh=function(c,b){var a=eM(c,b);return hW.getFirstRect(a)},l1=function(a){return{left:a.left,top:a.top,right:a.right,bottom:a.bottom,width:uC(2),height:a.height}},nC=function(a){return{left:uC(a.left),top:uC(a.top),right:uC(a.right),bottom:uC(a.bottom),width:uC(a.width),height:uC(a.height)}},oH=function(b){var a=b.getSelection();return a!==undefined&&0<a.rangeCount?function(c){if(c.collapsed){var d=rW.fromDom(c.startContainer);return cK.parent(d).bind(function(g){var f=fQ.exact(d,c.startOffset,g,p0(g));return sh(c.startContainer.ownerDocument.defaultView,f).map(l1).map(fz)}).getOr([])}return ij(c.getClientRects(),nC)}(a.getRangeAt(0)):[]},qP=function(b){b.focus();var a=rW.fromDom(b.document.body);(mh().exists(function(c){return q1(["input","textarea"],uD.name(c))})?function(c){setTimeout(function(){c()},0)}:sX)(function(){mh().each(fy),g7(a)})},lj="data-"+fS.resolve("last-outer-height"),uW=function(b,a){nx.set(b,lj,a)},tA=function(a){return{top:uC(a.top()),bottom:uC(a.top()+a.height())}},mP=function(d,c){var a=dh(c,lj),b=d.innerHeight;return b<a?uI.some(a-b):uI.none()},rU=function(d,a){var c=rW.fromDom(a.document.body),b=pK(rW.fromDom(d),"resize",function(){mP(d,c).each(function(f){var h,g;(h=a,g=oH(h),0<g.length?uI.some(g[0]).map(tA):uI.none()).each(function(m){var k,i,j,l=(k=a,j=f,(i=m).top()>k.innerHeight||i.bottom()>k.innerHeight?Math.min(j,i.bottom()-k.innerHeight+50):0);0!==l&&a.scrollTo(a.pageXOffset,a.pageYOffset+l)})}),uW(c,d.innerHeight)});return uW(c,d.innerHeight),{toEditing:function(){qP(a)},destroy:function(){b.unbind()}}},pN=function(a){return uI.some(rW.fromDom(a.dom().contentWindow.document.body))},sI=function(a){return uI.some(rW.fromDom(a.dom().contentWindow.document))},pw=function(a){return uI.from(a.dom().contentWindow)},rD=function(a){return pw(a).bind(ew)},kF=function(a){return a.getFrame()},n9=function(b,a){return function(c){return c[b].getOrThunk(function(){var d=kF(c);return function(){return a(d)}})()}},q5=function(d,c,a,b){return d[a].getOrThunk(function(){return function(e){return pK(c,b,e)}})},uy=function(a){return{left:uC(a.left),top:uC(a.top),right:uC(a.right),bottom:uC(a.bottom),width:uC(a.width),height:uC(a.height)}},iy={getBody:n9("getBody",pN),getDoc:n9("getDoc",sI),getWin:n9("getWin",pw),getSelection:n9("getSelection",rD),getFrame:kF,getActiveApi:function(b){var d=kF(b);return pN(d).bind(function(a){return sI(d).bind(function(c){return pw(d).map(function(i){var j=rW.fromDom(c.dom().documentElement),h=b.getCursorBox.getOrThunk(function(){return function(){return aO(i).bind(function(e){return sh(i,e).orThunk(function(){return ew(i).filter(function(k){return hO(k.start(),k.finish())&&k.soffset()===k.foffset()}).bind(function(l){var k=l.start().dom().getBoundingClientRect();return 0<k.width||0<k.height?uI.some(k).map(uy):uI.none()})})})}}),f=b.setSelection.getOrThunk(function(){return function(o,m,k,l){gT(i,o,m,k,l)}}),g=b.clearSelection.getOrThunk(function(){return function(){oY(i)}});return{body:uC(a),doc:uC(c),win:uC(i),html:uC(j),getSelection:th(rD,d),setSelection:f,clearSelection:g,frame:uC(d),onKeyup:q5(b,c,"onKeyup","keyup"),onNodeChanged:q5(b,c,"onNodeChanged","selectionchange"),onDomChanged:b.onDomChanged,onScrollToCursor:b.onScrollToCursor,onScrollToElement:b.onScrollToElement,onToReading:b.onToReading,onToEditing:b.onToEditing,onToolbarScrollStart:b.onToolbarScrollStart,onTouchContent:b.onTouchContent,onTapContent:b.onTapContent,onTouchToolstrip:b.onTouchToolstrip,getCursorBox:h}})})})}},jS="data-ephox-mobile-fullscreen-style",i5="position:absolute!important;",dq="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;",dM=bQ.detect().os.isAndroid(),e6=function(k,h){var f,g,j=function(a){return function(m){var l=nx.get(m,"style"),i=l===undefined?"no-styles":l.trim();i!==a&&(nx.set(m,jS,i),nx.set(m,"style",a))}},d=ey(k,"*"),c=m0(d,function(a){return aQ(a,"*")}),b=(f=h,(g=aA.get(f,"background-color"))!==undefined&&""!==g?"background-color:"+g+"!important":"background-color:rgb(255,255,255)!important;");jN(c,j("display:none!important;")),jN(d,j(i5+dq+b)),j((!0===dM?"":i5)+dq+b)(k)},lJ=function(){var a=gV("["+jS+"]");jN(a,function(c){var b=nx.get(c,jS);"no-styles"!==b?nx.set(c,"style",b):nx.remove(c,"style"),nx.remove(c,jS)})},p3=function(){var b=lN("head").getOrDie(),c=lN('meta[name="viewport"]').getOrThunk(function(){var d=rW.fromTag("meta");return nx.set(d,"name","viewport"),a9.append(b,d),d}),a=nx.get(c,"content");return{maximize:function(){nx.set(c,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){a!==undefined&&null!==a&&0<a.length?nx.set(c,"content",a):nx.set(c,"content","user-scalable=yes")}}},j7=function(c,f){var a=p3(),b=dj(),d=dj();return{enter:function(){f.hide(),t5.add(c.container,fS.resolve("fullscreen-maximized")),t5.add(c.container,fS.resolve("android-maximized")),a.maximize(),t5.add(c.body,fS.resolve("android-scroll-reload")),b.set(rU(c.win,iy.getWin(c.editor).getOrDie("no"))),iy.getActiveApi(c.editor).each(function(e){e6(c.container,e.body()),d.set(i1(e,c.toolstrip,c.alloy))})},exit:function(){a.restore(),f.show(),t5.remove(c.container,fS.resolve("fullscreen-maximized")),t5.remove(c.container,fS.resolve("android-maximized")),lJ(),t5.remove(c.body,fS.resolve("android-scroll-reload")),d.clear(),b.clear()}}},kU=function(a,b){var c=null;return{cancel:function(){null!==c&&(clearTimeout(c),c=null)},throttle:function(){for(var f=[],d=0;d<arguments.length;d++){f[d]=arguments[d]}null!==c&&clearTimeout(c),c=setTimeout(function(){a.apply(null,f),c=null},b)}}},m4=function(h,f){var c,d,g,b=mQ(a8.sketch({dom:o7('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:nM([p2.config({toggleClass:fS.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),a=(c=h,d=200,g=null,{cancel:function(){null!==g&&(clearTimeout(g),g=null)},throttle:function(){for(var j=[],i=0;i<arguments.length;i++){j[i]=arguments[i]}null===g&&(g=setTimeout(function(){c.apply(null,j),g=null},d))}});return a8.sketch({dom:o7('<div class="${prefix}-disabled-mask"></div>'),components:[a8.sketch({dom:o7('<div class="${prefix}-content-container"></div>'),components:[mF.sketch({dom:o7('<div class="${prefix}-content-tap-section"></div>'),components:[b.asSpec()],action:function(e){a.throttle()},buttonBehaviours:nM([p2.config({toggleClass:fS.resolve("mask-tap-icon-selected")})])})]})]})},d2=aj([mG("editor",[k3("getFrame"),rN("getBody"),rN("getDoc"),rN("getWin"),rN("getSelection"),rN("setSelection"),rN("clearSelection"),rN("cursorSaver"),rN("onKeyup"),rN("onNodeChanged"),rN("getCursorBox"),k3("onDomChanged"),o8("onTouchContent",tk),o8("onTapContent",tk),o8("onTouchToolstrip",tk),o8("onScrollToCursor",uC({unbind:tk})),o8("onScrollToElement",uC({unbind:tk})),o8("onToEditing",uC({unbind:tk})),o8("onToReading",uC({unbind:tk})),o8("onToolbarScrollStart",tx)]),k3("socket"),k3("toolstrip"),k3("dropup"),k3("toolbar"),k3("container"),k3("alloy"),kw("win",function(a){return cK.owner(a.socket).dom().defaultView}),kw("body",function(a){return rW.fromDom(a.socket.dom().ownerDocument.body)}),o8("translate",tx),o8("setReadOnly",tk),o8("readOnlyOnInit",uC(!0))]),fT=function(f){var c=oR("Getting AndroidWebapp schema",d2,f);aA.set(c.toolstrip,"width","100%");var a=uZ(m4(function(){c.setReadOnly(c.readOnlyOnInit()),d.enter()},c.translate));c.alloy.add(a);var b={show:function(){c.alloy.add(a)},hide:function(){c.alloy.remove(a)}};a9.append(c.container,a.element());var d=j7(c,b);return{setReadOnly:c.setReadOnly,refreshStructure:tk,enter:d.enter,exit:d.exit,destroy:tk}},hj=uC([o8("shell",!0),u1("toolbarBehaviours",[kj])]),fD=uC([fH({name:"groups",overrides:function(a){return{behaviours:nM([kj.config({})])}}})]),mx=s0({name:"Toolbar",configFields:hj(),partFields:fD(),factory:function(d,g,b,c){var f=function(e){return d.shell()?uI.some(e):c1(e,d,"groups")},a=d.shell()?{behaviours:[kj.config({})],components:[]}:{behaviours:[],components:g};return{uid:d.uid(),dom:d.dom(),components:a.components,behaviours:uG(nM(a.behaviours),tJ(d.toolbarBehaviours())),apis:{setGroups:function(i,h){f(i).fold(function(){throw console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")},function(e){kj.set(e,h)})}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(c,b,a){c.setGroups(b,a)}}}),jA=uC([k3("items"),(d3=["itemClass"],mG("markers",ij(d3,k3))),u1("tgroupBehaviours",[lB])]),ch=uC([mE({name:"items",unit:"item",overrides:function(a){return{domModification:{classes:[a.markers().itemClass()]}}}})]),hZ=s0({name:"ToolbarGroup",configFields:jA(),partFields:ch(),factory:function(d,c,a,b){return uG({dom:{attributes:{role:"toolbar"}}},{uid:d.uid(),dom:d.dom(),components:c,behaviours:uG(nM([lB.config({mode:"flow",selector:"."+d.markers().itemClass()})]),tJ(d.tgroupBehaviours())),"debug.sketcher":a["debug.sketcher"]})}}),hK="data-"+fS.resolve("horizontal-scroll"),qz=function(c){return"true"===nx.get(c,hK)?0<(a=c).dom().scrollLeft||function(f){f.dom().scrollLeft=1;var d=0!==f.dom().scrollLeft;return f.dom().scrollLeft=0,d}(a):0<(b=c).dom().scrollTop||function(f){f.dom().scrollTop=1;var d=0!==f.dom().scrollTop;return f.dom().scrollTop=0,d}(b);var b,a},f9={exclusive:function(b,a){return pK(b,"touchmove",function(c){qG(c.target(),a).filter(qz).fold(function(){c.raw().preventDefault()},tk)})},markAsHorizontal:function(a){nx.set(a,hK,"true")}};function cX(){var c=function(h){var g=!0===h.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:o7('<div aria-label="'+h.label+'" class="${prefix}-toolbar-group '+g+'"></div>'),tgroupBehaviours:nM([bV("adhoc-scrollable-toolbar",!0===h.scrollable?[jZ(function(j,i){aA.set(j.element(),"overflow-x","auto"),f9.markAsHorizontal(j.element()),aE.register(j.element())})]:[])]),components:[a8.sketch({components:[hZ.parts().items({})]})],markers:{itemClass:fS.resolve("toolbar-group-item")},items:h.items}},a=uZ(mx.sketch({dom:o7('<div class="${prefix}-toolbar"></div>'),components:[mx.parts().groups({})],toolbarBehaviours:nM([p2.config({toggleClass:fS.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),lB.config({mode:"cyclic"})]),shell:!0})),f=uZ(a8.sketch({dom:{classes:[fS.resolve("toolstrip")]},components:[tG(a)],containerBehaviours:nM([p2.config({toggleClass:fS.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),b=function(){mx.setGroups(a,d.get()),p2.off(a)},d=dH([]);return{wrapper:uC(f),toolbar:uC(a),createGroups:function(e){return ij(e,sS(hZ.sketch,c))},setGroups:function(e){d.set(e),b()},setContextToolbar:function(e){p2.on(a),mx.setGroups(a,e)},restoreToolbar:function(){p2.isOn(a)&&b()},refresh:function(){},focus:function(){lB.focusIn(a)}}}var eP=function(b,a){kj.append(b,tG(a))},aB=function(b,a){kj.remove(b,a)},bU=function(a){return uZ(mF.sketch({dom:o7('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){a.run(function(b){b.setReadOnly(!1)})}}))},cH=function(){return uZ(a8.sketch({dom:o7('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:nM([kj.config({})])}))},iN=function(d,c,a,b){(!0===a?c9.toAlpha:c9.toOmega)(b),(a?eP:aB)(d,c)},nS=function(a,b){return b.getAnimationRoot().fold(function(){return a.element()},function(c){return c(a)})},a7=function(a){return a.dimension().property()},bE=function(b,a){return b.dimension().getDimension()(a)},gG=function(c,b){var a=nS(c,b);bC(a,[b.shrinkingClass(),b.growingClass()])},gW=function(b,a){t5.remove(b.element(),a.openClass()),t5.add(b.element(),a.closedClass()),aA.set(b.element(),a7(a),"0px"),aA.reflow(b.element())},ez=function(b,a){t5.remove(b.element(),a.closedClass()),t5.add(b.element(),a.openClass()),aA.remove(b.element(),a7(a))},aR=function(d,c,a){a.setCollapsed(),aA.set(d.element(),a7(c),bE(c,d.element())),aA.reflow(d.element());var b=nS(d,c);t5.add(b,c.shrinkingClass()),gW(d,c),c.onStartShrink()(d)},oN=function(f,c,a){var b=function(i,h){ez(i,h);var g=bE(h,i.element());return gW(i,h),g}(f,c),d=nS(f,c);t5.add(d,c.growingClass()),ez(f,c),aA.set(f.element(),a7(c),b),a.setExpanded(),c.onStartGrow()(f)},r0=function(d,c,a){var b=nS(d,c);return !0===t5.has(b,c.growingClass())},lK=function(d,c,a){var b=nS(d,c);return !0===t5.has(b,c.shrinkingClass())},m5=Object.freeze({grow:function(c,b,a){a.isExpanded()||oN(c,b,a)},shrink:function(c,b,a){a.isExpanded()&&aR(c,b,a)},immediateShrink:function(f,c,a){var b,d;a.isExpanded()&&(b=f,d=c,a.setCollapsed(),aA.set(b.element(),a7(d),bE(d,b.element())),aA.reflow(b.element()),gG(b,d),gW(b,d),d.onStartShrink()(b),d.onShrunk()(b))},hasGrown:function(c,b,a){return a.isExpanded()},hasShrunk:function(c,b,a){return a.isCollapsed()},isGrowing:r0,isShrinking:lK,isTransitioning:function(c,b,a){return !0===r0(c,b)||!0===lK(c,b)},toggleGrow:function(c,b,a){(a.isExpanded()?aR:oN)(c,b,a)},disableTransitions:gG}),ow=Object.freeze({exhibit:function(c,b){var a=b.expanded();return fx(a?{classes:[b.openClass()],styles:{}}:{classes:[b.closedClass()],styles:jV(b.dimension().property(),"0px")})},events:function(a,b){return t0([jJ(uk(),function(d,c){c.event().raw().propertyName===a.dimension().property()&&(gG(d,a),b.isExpanded()&&aA.remove(d.element(),a.dimension().property()),(b.isExpanded()?a.onGrown():a.onShrunk())(d))})])}}),qF=[k3("closedClass"),k3("openClass"),k3("shrinkingClass"),k3("growingClass"),rN("getAnimationRoot"),uV("onShrunk"),uV("onStartShrink"),uV("onGrown"),uV("onStartGrow"),o8("expanded",!1),uP("dimension",nk("property",{width:[pM("property","width"),pM("getDimension",function(a){return bx(a)+"px"})],height:[pM("property","height"),pM("getDimension",function(a){return a6(a)+"px"})]}))],kV=Object.freeze({init:function(b){var a=dH(b.expanded());return iF({isExpanded:function(){return !0===a.get()},isCollapsed:function(){return !1===a.get()},setCollapsed:th(a.set,!1),setExpanded:th(a.set,!0),readState:function(){return"expanded: "+a.get()}})}}),uL=by({fields:qF,name:"sliding",active:ow,apis:m5,state:kV}),sT=function(c,a){var b=uZ(a8.sketch({dom:{tag:"div",classes:[fS.resolve("dropup")]},components:[],containerBehaviours:nM([kj.config({}),uL.config({closedClass:fS.resolve("dropup-closed"),openClass:fS.resolve("dropup-open"),shrinkingClass:fS.resolve("dropup-shrinking"),growingClass:fS.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(e){c(),a(),kj.set(e,[])},onGrown:function(e){c(),a()}}),kT(function(g,f){d(tk)})])})),d=function(e){window.requestAnimationFrame(function(){e(),uL.shrink(b)})};return{appear:function(h,g,f){!0===uL.hasShrunk(b)&&!1===uL.isTransitioning(b)&&window.requestAnimationFrame(function(){g(f),kj.set(b,[h()]),uL.grow(b)})},disappear:d,component:uC(b),element:b.element}},my=bQ.detect().browser.isFirefox(),rJ=eH([s2("triggerEvent"),s2("broadcastEvent"),o8("stopBackspace",!0)]),pC=function(x,j){var C,b,h,q,B=oR("Getting GUI events settings",rJ,j),A=bQ.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],z=t8(B),D=ij(A.concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop"]),function(a){return pK(x,a,function(c){z.fireIfReady(c,a).each(function(d){d&&c.kill()}),B.triggerEvent(a,c)&&c.kill()})}),w=pK(x,"keydown",function(c){var a;B.triggerEvent("keydown",c)?c.kill():!0!==B.stopBackspace||8!==(a=c).raw().which||q1(["input","textarea"],uD.name(a.target()))||c.prevent()}),p=(C=x,b=function(a){B.triggerEvent("focusin",a)&&a.kill()},my?sF(C,"focus",b):pK(C,"focusin",b)),y=(h=x,q=function(a){B.triggerEvent("focusout",a)&&a.kill(),setTimeout(function(){B.triggerEvent(nO(),a)},0)},my?sF(h,"blur",q):pK(h,"focusout",q)),k=cK.defaultView(x),v=pK(k,"scroll",function(a){B.broadcastEvent(sk(),a)&&a.kill()});return{unbind:function(){jN(D,function(a){a.unbind()}),w.unbind(),p.unbind(),y.unbind(),v.unbind()}}},sy=function(c,b){var a=pV(c,"target").map(function(d){return d()}).getOr(b);return dH(a)},o4=sY([{stopped:[]},{resume:["element"]},{complete:[]}]),rh=function(g,b,m,w,d,j){var v,q,p,x,k=g(b,w),h=(v=m,q=d,p=dH(!1),x=dH(!1),{stop:function(){p.set(!0)},cut:function(){x.set(!0)},isStopped:p.get,isCut:x.get,event:uC(v),setSource:q.set,getSource:q.get});return k.fold(function(){return j.logEventNoHandlers(b,w),o4.complete()},function(c){var a=c.descHandler();return f7(a)(h),h.isStopped()?(j.logEventStopped(b,c.element(),a.purpose()),o4.stopped()):h.isCut()?(j.logEventCut(b,c.element(),a.purpose()),o4.complete()):cK.parent(c.element()).fold(function(){return j.logNoParent(b,c.element(),a.purpose()),o4.complete()},function(e){return j.logEventResponse(b,c.element(),a.purpose()),o4.resume(e)})})},j8=function(d,b,c,g,f,a){return rh(d,b,c,g,f,a).fold(function(){return !0},function(e){return j8(d,b,c,e,f,a)},function(){return !1})},nY=function(g,d,b){var c,f,a=(c=d,f=dH(!1),{stop:function(){f.set(!0)},cut:tk,isStopped:f.get,isCut:uC(!1),event:uC(c),setSource:tH("Cannot set source of a broadcasted event"),getSource:tH("Cannot get source of a broadcasted event")});return jN(g,function(i){var h=i.descHandler();f7(h)(a)}),a.isStopped()},qU=function(g,d,b,c,f){var a=sy(b,c);return j8(g,d,b,c,a,f)},tR=function(c,b,a){return kP.closest(c,function(d){return b(d).isSome()},a).bind(b)},h0=dx("element","descHandler"),jB=function(b,a){return{id:uC(b),descHandler:uC(a)}};function iO(){var a={};return{registerId:function(b,c,d){tS(d,function(h,g){var f=a[g]!==undefined?a[g]:{};f[c]=qx(h,b),a[g]=f})},unregisterId:function(b){tS(a,function(d,c){d.hasOwnProperty(b)&&delete d[b]})},filterByType:function(b){return pV(a,b).map(function(c){return tq(c,function(f,d){return jB(d,f)})}).getOr([])},find:function(f,c,b){var d=eX(c)(a);return tR(b,function(h){return e=d,oQ(g=h).fold(function(){return uI.none()},function(j){var i=eX(j);return e.bind(i).map(function(k){return h0(g,k)})});var e,g},f)}}}function c3(){var c=iO(),d={},b=function(e){var f=e.element();return oQ(f).fold(function(){return i="uid-",h=e.element(),g=uH(eD+i),nx.set(h,aV,g),g;var i,h,g},function(g){return g})},a=function(e){oQ(e.element()).each(function(f){d[f]=undefined,c.unregisterId(f)})};return{find:function(h,g,f){return c.find(h,g,f)},filter:function(e){return c.filterByType(e)},register:function(h){var g=b(h);dU(d,g)&&function(k,j){var i=d[j];if(i!==k){throw new Error('The tagId "'+j+'" is already used by: '+nN(i.element())+"\nCannot use it for: "+nN(k.element())+"\nThe conflicting element is"+(i9.inBody(i.element())?" ":" not ")+"already in the DOM")}a(k)}(h,g);var f=[h];c.registerId(f,g,h.events()),d[g]=h},unregister:a,getById:function(e){return eX(e)(d)}}}var dB=function(C){var b=function(a){return cK.parent(C.element()).fold(function(){return !0},function(c){return hO(a,c)})},h=c3(),D=function(c,a){return h.find(b,c,a)},j=pC(C.element(),{triggerEvent:function(d,c){return sb(d,c.target(),function(s){return l=D,f=d,m=s,a=(g=c).target(),qU(l,f,g,a,m);var l,f,g,m,a})},broadcastEvent:function(d,c){var a=h.filter(d);return nY(a,c)}}),q=fB({debugInfo:uC("real"),triggerEvent:function(d,a,c){sb(d,a,function(e){qU(D,d,c,a,e)})},triggerFocus:function(d,e){oQ(d).fold(function(){g7(d)},function(a){sb(iJ(),d,function(E){var m,g,l,s,f,c;m=D,g=iJ(),l={originator:uC(e),kill:tk,prevent:tk,target:uC(d)},f=E,c=sy(l,s=d),rh(m,g,l,s,c,f)})})},triggerEscape:function(c,a){q.triggerEvent("keydown",c.element(),a.event())},getByUid:function(a){return k(a)},getByDom:function(a){return v(a)},build:uZ,addToGui:function(a){A(a)},removeFromGui:function(a){z(a)},addToWorld:function(a){x(a)},removeFromWorld:function(a){B(a)},broadcast:function(a){p(a)},broadcastOn:function(c,a){y(c,a)},isConnected:uC(!0)}),x=function(a){a.connect(q),uD.isText(a.element())||(h.register(a),jN(a.components(),x),q.triggerEvent(o0(),a.element(),{target:uC(a.element())}))},B=function(a){uD.isText(a.element())||(jN(a.components(),B),h.unregister(a)),a.disconnect()},A=function(a){r2(C,a)},z=function(a){oy(a)},w=function(a){var c=h.filter(a3());jN(c,function(f){var d=f.descHandler();f7(d)(a)})},p=function(a){w({universal:uC(!0),data:uC(a)})},y=function(c,a){w({universal:uC(!1),channels:uC(c),data:uC(a)})},k=function(a){return h.getById(a).fold(function(){return uN.error(new Error('Could not find component with uid: "'+a+'" in system.'))},uN.value)},v=function(c){var a=oQ(c).getOr("not found");return k(a)};return x(C),{root:uC(C),element:C.element,destroy:function(){j.unbind(),eB.remove(C.element())},add:A,remove:z,getByUid:k,getByDom:v,addToWorld:x,removeFromWorld:B,broadcast:p,broadcastOn:y}},eV=uC(fS.resolve("readonly-mode")),lh=uC(fS.resolve("edit-mode"));function pT(b){var a=uZ(a8.sketch({dom:{classes:[fS.resolve("outer-container")].concat(b.classes)},containerBehaviours:nM([c9.config({alpha:eV(),omega:lh()})])}));return dB(a)}var jR=function(c,b){var a=rW.fromTag("input");aA.setAll(a,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),a9.append(c,a),g7(a),b(a),eB.remove(a)},kE=function(d){var c=d.getSelection();if(0<c.rangeCount){var a=c.getRangeAt(0),b=d.document.createRange();b.setStart(a.startContainer,a.startOffset),b.setEnd(a.endContainer,a.endOffset),c.removeAllRanges(),c.addRange(b)}},mO=function(b,a){mh().each(function(c){hO(c,a)||fy(c)}),b.focus(),g7(rW.fromDom(b.document.body)),kE(b)},dS={stubborn:function(g,d,b,c){var f=function(){mO(d,c)},a=pK(b,"keydown",function(e){q1(["input","textarea"],uD.name(e.target()))||f()});return{toReading:function(){jR(g,fy)},toEditing:f,onToolbarTouch:function(){},destroy:function(){a.unbind()}}},timid:function(f,c,a,b){var d=function(){fy(b)};return{toReading:function(){d()},toEditing:function(){mO(c,b)},onToolbarTouch:function(){d()},destroy:tk}}},fJ=function(w,b,d,j,g){var v=function(){b.run(function(a){a.refreshSelection()})},m=function(f,c){var a=f-j.dom().scrollTop;b.run(function(e){e.scrollIntoView(a,a+c)})},q=function(){b.run(function(a){a.clearSelection()})},p=function(){w.getCursorBox().each(function(a){m(a.top(),a.height())}),b.run(function(a){a.syncHeight()})},x=ik(w),k=kU(p,300),h=[w.onKeyup(function(){q(),k.throttle()}),w.onNodeChanged(v),w.onDomChanged(k.throttle),w.onDomChanged(v),w.onScrollToCursor(function(a){a.preventDefault(),k.throttle()}),w.onScrollToElement(function(a){a.element(),m(b,j)}),w.onToEditing(function(){b.run(function(a){a.toEditing()})}),w.onToReading(function(){b.run(function(a){a.toReading()})}),pK(w.doc(),"touchend",function(a){hO(w.html(),a.target())||hO(w.body(),a.target())}),pK(d,"transitionend",function(c){var a;"height"===c.raw().propertyName&&(a=a6(d),b.run(function(e){e.setViewportOffset(a)}),v(),p())}),sF(d,"touchstart",function(c){var a;b.run(function(e){e.highlightSelection()}),a=c,b.run(function(e){e.onToolbarTouch(a)}),w.onTouchToolstrip()}),pK(w.body(),"touchstart",function(a){q(),w.onTouchContent(),x.fireTouchstart(a)}),x.onTouchmove(),x.onTouchend(),pK(w.body(),"click",function(a){a.kill()}),pK(d,"touchmove",function(){w.onToolbarScrollStart()})];return{destroy:function(){jN(h,function(a){a.unbind()})}}},g2=function(h){var c=uI.none(),f=[],d=function(e){g()?a(e):f.push(e)},g=function(){return c.isSome()},b=function(e){jN(e,a)},a=function(i){c.each(function(e){setTimeout(function(){i(e)},0)})};return h(function(e){c=uI.some(e),b(f),f=[]}),{get:d,map:function(e){return g2(function(i){d(function(j){i(e(j))})})},isReady:g}},fj={nu:g2,pure:function(a){return g2(function(b){b(a)})}},l0=function(a){var b=function(d){var c;a((c=d,function(){for(var h=[],g=0;g<arguments.length;g++){h[g]=arguments[g]}var f=this;setTimeout(function(){c.apply(f,h)},0)}))};return{map:function(c){return l0(function(d){b(function(g){var f=c(g);d(f)})})},bind:function(c){return l0(function(d){b(function(e){c(e).get(d)})})},anonBind:function(c){return l0(function(d){b(function(e){c.get(d)})})},toLazy:function(){return fj.nu(b)},get:b}},i4={nu:l0,pure:function(a){return l0(function(b){b(a)})}},b0=function(c,b,a){return Math.abs(c-b)<=a?uI.none():c<b?uI.some(c+a):uI.some(c-a)},hJ=function(){var a=null;return{animate:function(b,d,f,g,h,m){var l=!1,k=function(c){l=!0,h(c)};clearInterval(a);var j=function(c){clearInterval(a),k(c)};a=setInterval(function(){var c=b();b0(c,d,f).fold(function(){clearInterval(a),k(d)},function(o){if(g(o,j),!l){var i=b();(i!==o||Math.abs(i-d)>Math.abs(c-d))&&(clearInterval(a),k(d))}})},m)}}},hk=function(b,a){return gB([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],function(c){return b<=c.width&&a<=c.height?uI.some(c.keyboard):uI.none()}).getOr({portrait:a/5,landscape:b/4})},p9=function(f){var c,a=rA(f).isPortrait(),b=hk((c=f).screen.width,c.screen.height),d=a?b.portrait:b.landscape;return(a?f.screen.height:f.screen.width)-f.innerHeight>d?0:d},fZ=function(c,b){var a=cK.owner(c).dom().defaultView;return a6(c)+a6(b)-p9(a)},cI=fZ,eF=function(f,c,a){var b=fZ(c,a),d=a6(c)+a6(a)-b;aA.set(f,"padding-bottom",d+"px")},ab=sY([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),bK="data-"+fS.resolve("position-y-fixed"),cb="data-"+fS.resolve("y-property"),ix="data-"+fS.resolve("scrolling"),nI="data-"+fS.resolve("last-window-height"),aX=function(a){return dh(a,bK)},bk=function(c,b){var a=nx.get(c,cb);return ab.fixed(c,a,b)},gw=function(b,a){return ab.scroller(b,a)},gM=function(b){var a=aX(b);return("true"===nx.get(b,ix)?gw:bk)(b,a)},d8=function(d,c,a){var b=cK.owner(d).dom().defaultView.innerHeight;return nx.set(d,nI,b+"px"),b-c-a},aH=function(b){var a=oO(b,"["+bK+"]");return ij(a,gM)},oS=function(D,F,J,A){var G,N,B,R,P,C,M,I,O=cK.owner(D).dom().defaultView,H=(I=nx.get(M=J,"style"),aA.setAll(M,{position:"absolute",top:"0px"}),nx.set(M,bK,"0px"),nx.set(M,cb,"top"),{restore:function(){nx.set(M,"style",I||""),nx.remove(M,bK),nx.remove(M,cb)}}),L=a6(J),z=a6(A),E=d8(D,L,z),K=(B=L,R=E,C=nx.get(P=D,"style"),aE.register(P),aA.setAll(P,{position:"absolute",height:R+"px",width:"100%",top:B+"px"}),nx.set(P,bK,B+"px"),nx.set(P,ix,"true"),nx.set(P,cb,"top"),{restore:function(){aE.deregister(P),nx.set(P,"style",C||""),nx.remove(P,bK),nx.remove(P,ix),nx.remove(P,cb)}}),Q=(N=nx.get(G=A,"style"),aA.setAll(G,{position:"absolute",bottom:"0px"}),nx.set(G,bK,"0px"),nx.set(G,cb,"bottom"),{restore:function(){nx.set(G,"style",N||""),nx.remove(G,bK),nx.remove(G,cb)}}),j=!0,q=function(){var a=O.innerHeight;return dh(D,nI)<a},k=function(){if(j){var c=a6(J),b=a6(A),a=d8(D,c,b);nx.set(D,bK,c+"px"),aA.set(D,"height",a+"px"),aA.set(A,"bottom",-(c+a+b)+"px"),eF(F,D,A)}};return eF(F,D,A),{setViewportOffset:function(a){nx.set(D,bK,a+"px"),k()},isExpanding:q,isShrinking:tV(q),refresh:k,restore:function(){j=!1,H.restore(),K.restore(),Q.restore()}}},r5=aX,lU=hJ(),nw="data-"+fS.resolve("last-scroll-top"),oB=function(b){var a=aA.getRaw(b,"top").getOr("0");return parseInt(a,10)},qK=function(a){return parseInt(a.dom().scrollTop,10)},k5=function(c,b){var a=b+r5(c)+"px";aA.set(c,"top",a)},uQ=function(a,b,c){return i4.nu(function(f){var d=th(qK,a);lU.animate(d,b,15,function(e){a.dom().scrollTop=e,aA.set(a,"top",oB(a)+15+"px")},function(){a.dom().scrollTop=b,aA.set(a,"top",c+"px"),f(b)},10)})},s4=function(b,a){return i4.nu(function(g){var f=th(qK,b);nx.set(b,nw,f());var c=Math.abs(a-f()),d=Math.ceil(c/10);lU.animate(f,a,d,function(i,h){dh(b,nw)!==b.dom().scrollTop?h(b.dom().scrollTop):(b.dom().scrollTop=i,nx.set(b,nw,i))},function(){b.dom().scrollTop=a,nx.set(b,nw,a),g(a)},10)})},mI=function(b,a){return i4.nu(function(h){var f=th(oB,b),c=function(e){aA.set(b,"top",e+"px")},d=Math.abs(a-f()),g=Math.ceil(d/10);lU.animate(f,a,g,c,function(){c(a),h(a)},10)})},rO=function(c,a,b){var d=cK.owner(c).dom().defaultView;return i4.nu(function(e){k5(c,b),k5(a,b),d.scrollTo(0,b),e(b)})},pH=function(h,f,c,d,g){var b=cI(f,c),a=th(kE,h);b<d||b<g?s4(f,f.dom().scrollTop-b+g).get(a):d<0&&s4(f,f.dom().scrollTop+d).get(a)},sD=function(a,b){return b(function(d){var e=[],c=0;0===a.length?d([]):jN(a,function(h,g){var f;h.get((f=g,function(i){e[f]=i,++c>=a.length&&d(e)}))})})},o9=function(b,a){return b.fold(function(k,h,f){return g=k,j=h,c=a+(d=f),aA.set(g,j,c+"px"),i4.pure(d);var g,j,d,c},function(l,j){return g=l,k=a+(h=j),f=aA.getRaw(g,"top").getOr(h),d=k-parseInt(f,10),c=g.dom().scrollTop+d,uQ(g,c,k);var g,h,k,f,d,c})},rx=function(d,c){var a=aH(d),b=ij(a,function(e){return o9(e,c)});return sD(b,i4.nu)},ky=function(k,q,g,b,d,h){var p,m,l=(p=function(a){return rO(k,q,a)},m=dH(fj.pure({})),{start:function(a){var c=fj.nu(function(e){return p(a).get(e)});m.set(c)},idle:function(a){m.get().get(function(){a()})}}),v=kU(function(){l.idle(function(){rx(g,b.pageYOffset).get(function(){var a;(a=oH(h),uI.from(a[0]).bind(function(f){var c=f.top()-q.dom().scrollTop;return c>b.innerHeight+5||c<-5?uI.some({top:uC(c),bottom:uC(c+f.height())}):uI.none()})).each(function(c){q.dom().scrollTop=q.dom().scrollTop+c.top()}),l.start(0),d.refresh()})})},1000),j=pK(rW.fromDom(b),"scroll",function(){b.pageYOffset<0||v.throttle()});return rx(g,b.pageYOffset).get(tx),{unbind:j.unbind}},n3=function(k){var G=k.cWin(),A=k.ceBody(),b=k.socket(),j=k.toolstrip(),x=k.toolbar(),F=k.contentElement(),D=k.keyboardType(),C=k.outerWindow(),H=k.dropup(),z=oS(b,A,j,H),w=D(k.outerBody(),G,i9.body(),F,j,x),B=kB(C,{onChange:tk,onReady:z.refresh});B.onAdjustment(function(){z.refresh()});var q=pK(rW.fromDom(C),"resize",function(){z.isExpanding()&&z.refresh()}),y=ky(j,b,k.outerBody(),C,z,G),E=function(d,g){var m=d.document,f=rW.fromTag("div");t5.add(f,fS.resolve("unfocused-selections")),a9.append(rW.fromDom(m.documentElement),f);var l=pK(f,"touchstart",function(e){e.prevent(),mO(d,g),a()}),c=function(o){var i=rW.fromTag("span");return a5(i,[fS.resolve("layer-editor"),fS.resolve("unfocused-selection")]),aA.setAll(i,{left:o.left()+"px",top:o.top()+"px",width:o.width()+"px",height:o.height()+"px"}),i},a=function(){eB.empty(f)};return{update:function(){a();var o=oH(d),i=ij(o,c);gI(f,i)},isActive:function(){return 0<cK.children(f).length},destroy:function(){l.unbind(),eB.remove(f)},clear:a}}(G,F),h=function(){E.clear()};return{toEditing:function(){w.toEditing(),h()},toReading:function(){w.toReading()},onToolbarTouch:function(a){w.onToolbarTouch(a)},refreshSelection:function(){E.isActive()&&E.update()},clearSelection:h,highlightSelection:function(){E.update()},scrollIntoView:function(c,a){pH(G,b,H,c,a)},updateToolbarPadding:tk,setViewportOffset:function(a){z.setViewportOffset(a),mI(b,a).get(tx)},syncHeight:function(){aA.set(F,"height",F.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:z.refresh,destroy:function(){z.restore(),B.destroy(),y.unbind(),q.unbind(),w.destroy(),E.destroy(),jR(i9.body(),fy)}}},qZ=function(f,j){var g=p3(),e=dK(),d=dK(),b=dj(),h=dj();return{enter:function(){j.hide();var a=rW.fromDom(document);iy.getActiveApi(f.editor).each(function(i){e.set({socketHeight:aA.getRaw(f.socket,"height"),iframeHeight:aA.getRaw(i.frame(),"height"),outerScroll:document.body.scrollTop}),d.set({exclusives:f9.exclusive(a,"."+aE.scrollable())}),t5.add(f.container,fS.resolve("fullscreen-maximized")),e6(f.container,i.body()),g.maximize(),aA.set(f.socket,"overflow","scroll"),aA.set(f.socket,"-webkit-overflow-scrolling","touch"),g7(i.body());var c=kX(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);b.set(n3(c({cWin:i.win(),ceBody:i.body(),socket:f.socket,toolstrip:f.toolstrip,toolbar:f.toolbar,dropup:f.dropup.element(),contentElement:i.frame(),cursor:tk,outerBody:f.body,outerWindow:f.win,keyboardType:dS.stubborn,isScrolling:function(){return d.get().exists(function(k){return k.socket.isScrolling()})}}))),b.run(function(k){k.syncHeight()}),h.set(fJ(i,b,f.toolstrip,f.socket,f.dropup))})},refreshStructure:function(){b.run(function(a){a.refreshStructure()})},exit:function(){g.restore(),h.clear(),b.clear(),j.show(),e.on(function(a){a.socketHeight.each(function(c){aA.set(f.socket,"height",c)}),a.iframeHeight.each(function(c){aA.set(f.editor.getFrame(),"height",c)}),document.body.scrollTop=a.scrollTop}),e.clear(),d.on(function(a){a.exclusives.unbind()}),d.clear(),t5.remove(f.container,fS.resolve("fullscreen-maximized")),lJ(),aE.deregister(f.toolbar),aA.remove(f.socket,"overflow"),aA.remove(f.socket,"-webkit-overflow-scrolling"),fy(f.editor.getFrame()),iy.getActiveApi(f.editor).each(function(a){a.clearSelection()})}}},t2=function(d){var c=oR("Getting IosWebapp schema",d2,d);aA.set(c.toolstrip,"width","100%"),aA.set(c.container,"position","relative");var a=uZ(m4(function(){c.setReadOnly(c.readOnlyOnInit()),b.enter()},c.translate));c.alloy.add(a);var b=qZ(c,{show:function(){c.alloy.add(a)},hide:function(){c.alloy.remove(a)}});return{setReadOnly:c.setReadOnly,refreshStructure:b.refreshStructure,enter:b.enter,exit:b.exit,destroy:tk}},ib=tinymce.util.Tools.resolve("tinymce.EditorManager"),jL=function(b){var a=pV(b.settings,"skin_url").fold(function(){return ib.baseURL+"/skins/lightgray"},function(c){return c});return{content:a+"/content.mobile.min.css",ui:a+"/skin.mobile.min.css"}},iY=function(c,b,a){c.system().broadcastOn([qp.formatChanged()],{command:b,state:a})},c8=function(a,c){var b=uB(c.formatter.get());jN(b,function(d){c.formatter.formatChanged(d,function(e){iY(a,d,e)})}),jN(["ul","ol"],function(d){c.selection.selectorChanged(d,function(g,f){iY(a,d,g)})})},dG=(uC(["x-small","small","medium","large","x-large"]),function(b){var a=function(){b._skinLoaded=!0,b.fire("SkinLoaded")};return function(){b.initialized?a():b.on("init",a)}}),e0=uC("toReading"),lC=uC("toEditing");hU.add("mobile",function(a){return{getNotificationManagerImpl:function(){return{open:tx,close:tk,reposition:tk,getArgs:tx}},renderUI:function(J){var R=jL(a);0==(!1===a.settings.skin)?(a.contentCSS.push(R.content),b5.DOM.styleSheetLoader.load(R.ui,dG(a))):dG(a)();var E,G,I,M,D,X,V,F,Q,L,U,K,P,C,H=function(){a.fire("scrollIntoView")},N=rW.fromTag("div"),W=bQ.detect().os.isAndroid()?(F=H,Q=pT({classes:[fS.resolve("android-container")]}),L=cX(),U=dj(),K=bU(U),P=cH(),C=sT(tk,F),Q.add(L.wrapper()),Q.add(P),Q.add(C.component()),{system:uC(Q),element:Q.element,init:function(b){U.set(fT(b))},exit:function(){U.run(function(b){b.exit(),kj.remove(P,K)})},setToolbarGroups:function(c){var b=L.createGroups(c);L.setGroups(b)},setContextToolbar:function(c){var b=L.createGroups(c);L.setContextToolbar(b)},focusToolbar:function(){L.focus()},restoreToolbar:function(){L.restoreToolbar()},updateMode:function(b){iN(P,K,b,Q.root())},socket:uC(P),dropup:uC(C)}):(E=H,G=pT({classes:[fS.resolve("ios-container")]}),I=cX(),M=dj(),D=bU(M),X=cH(),V=sT(function(){M.run(function(b){b.refreshStructure()})},E),G.add(I.wrapper()),G.add(X),G.add(V.component()),{system:uC(G),element:G.element,init:function(b){M.set(t2(b))},exit:function(){M.run(function(b){kj.remove(X,D),b.exit()})},setToolbarGroups:function(c){var b=I.createGroups(c);I.setGroups(b)},setContextToolbar:function(c){var b=I.createGroups(c);I.setContextToolbar(b)},focusToolbar:function(){I.focus()},restoreToolbar:function(){I.restoreToolbar()},updateMode:function(b){iN(X,D,b,G.root())},socket:uC(X),dropup:uC(V)}),z=rW.fromDom(J.targetNode);a9.after(z,N),function(d,c){a9.append(d,c.element());var b=cK.children(c.element());jN(b,function(e){c.getByDom(e).each(oP)})}(N,W.system());var B=J.targetNode.ownerDocument.defaultView,A=kB(B,{onChange:function(){W.system().broadcastOn([qp.orientationChanged()],{width:n6(B)})},onReady:tk}),j=function(g,d,b,c){!1===c&&a.selection.collapse();var f=k(g,d,b);W.setToolbarGroups(!0===c?f.readOnly:f.main),a.setMode(!0===c?"readonly":"design"),a.fire(!0===c?e0():lC()),W.updateMode(c)},k=function(g,d,b){var c=g.get(),f={readOnly:c.backToMask.concat(d.get()),main:c.backToMask.concat(b.get())};return f},q=function(c,b){return a.on(c,b),{unbind:function(){a.off(c)}}};return a.on("init",function(){W.init({editor:{getFrame:function(){return rW.fromDom(a.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:tk}},onToReading:function(c){return q(e0(),c)},onToEditing:function(c){return q(lC(),c)},onScrollToCursor:function(c){return a.on("scrollIntoView",function(e){c(e)}),{unbind:function(){a.off("scrollIntoView"),A.destroy()}}},onTouchToolstrip:function(){s()},onTouchContent:function(){var i,c=rW.fromDom(a.editorContainer.querySelector("."+fS.resolve("toolbar")));(i=c,jq(i).bind(function(e){return W.system().getByDom(e).toOption()})).each(lx),W.restoreToolbar(),s()},onTapContent:function(i){var c=i.target();"img"===uD.name(c)?(a.selection.select(c.dom()),i.kill()):"a"===uD.name(c)&&W.system().getByDom(rW.fromDom(a.editorContainer)).each(function(e){c9.isAlpha(e)&&hE(c.dom())})}},container:rW.fromDom(a.editorContainer),socket:rW.fromDom(a.contentAreaContainer),toolstrip:rW.fromDom(a.editorContainer.querySelector("."+fS.resolve("toolstrip"))),toolbar:rW.fromDom(a.editorContainer.querySelector("."+fS.resolve("toolbar"))),dropup:W.dropup(),alloy:W.system(),translate:tk,setReadOnly:function(c){j(l,m,p,c)},readOnlyOnInit:function(){return !1}});var s=function(){W.dropup().disappear(function(){W.system().broadcastOn([qp.dropupDismissed()],{})})},f={label:"The first group",scrollable:!1,items:[qX.forToolbar("back",function(){a.selection.collapse(),W.exit()},{})]},h={label:"Back to read only",scrollable:!1,items:[qX.forToolbar("readonly-back",function(){j(l,m,p,!0)},{})]},b=nz(W,a),d=oE(a.settings,b),g={label:"The extra group",scrollable:!1,items:[]},p=dH([{label:"the action group",scrollable:!0,items:d},g]),m=dH([{label:"The read only mode group",scrollable:!0,items:[]},g]),l=dH({backToMask:[f],backToReadOnly:[h]});c8(W,a)}),{iframeContainer:W.socket().element().dom(),editorContainer:W.element().dom()}}}})}();